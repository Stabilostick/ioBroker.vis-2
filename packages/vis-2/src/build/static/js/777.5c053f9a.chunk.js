"use strict";(self.webpackChunkvis_2_gui=self.webpackChunkvis_2_gui||[]).push([[777],{54064:(t,e,i)=>{i.d(e,{A:()=>u});var s=i(30678),a=i(28298),o=i(65198),n=i(5770),r=i(73258),l=i(78366),d=i(99277);const c=["baseline","outline","round","sharp","twotone","knx-uf","upload"];class h extends s.Component{constructor(t){super(t),this.list={},this.index=null;const e=this.props.iconType||window.localStorage.getItem("vis.icon.type")||c[0];this.state={listLoaded:!1,selectedIcon:"",filter:this.props.filter||window.localStorage.getItem("vis.icon.filter")||"",iconType:e,iconTypeLoaded:{},filtered:[],loading:"upload"!==e,page:1,maxPages:0}}setStateAsync(t){return new Promise((e=>{this.setState(t,e)}))}async loadIconSet(t){if(!this.list[t]){if(await this.setStateAsync({loading:!0}),this.list[t]=!0,"customIcons"===t)try{this.list[t]=await fetch(this.props.customIcons).then((t=>t.json()))}catch(e){this.list[t]={},console.error("Cannot load custom icons from ".concat(this.props.customIcons,": ").concat(e))}else this.list[t]=await fetch("./material-icons/".concat(t,".json")).then((t=>t.json()));const i=Object.keys(this.list[t]);for(let e=0;e<i.length;e++){const s=i[e];this.list[t][s]="data:image/svg+xml;base64,".concat(this.list[t][s])}this.setState({iconTypeLoaded:{...this.state.iconTypeLoaded,[t]:!0},filtered:[],loading:!1},(()=>this.applyFilter(!0)))}}loadList(){this.state.listLoaded||fetch("./material-icons/index.json").then((t=>t.json())).then((async t=>{this.index=t,await this.loadIconSet(this.state.iconType),this.setState({listLoaded:!0},(()=>this.applyFilter(!0)))}))}componentWillUnmount(){this.filterTimer&&clearTimeout(this.filterTimer)}applyFilter(t){let e=200;!0===t&&(e=0,t=void 0),this.filterTimer&&clearTimeout(this.filterTimer),this.filterTimer=setTimeout((()=>{let e;this.filterTimer=null,(t=void 0===t?this.state.filter:t)?(t=t.toLowerCase(),e="knx-uf"===this.state.iconType?Object.keys(this.list["knx-uf"]).filter((e=>e.includes(t))):"customIcons"===this.state.iconType?Object.keys(this.list.customIcons).filter((e=>e.includes(t))):this.index.filter((e=>{var i,s;return!(null!==(i=e.unsupported_families)&&void 0!==i&&i.includes(this.state.iconType))&&(e.name.includes(t)||(null===(s=e.tags)||void 0===s?void 0:s.find((e=>e.includes(t)))))})).map((t=>t.name))):e="knx-uf"===this.state.iconType?Object.keys(this.list["knx-uf"]):"customIcons"===this.state.iconType?Object.keys(this.list.customIcons):this.index.filter((t=>!t.unsupported_families||!t.unsupported_families.includes(this.state.iconType))).map((t=>t.name)),this.setState({filtered:e,page:1,maxPages:Math.ceil(e.length/250)})}),e)}componentDidMount(){this.loadList()}onSelect(){this.state.selectedIcon&&this.state.selectedIcon.startsWith("data:")?this.props.onClose(this.state.selectedIcon):this.list[this.state.iconType]&&!0!==this.list[this.state.iconType]&&this.props.onClose(this.list[this.state.iconType][this.state.selectedIcon])}renderIcons(){const t=this.props.customColor&&"customIcons"===this.state.iconType?{color:this.props.customColor}:{},e=[];for(let i=250*(this.state.page-1);i<250*this.state.page&&i<this.state.filtered.length;i++){const s=this.state.filtered[i];e.push((0,d.jsxs)("div",{className:r.Utils.clsx(this.props.classes.iconDiv,this.state.selectedIcon===s&&this.props.classes.iconSelected),onClick:()=>this.setState({selectedIcon:s}),onDoubleClick:()=>this.setState({selectedIcon:s},(()=>this.onSelect())),children:[(0,d.jsx)(r.Icon,{src:this.list[this.state.iconType][s],className:this.props.classes.icon,style:t}),(0,d.jsx)("div",{className:this.props.classes.iconName,children:s.replace(/_/g," ")})]},s))}return e}render(){return(0,d.jsxs)(o.Dialog,{open:!0,maxWidth:"lg",fullWidth:!0,classes:{paper:this.props.classes.dialog},children:[(0,d.jsxs)(o.DialogTitle,{children:[(0,d.jsxs)("span",{style:{marginRight:20},children:["knx-uf"===this.state.iconType?"KNX UF":"upload"!==this.state.iconType?"Material":"","\xa0Icon Selector"]}),"upload"!==this.state.iconType?(0,d.jsx)(o.TextField,{value:this.state.filter,InputProps:{startAdornment:(0,d.jsx)(o.InputAdornment,{position:"start",children:(0,d.jsx)(n.Search,{})}),endAdornment:this.state.filter?(0,d.jsx)(o.InputAdornment,{position:"start",children:(0,d.jsx)(n.Close,{style:{cursor:"pointer"},onClick:()=>{window.localStorage.removeItem("vis.icon.filter"),this.setState({filter:""},(()=>this.applyFilter(!0)))}})}):null},variant:"standard",onChange:t=>{window.localStorage.setItem("vis.icon.filter",t.target.value),this.setState({filter:t.target.value},(()=>this.applyFilter()))},helperText:r.I18n.t("material_icons_result",this.state.filtered.length)}):null]}),(0,d.jsxs)(o.DialogContent,{style:{overflowY:"hidden",height:"100%"},children:[this.props.iconType?null:(0,d.jsx)("div",{style:{width:140,display:"inline-block",verticalAlign:"top"},children:(0,d.jsx)(o.FormControl,{children:(0,d.jsxs)(o.RadioGroup,{value:this.state.iconType,onChange:t=>this.setState({iconType:t.target.value}),children:[c.map((t=>(0,d.jsx)(o.FormControlLabel,{onClick:async()=>{window.localStorage.setItem("vis.icon.type",t);const e={iconType:t};"upload"!==t?(await this.loadIconSet(t),this.state.selectedIcon&&!this.list[t][this.state.selectedIcon]&&(e.selectedIcon="")):(e.selectedIcon="",e.maxPages=0),this.setState(e,(()=>this.applyFilter(!0)))},value:t,control:(0,d.jsx)(o.Radio,{}),label:r.I18n.t("material_icons_".concat(t)),classes:{label:this.props.classes.typeName}},t))),this.props.customIcons?(0,d.jsx)(o.FormControlLabel,{onClick:async()=>{window.localStorage.setItem("vis.icon.type","customIcons"),await this.loadIconSet("customIcons");const t={iconType:"customIcons"};this.state.selectedIcon&&!this.list.customIcons[this.state.selectedIcon]&&(t.selectedIcon=""),this.setState(t)},value:"customIcons",control:(0,d.jsx)(o.Radio,{}),label:r.I18n.t("custom_icons"),classes:{label:this.props.classes.typeName}},"customIcons"):null]})})}),(0,d.jsxs)("div",{style:{width:"calc(100% - 150px)",display:"inline-block",height:"100%",overflowY:"auto",paddingLeft:10},children:["knx-uf"===this.state.iconType?(0,d.jsxs)("div",{style:{paddingBottom:20},children:[r.I18n.t("Source:"),"\xa0",(0,d.jsx)("a",{style:{textDecoration:"none"},href:"https://github.com/OpenAutomationProject/knx-uf-iconset",target:"_blank",rel:"noreferrer",children:"https://github.com/OpenAutomationProject/knx-uf-iconset"})]}):null,"upload"!==this.state.iconType&&!this.state.loading&&this.list[this.state.iconType]&&!0!==this.list[this.state.iconType]?(0,d.jsx)("div",{style:{width:"100%"},children:(0,d.jsx)(o.Grid,{container:!0,spacing:2,style:{width:"100%",paddingTop:20},children:this.renderIcons()})}):"upload"!==this.state.iconType?(0,d.jsx)(o.LinearProgress,{}):null,"upload"===this.state.iconType?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:{width:"100%",textAlign:"center",marginBottom:10,marginTop:10},children:[r.I18n.t("icon_upload_hint"),(0,d.jsx)("br",{}),(0,d.jsx)(o.Button,{variant:"outlined",onClick:()=>window.open("https://github.com/ioBroker/ioBroker.vis-2#svg-and-currentcolor","_blank"),children:r.I18n.t("Read about currentColor in SVG")})]}),(0,d.jsx)(l.A,{themeType:this.props.themeType,onUpload:(t,e)=>this.setState({selectedIcon:e}),maxSize:15e3,accept:{"image/png":[".png"],"image/jpeg":[".jpg"],"image/svg+xml":[".svg"],"image/gif":[".gif"],"image/apng":[".apng"],"image/avif":[".avif"],"image/webp":[".webp"]}})]}):null]})]}),(0,d.jsxs)(o.DialogActions,{children:[this.state.maxPages>1&&!this.state.loading?(0,d.jsx)("div",{style:{marginLeft:140},children:(0,d.jsx)(o.Pagination,{count:this.state.maxPages,color:"primary",page:this.state.page,onChange:(t,e)=>this.setState({page:e})})}):null,this.state.maxPages>1?(0,d.jsx)("div",{style:{flexGrow:1}}):null,this.props.value?(0,d.jsx)(o.Button,{variant:"outlined",color:"grey",onClick:()=>this.props.onClose(""),startIcon:(0,d.jsx)(n.Delete,{}),children:r.I18n.t("Delete")}):null,(0,d.jsx)(o.Button,{variant:"contained",color:"primary",onClick:()=>this.onSelect(),disabled:!this.state.selectedIcon,startIcon:(0,d.jsx)(n.Check,{}),children:r.I18n.t("Select")}),(0,d.jsx)(o.Button,{variant:"contained",color:"grey",onClick:()=>this.props.onClose(null),startIcon:(0,d.jsx)(n.Close,{}),children:r.I18n.t("Cancel")})]})]})}}const p=(0,a.withStyles)((t=>({dialog:{height:"100%"},iconName:{fontSize:10,width:50,overflow:"hidden",textOverflow:"ellipsis"},iconDiv:{margin:0,textAlign:"center",cursor:"pointer",padding:2,borderRadius:2,"&:hover":{backgroundColor:t.palette.secondary.main}},icon:{width:48,height:48,color:t.palette.text.primary},iconSelected:{backgroundColor:t.palette.primary.main,"&:hover":{backgroundColor:t.palette.primary.light}},typeName:{whiteSpace:"nowrap"}})))(h);window.VisMaterialIconSelector=p;const u=p},78366:(t,e,i)=>{i.d(e,{A:()=>c});var s=i(30678),a=i(55491),o=i(65198),n=i(5770),r=i(73258),l=i(99277);const d=[".png",".jpg",".svg",".gif",".apng",".avif",".webp"],c=t=>{const[e,i]=(0,s.useState)(""),[c,h]=(0,s.useState)(null),[p,u]=(0,s.useState)(!1),[g,v]=(0,s.useState)(""),m=(0,s.useCallback)(((e,s)=>{if(null!==e&&void 0!==e&&e.length){u(!0),g&&v("");const s=new FileReader;i(e[0].name),s.onload=async i=>{u(!1),h(i.target.result),t.onUpload(e[0].name,i.target.result)},s.readAsDataURL(e[0])}null!==s&&void 0!==s&&s.length&&s[0].errors.forEach((t=>{"file-too-large"===t.code?v(r.I18n.t("File too large")):"file-invalid-type"===t.code?v(r.I18n.t("Invalid file type")):v("Error: ".concat(t.message)),setTimeout((()=>g&&v("")),3e3)}))}),[]),{getRootProps:x,getInputProps:f,isDragActive:y}=(0,a.useDropzone)({onDrop:m,maxFiles:1,maxSize:t.maxSize||void 0,accept:t.accept});return(0,l.jsxs)("div",{...x(),style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:200,borderRadius:4,boxSizing:"border-box",borderStyle:"dashed",borderWidth:1,borderColor:y?"dark"===t.themeType?"lightgreen":"green":"inherit"},children:[g?(0,l.jsx)("div",{style:{color:"#a90000"},children:g}):null,t.disabled||p?null:(0,l.jsx)("input",{...f()}),p?(0,l.jsx)(o.CircularProgress,{}):(0,l.jsx)("p",{style:{textAlign:"center",color:y?"dark"===t.themeType?"lightgreen":"green":"inherit"},children:e?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:e}),e.endsWith(".zip")?(0,l.jsx)(n.FolderZip,{}):null,d.find((t=>e.toLowerCase().endsWith(t)))?(0,l.jsx)("img",{src:c,alt:"uploaded",style:{maxWidth:100,maxHeight:100}}):null,c?(0,l.jsxs)("div",{style:{fontSize:10,opacity:.5},children:["(",r.Utils.formatBytes(c.length),")"]}):null]}):t.instruction||"".concat(r.I18n.t("Drop the files here ...")," ").concat(t.maxSize?r.I18n.t("(Maximal file size is %s)",r.Utils.formatBytes(t.maxSize)):"")})]})}},75777:(t,e,i)=>{i.d(e,{A:()=>ye});var s=i(30678),a=i.n(s),o=i(47461),n=i(99277);class r extends o.default{static getWidgetInfo(){return{id:"tplValueFloatBar",visSet:"basic",visName:"Bar",visPrev:"widgets/basic/img/Prev_ValueFloatBar.png",visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"min",type:"number",default:0},{name:"max",type:"number",default:100},{name:"orientation",type:"select",default:"horizontal",options:[{value:"horizontal",label:"horizontal"},{value:"vertical",label:"vertical"}]},{name:"color",type:"color",default:"blue"},{name:"border",type:"text"},{name:"shadow",type:"text"},{name:"reverse",type:"checkbox"}]}],visDefaultStyle:{width:200,height:130}}}getWidgetInfo(){return r.getWidgetInfo()}extractWidth(t,e){const i=t.match(/([0-9]+)(px|em)?/);if(i)return i[1]&&i[2]?parseInt(i[1],10)*(e||1)+i[2]:parseInt(i[1],10)*(e||1)}getCalc(){const t=this.state.rxData.min||0===this.state.rxData.min?Number(this.state.rxData.min):0,e=this.state.rxData.max||0===this.state.rxData.max?Number(this.state.rxData.max):100;let i=parseFloat(this.state.values["".concat(this.state.rxData.oid,".val")])||0;return i=(i-t)/(e-t),this.state.rxData.border?"calc(".concat(Math.round(100*i),"% - ").concat(this.extractWidth(this.state.rxData.border,2),")"):"".concat(Math.round(100*i),"%")}renderWidgetBody(t){let e;return super.renderWidgetBody(t),"vertical"===this.state.rxData.orientation?(e={height:this.getCalc()},this.state.rxData.reverse&&(e={...e,left:0,position:"absolute",bottom:"0"}),this.state.rxData.border&&(e={...e,border:this.state.rxData.border,width:"calc(100% - ".concat(this.extractWidth(this.state.rxData.border,2))})):(e={width:this.getCalc()},this.state.rxData.reverse&&(e={...e,float:"right"}),this.state.rxData.border&&(e={...e,border:this.state.rxData.border,height:"calc(100% - ".concat(this.extractWidth(this.state.rxData.border,2))})),this.state.rxData.shadow&&(e={...e,boxShadow:this.state.rxData.shadow}),this.state.rxData.color&&(e={...e,backgroundColor:this.state.rxData.color}),(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsx)("div",{"data-oid":this.state.rxData.oid,className:"vis-widget-body",style:e})})}}var l=i(30419);class d extends o.default{getWidgetInfo(){return d.getWidgetInfo()}static getWidgetInfo(){return{id:"tplBulbOnOffCtrl",visSet:"basic",visName:"Bulb on/off",visPrev:"widgets/basic/img/Prev_BulbOnOffCtrl.png",visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"min"},{name:"max"},{name:"icon_off",type:"image",default:"img/bulb_off.png"},{name:"icon_on",type:"image",default:"img/bulb_on.png"},{name:"readOnly",type:"checkbox"}]},{name:"ccontrol",fields:[{name:"urlTrue"},{name:"urlFalse"},{name:"oidTrue",type:"id"},{name:"oidFalse",type:"id"},{name:"oidTrueValue"},{name:"oidFalseValue"}]}]}}toggle(){if(this.state.rxData.oid===l.EI||this.state.rxData.readOnly)return;let t=this.state.values["".concat(this.state.rxData.oid,".val")];const{oidTrue:e,urlTrue:i,oid:s,min:a,max:o,oidTrueValue:n,oidFalseValue:r}=this.state.rxData;let{urlFalse:d,oidFalse:c}=this.state.rxData,h=null!==a&&void 0!==a?a:"",p=null!==o&&void 0!==o?o:"",u=null!==n&&void 0!==n?n:"",g=null!==r&&void 0!==r?r:"";if(e||i){if(!c&&e&&(c=e),!d&&i&&(d=i),""!==p?("true"===p&&(p=!0),"false"===p&&(p=!1),"true"===t&&(t=!0),"false"===t&&(t=!1),t=t===p):t=1===t||"1"===t||!0===t||"true"===t,t=!t,""!==h&&"false"!==h&&null!==h||(h=!1),""!==p&&"true"!==p&&null!==p||(p=!0),e&&"string"===typeof e)if(t){if(""===u&&(u=p),"false"===u&&(u=!1),"true"===u&&(u=!0),"string"===typeof u){const t=parseFloat(u);t.toString()===u&&(u=t)}this.props.context.setValue(e,u)}else if("string"===typeof c){if(""===g&&(g=h),"false"===g&&(g=!1),"true"===g&&(g=!0),"string"===typeof g){const t=parseFloat(g);t.toString()===g&&(g=t)}this.props.context.setValue(c,g)}i&&(t?this.props.socket.getRawSocket().emit("httpGet",i):this.props.socket.getRawSocket().emit("httpGet",d))}else""===h&&(null===t||""===t||void 0===t||!1===t||"false"===t)||""!==h&&h===t?"string"===typeof s&&this.props.context.setValue(s,""===p||p):""===p&&(!0===t||"true"===t)||""!==p&&t===p?"string"===typeof s&&this.props.context.setValue(s,""!==h&&h):"string"===typeof s&&(t=parseFloat(t),t=""===h||""===p||"number"!==typeof p&&"string"!==typeof p||"number"!==typeof h&&"string"!==typeof h?t>=.5?0:1:t>=(parseFloat(p)-parseFloat(h))/2?h:p,this.props.context.setValue(s,t))}isFalse(t,e,i){if(void 0!==e&&null!==e&&""!==e)return void 0!==t&&"string"!==typeof t&&(t=t.toString()),void 0!==i&&null!==i&&""!==i?t!==i:t===e;if(void 0===t||null===t||!1===t||"false"===t||"FALSE"===t||"False"===t||"OFF"===t||"Off"===t||"off"===t||""===t)return!0;if("0"===t||0===t)return!0;const s=parseFloat(t);return"NaN"!==s.toString()&&!s}renderWidgetBody(t){super.renderWidgetBody(t);const e=this.state.values["".concat(this.state.rxData.oid,".val")];let i;return i=this.isFalse(e,this.state.rxData.min,this.state.rxData.max)?this.state.rxData.icon_off||"img/bulb_off.png":this.state.rxData.icon_on||"img/bulb_on.png",(0,n.jsx)("div",{className:"vis-widget-body",onClick:()=>this.toggle(),children:(0,n.jsx)("img",{src:i.toString(),alt:"tplBulbOnOffCtrl",width:"100%"})})}}const c=t=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 24",style:t.style,children:(0,n.jsx)("path",{fill:"currentColor",d:"m7.97,0.026c-4.324,0 -7.82,3.72 -7.82,8.324c0,6.24 7.82,15.46 7.82,15.46s7.82,-9.21 7.82,-15.46c0,-4.6 -3.49,-8.32 -7.82,-8.32zm0,0"})});class h extends o.default{static getWidgetInfo(){return{id:"tplRedNumber",visSet:"basic",visName:"Red Number",visPrev:"widgets/basic/img/Prev_RedNumber.png",visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"oid",type:"id"},{name:"type",type:"select",options:[{value:"circle",label:"basic_circle"},{value:"pin",label:"basic_pin"}]},{name:"html_prepend",type:"html"},{name:"html_append_singular",type:"html"},{name:"html_append_plural",type:"html"},{name:"background",type:"color"},{name:"borderColor",label:"basic_borderColor",type:"color",hidden:'data.type === "pin"'},{name:"borderRadius",label:"basic_borderRadius",type:"slider",min:0,max:100,step:1,default:16,hidden:'data.type === "pin"'}]}],visDefaultStyle:{width:52,height:30}}}getWidgetInfo(){return h.getWidgetInfo()}renderWidgetBody(t){super.renderWidgetBody(t);const e=this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid?parseFloat(this.state.values["".concat(this.state.rxData.oid,".val")]):null;if(!this.props.editMode&&(!e||"false"===this.state.values["".concat(this.state.rxData.oid,".val")]))return null;if("pin"===this.state.rxData.type)return(0,n.jsxs)("div",{className:"vis-widget-body",children:[(0,n.jsx)(c,{style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:0,color:this.state.rxData.background||"red"}}),(0,n.jsxs)("div",{style:{position:"absolute",top:"22%",width:"96%",textAlign:"center",zIndex:1},children:[this.state.rxData.html_prepend?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_prepend}}):null,null===e?"--":e,1===e?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append_singular}}):(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append_plural}})]})]});const i={padding:3,borderRadius:void 0!==this.state.rxData.borderRadius&&null!==this.state.rxData.borderRadius?parseFloat(this.state.rxData.borderRadius):16,borderColor:this.state.rxData.borderColor||"white",borderWidth:3,borderStyle:"solid",backgroundColor:this.state.rxData.background||"red",minWidth:21,textAlign:"center",color:t.style.color||"white",fontSize:t.style.fontSize||20,fontFamily:t.style.fontFamily||"Helvetica",display:"flex",justifyContent:"center",alignItems:"center",boxSizing:"border-box"};return(0,n.jsxs)("div",{className:"vis-widget-body",style:i,children:[this.state.rxData.html_prepend?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_prepend}}):null,null===e?"--":e,1===e?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append_singular}}):(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append_plural}})]})}}var p=i(64470),u=i.n(p);class g extends a().Component{componentDidMount(){const t=(new DOMParser).parseFromString(this.props.html,"text/html").getElementsByTagName("script");let e=0;const i=Array.from(document.querySelectorAll("script[type='text/javascript']"));for(const s of Array.from(t)){const t="".concat(this.props.wid,"-").concat(e++),a=i.find((e=>e.id===t));if(a)return;const o=document.createElement("script");o.id=t,o.type="text/javascript",o.async=!0,o.innerHTML=s.innerHTML,document.body.appendChild(o)}}render(){const{isDiv:t,html:e,...i}=this.props;return t?(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:e},...i}):(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:e},...i})}}const v=g;class m extends o.default{static getWidgetInfo(){return{id:"tplHtml",visSet:"basic",visName:"HTML",visPrev:"widgets/basic/img/Prev_HTML.png",visAttrs:[{name:"common",fields:[{name:"html",type:"html"},{name:"refreshInterval",type:"slider",min:0,max:18e4,step:100}]}],visDefaultStyle:{width:200,height:130}}}getWidgetInfo(){return m.getWidgetInfo()}async componentWillUnmount(){this.interval&&clearInterval(this.interval),this.interval=null,super.componentWillUnmount()}async componentDidMount(){super.componentDidMount(),parseInt(this.state.rxData.refreshInterval,10)&&(this.interval=setInterval((()=>this.forceUpdate()),parseInt(this.state.rxData.refreshInterval,10)))}onRxDataChanged(t){super.onRxDataChanged(t),this.interval&&(clearInterval(this.interval),this.interval=null),parseInt(this.state.rxData.refreshInterval,10)&&(this.interval=setInterval((()=>this.forceUpdate()),parseInt(this.state.rxData.refreshInterval,10)))}renderWidgetBody(t){return super.renderWidgetBody(t),(0,n.jsx)(v,{className:"vis-widget-body",html:this.state.rxData.html,isDiv:!0,wid:this.props.id})}}m.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const x=m;var f=i(73258);class y extends o.default{static getWidgetInfo(){return{id:"tplValueString",visSet:"basic",visName:"String",visPrev:"widgets/basic/img/Prev_ValueString.png",visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"html_prepend",type:"html"},{name:"html_append",type:"html"},{name:"test_html",type:"html"},{name:"icon",type:"icon64"},{name:"iconSize",label:"icon_size_in_pixels",type:"slider",min:5,max:200,hidden:"!data.icon"}]}],visWidgetLabel:"value_string",visDefaultStyle:{width:100,height:30}}}getWidgetInfo(){return y.getWidgetInfo()}renderWidgetBody(t){var e,i;super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=50),void 0===t.style.height&&(t.style.height=20);const s=this.state.rxData.oid&&this.state.rxData.oid.includes('"')?"":this.state.rxData.oid||"";let a;a=this.props.editMode&&this.state.rxData.test_html?this.state.rxData.test_html:this.state.rxData.oid?this.state.rxData.oid.includes('"')?this.state.rxData.oid.substring(1,this.state.rxData.oid.length-1):s?this.state.values["".concat(s,".val")]:"":"";const o=this.state.rxData.icon?{display:"flex",alignItems:"center"}:{};return(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsxs)("div",{"data-oid":s,style:o,children:[this.state.rxData.icon?(0,n.jsx)(f.Icon,{src:this.state.rxData.icon,style:{width:this.state.rxData.iconSize||24,height:this.state.rxData.iconSize||24}}):null,(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:null!==(e=this.state.rxData.html_prepend)&&void 0!==e?e:""}}),(0,n.jsx)("span",{children:a}),(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:null!==(i=this.state.rxData.html_append)&&void 0!==i?i:""}})]})})}}y.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const w=y;var b=i(65198),D=i(71290),_=i(97161),S=i(25512);class I extends o.default{static getWidgetInfo(){return{id:"tplContainerView",visSet:"basic",visName:"View in widget",visAttrs:[{name:"common",fields:[{name:"contains_view",label:"vis_2_widgets_basic_contains_view",type:"views"}]}],visPrev:"widgets/basic/img/Prev_ContainerView.png",visWidgetLabel:"vis_2_widgets_basic_view_in_widget",visSetLabel:"set_basic",visDefaultStyle:{width:300,height:200}}}getWidgetInfo(){return I.getWidgetInfo()}getViewOptions(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t.___settings.folders.filter((t=>(t.parentId||null)===i)).forEach((i=>{e.push({type:"folder",folder:i,level:s+1}),this.getViewOptions(t,e,i.id,s+1)}));return Object.keys(t).filter((e=>(t[e].parentId||null)===i&&!e.startsWith("__"))).forEach((t=>{e.push({type:"view",view:t,level:s+1})})),e}renderViewSelector(){const t=this.getViewOptions(this.props.context.views,[],null,0,!0).filter((t=>"folder"===t.type||t.view!==this.props.view));return[(0,n.jsx)(b.IconButton,{className:this.props.context.editModeComponentClass,onMouseDown:t=>{t.stopPropagation(),t.preventDefault(),this.props.onIgnoreMouseEvents(!0),this.setState({showViewSelector:!0})},children:(0,n.jsx)(D.A,{})},"button"),this.state.showViewSelector?(0,n.jsxs)(b.Dialog,{open:!0,onClose:()=>this.setState({showViewSelector:!1},(()=>this.props.onIgnoreMouseEvents(!1))),children:[(0,n.jsx)(b.DialogTitle,{children:f.I18n.t("vis_2_widgets_basic_contains_view")}),(0,n.jsx)(b.DialogContent,{children:t.map(((t,e)=>"view"===t.type?(0,n.jsxs)(b.MenuItem,{value:t.view,onClick:()=>this.setState({showViewSelector:!1},(()=>{this.props.onIgnoreMouseEvents(!1),this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,data:{contains_view:t.view}}])})),style:{paddingLeft:16*t.level,lineHeight:"36px"},children:[(0,n.jsx)(_.A,{style:{verticalAlign:"middle",marginRight:4}}),(0,n.jsx)(b.ListItemText,{primary:t.view,style:{verticalAlign:"middle"}})]},e.toString()):(0,n.jsxs)(b.ListSubheader,{style:{paddingLeft:16*t.level,lineHeight:"36px",backgroundColor:"inherit"},children:[(0,n.jsx)(S.g1V,{style:{verticalAlign:"middle",marginRight:6,marginTop:-3,fontSize:20,color:"#00dc00"}}),(0,n.jsx)("span",{style:{fontSize:"1rem"},children:t.folder.name})]},e)))})]},"dialog"):null]}renderWidgetBody(t){super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=400),void 0===t.style.height&&(t.style.height=270);const e=this.state.rxData.contains_view;if(e===this.props.view)return(0,n.jsx)("div",{className:"vis-widget-body",style:{overflow:"hidden",position:"absolute"},children:f.I18n.t("vis_2_widgets_basic_cannot_recursive")});if(!e)return(0,n.jsxs)("div",{className:"vis-widget-body",style:{overflow:"hidden",position:"absolute"},children:[f.I18n.t("vis_2_widgets_basic_view_not_defined"),this.props.editMode?this.renderViewSelector():null]});const i={position:"absolute"};return this.state.rxStyle["overflow-x"]&&this.state.rxStyle["overflow-y"]?(delete t.style.overflow,this.state.rxStyle["overflow-y"]===this.state.rxStyle["overflow-x"]?i.overflow=this.state.rxStyle["overflow-x"]:(i.overflowX=this.state.rxStyle["overflow-x"],i.overflowY=this.state.rxStyle["overflow-y"])):this.state.rxStyle["overflow-x"]?(i.overflowX=this.state.rxStyle["overflow-x"],delete t.style.overflow):this.state.rxStyle["overflow-y"]?(i.overflowY=this.state.rxStyle["overflow-y"],delete t.style.overflow):this.state.rxStyle.overflow?i.overflow=this.state.rxStyle.overflow:i.overflow="hidden",delete t.style.overflow,delete t.style.overflowX,delete t.style.overflowY,(0,n.jsxs)("div",{className:"vis-widget-body",style:i,children:[this.state.editMode?(0,n.jsx)("div",{className:"vis-editmode-helper"}):null,super.getWidgetView(e)]})}}I.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,onIgnoreMouseEvents:u().func};const j=I;class C extends o.default{static getWidgetInfo(){return{id:"tplStatefulContainerView8",visSet:"basic",visName:"View in widget 8",visAttrs:"oid;count[1]/number;group.views;contains_view_(0-count)/views",visPrev:"widgets/basic/img/Prev_StatefulContainerView8.png"}}getWidgetInfo(){return C.getWidgetInfo()}renderWidgetBody(t){super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=400),void 0===t.style.height&&(t.style.height=270);const e=[];let i=0;for(;void 0!==this.state.rxData["contains_view_".concat(i)];)e.push(this.state.rxData["contains_view_".concat(i)]),i++;const s=this.state.rxData.oid;let a,o=this.state.values["".concat(s,".val")];if("nothing_selected"!==s&&void 0!==o?("true"!==o&&!0!==o||(o=1),"false"!==o&&!1!==o||(o=0),a=e[o]):a=e[0],a===this.props.view)return(0,n.jsx)("div",{className:"vis-widget-body",style:{overflow:"hidden",position:"absolute"},children:f.I18n.t("vis_2_widgets_basic_cannot_recursive")});const r={position:"absolute"};return this.state.rxStyle["overflow-x"]&&this.state.rxStyle["overflow-y"]?(delete t.style.overflow,this.state.rxStyle["overflow-y"]===this.state.rxStyle["overflow-x"]?r.overflow=this.state.rxStyle["overflow-x"]:(r.overflowX=this.state.rxStyle["overflow-x"],r.overflowY=this.state.rxStyle["overflow-y"])):this.state.rxStyle["overflow-x"]?(r.overflowX=this.state.rxStyle["overflow-x"],delete t.style.overflow):this.state.rxStyle["overflow-y"]?(r.overflowY=this.state.rxStyle["overflow-y"],delete t.style.overflow):this.state.rxStyle.overflow?r.overflow=this.state.rxStyle.overflow:r.overflow="hidden",delete t.style.overflow,delete t.style.overflowX,delete t.style.overflowY,(0,n.jsxs)("div",{className:"vis-widget-body",style:r,children:[this.state.editMode?(0,n.jsx)("div",{className:"vis-editmode-helper"}):null,super.getWidgetView(a)]})}}C.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,dateFormat:u().string};const k=C;class W extends o.default{static getWidgetInfo(){return{id:"_tplGroup",visSet:"basic",visAttrs:(t,e,i)=>{const s=t.members,a=[];s.forEach((t=>{var e;const s=null===(e=i.views[i.view].widgets[t])||void 0===e?void 0:e.data;s&&Object.keys(s).forEach((t=>{if("string"===typeof s[t]){let e=s[t].match(/(groupAttr\d+)+?/g);e&&e.forEach((t=>!a.includes(t)&&a.push(t))),e=s[t].match(/%([-_a-zA-Z\d]+)+?%/g),e&&e.forEach((t=>{const e=t.substring(1,t.length-1);!a.includes(e)&&a.push(e)}))}}))}));const o={name:"common",fields:[{name:"group_hint",label:"group_hint",type:"help",text:"group_help"}]},n={name:"objects",label:"group_fields",fields:[]},r=[o,n];for(let l=0;l<a.length;l++){const e=a[l],i=e.startsWith("groupAttr")?parseInt(e.substring(9),10):0;o.fields.push({name:e,title:t["attrName_".concat(e)]||t["attrName".concat(i)]||e,type:t["attrType_".concat(e)]||t["attrType".concat(i)]||""}),n.fields.push({name:"attrName_".concat(e),title:"".concat(f.I18n.t("group_attrName")," [").concat(e,"]"),type:""}),n.fields.push({name:"attrType_".concat(e),title:"".concat(f.I18n.t("group_attrType")," [").concat(e,"]"),type:"select",noTranslation:!0,options:["","text","checkbox","number","html","image","icon","icon64","id","color","views","widget","history","password","fontname","widget","groups","class","filters","json"]})}return r}}}componentDidMount(){super.componentDidMount(),this.setState({mounted:!0})}getWidgetInfo(){const t=W.getWidgetInfo();return t.visAttrs=t.visAttrs(this.props.context.views[this.props.view].widgets[this.props.id].data,null,{views:this.props.context.views,view:this.props.view,socket:this.props.context.socket,themeType:this.props.context.themeType,projectName:this.props.context.projectName,adapterName:this.props.context.adapterName,instance:this.props.context.instance,id:this.props.id,widget:this.props.context.views[this.props.view].widgets[this.props.id]}),t}renderWidgetBody(t){var e;const i=this.props.context;super.renderWidgetBody(t);const s=i.views[this.props.view].widgets[this.props.id];this.props.id===this.props.selectedGroup&&(t.style.overflow="visible");const a=[...(null===s||void 0===s||null===(e=s.data)||void 0===e?void 0:e.members)||[]];let o=null;return null!==a&&void 0!==a&&a.length&&this.state.mounted&&(a.sort(((t,e)=>{const s=i.views[this.props.view].widgets[t]||{},a=i.views[this.props.view].widgets[e]||{},o=s.style&&("relative"===s.style.position||"static"===s.style.position||"sticky"===s.style.position),n=a.style&&("relative"===a.style.position||"static"===a.style.position||"sticky"===a.style.position);return o&&n?0:o?-1:1})),o=a.map(((e,s)=>{const o=i.views[this.props.view].widgets[e];if(!o)return null;const n=o.style&&("relative"===o.style.position||"static"===o.style.position||"sticky"===o.style.position);return this.props.context.VisView.getOneWidget(s,o,{selectedGroup:this.props.selectedGroup,selectedWidgets:this.props.selectedWidgets,context:this.props.context,editMode:this.props.editMode,moveAllowed:this.props.moveAllowed,mouseDownOnView:this.props.mouseDownOnView,index:s,id:e,view:this.props.view,isRelative:n,askView:this.props.askView,refParent:t.refService,relativeWidgetOrder:a,viewsActiveFilter:this.props.viewsActiveFilter,customSettings:this.props.customSettings})}))),o}}W.propTypes={id:u().string.isRequired,context:u().object.isRequired,editMode:u().bool.isRequired};const M=W;class T extends o.default{static getWidgetInfo(){return{id:"tplValueBoolCtrlSvg",visSet:"basic",visName:"Bool SVG",visWidgetLabel:"qui_Bool SVG",visPrev:"widgets/basic/img/Prev_ValueBoolCtrlSvg.png",visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"no_control",type:"checkbox"},{name:"svg_false",type:"html",default:"<polygon points='100,10 40,198 190,78 10,78 160,198' style='fill:lime; stroke:purple; stroke-width:5; fill-rule:nonzero' transform='scale(0.4)' />"},{name:"svg_true",type:"html",default:"<polygon points='100,10 40,198 190,78 10,78 160,198' style='fill:yellow; stroke:red; stroke-width:5; fill-rule:nonzero' transform='scale(0.4)' />"},{name:"svg_opacity",type:"slider",min:0,max:1,step:.05}]}],visDefaultStyle:{width:85,height:85}}}getWidgetInfo(){return T.getWidgetInfo()}onSvgClick(){const t=this.state.rxData.oid;let e=this.state.values["".concat(this.state.rxData.oid,".val")];null===e||""===e||void 0===e||!1===e||"false"===e?this.props.context.setValue(t,!0):!0===e||"true"===e?this.props.context.setValue(t,!1):(e=parseFloat(e),e=e>=.5?1:0,this.props.context.setValue(t,1-e))}renderSvg(){let t=this.state.values["".concat(this.state.rxData.oid,".val")];"string"===typeof t&&(t=t.toLowerCase());const e=parseFloat(t);let i,s=this.state.rxData.svg_opacity;return this.props.editMode&&(void 0!==s&&null!==s&&""!==s||(s=1),parseFloat(s)<.2&&(s=.2)),i=0===e||"false"===t||"0"===t||"off"===t||!1===t||null===t||void 0===t?this.state.rxData.svg_false:this.state.rxData.svg_true,(0,n.jsx)("svg",{style:{width:"100%",height:"100%",opacity:s},dangerouslySetInnerHTML:{__html:i}})}renderWidgetBody(t){return super.renderWidgetBody(t),(0,n.jsx)("div",{onClick:this.props.editMode?null:()=>this.onSvgClick(),className:"vis-widget-body",children:this.renderSvg()})}}T.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const R=T;class N extends o.default{static getWidgetInfo(){return{id:"tplShapes",visSet:"basic",visName:"SVG shape",visPrev:"widgets/basic/img/Prev_SvgShape.png",visAttrs:[{name:"common",fields:[{name:"svgType",type:"select",options:[{value:"line",label:"basic_line"},{value:"triangle",label:"basic_triangle"},{value:"square",label:"basic_square"},{value:"pentagone",label:"basic_pentagone"},{value:"hexagone",label:"basic_hexagone"},{value:"octagone",label:"basic_octagone"},{value:"circle",label:"basic_circle"},{value:"star",label:"basic_star"},{value:"arrow",label:"basic_arrow"},{value:"custom",label:"basic_custom"}],default:"circle"},{name:"points",type:"slider",min:3,max:20,default:3,hidden:'data.svgType !== "custom"'},{name:"strokeColor",type:"color",default:"#009cb3"},{name:"fill",type:"color",default:"#00b3ac"},{name:"strokeWidth",type:"slider",min:0,max:100,default:5},{name:"rotate",type:"slider",min:0,max:360,default:0},{name:"scaleWidth",type:"slider",min:0,max:1,step:.05,default:1},{name:"scaleHeight",type:"slider",min:0,max:1,step:.05,default:1}]}],visDefaultStyle:{width:100,height:100}}}getWidgetInfo(){return N.getWidgetInfo()}static circlePoints(t,e,i){i=i||360/e;const s=[];let a="";const o=Math.PI/180;for(let n=0;n<e;n++){const e=o*(n*i-180),r={x:Math.sin(e)*t,y:Math.cos(e)*t};s.push(r),a+="".concat(r.x,", ").concat(r.y," ")}return a}renderWidgetBody(t){super.renderWidgetBody(t);let e=null;const i=Number(this.state.rxData.rotate)||0,s=Number(this.state.rxData.scaleWidth)||1,a=Number(this.state.rxData.scaleHeight)||1,o=Number(this.state.rxData.strokeWidth)||0,r="rotate(".concat(i,") scale(").concat(s,", ").concat(a,")");return"triangle"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,3)}):"line"===this.state.rxData.svgType?e=(0,n.jsx)("line",{vectorEffect:"non-scaling-stroke",transform:"rotate(".concat(i,")"),x1:"-50",y1:"0",x2:"50",y2:"0"}):"circle"===this.state.rxData.svgType?e=(0,n.jsx)("circle",{transform:r,cx:"0",cy:"0",r:50-o/2}):"pentagone"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,5)}):"square"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,4)}):"hexagone"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,6)}):"octagone"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,8)}):"custom"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,Number(this.state.rxData.points)||3)}):"star"===this.state.rxData.svgType?e=(0,n.jsx)("polygon",{transform:r,points:N.circlePoints(50-o,5,144)}):"arrow"===this.state.rxData.svgType&&(e=(0,n.jsx)("polygon",{transform:"".concat(r," translate(0,10)"),points:"0, -50 -43.3, 25 0,0 43.3, 25"})),(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"-50 -50 100 100",style:{display:"block",width:"100%",height:"100%",fill:this.state.rxData.fill,stroke:this.state.rxData.strokeColor,strokeWidth:this.state.rxData.strokeWidth},children:e})})}}class q extends o.default{constructor(t){super(t),this.essentialData=void 0,this.onResize=()=>{let t,e,i;var s,a,o,n;this.props.editMode?(t=(null===(s=this.props.context.views[this.props.context.activeView])||void 0===s||null===(a=s.settings)||void 0===a?void 0:a.sizex)||window.document.documentElement.clientWidth,e=(null===(o=this.props.context.views[this.props.context.activeView])||void 0===o||null===(n=o.settings)||void 0===n?void 0:n.sizey)||window.document.documentElement.clientHeight,i=window.vis.findNearestResolution(t,e)):(t=document.documentElement.clientWidth||0,e=document.documentElement.clientHeight,i=window.vis.findNearestResolution());this.setState({width:t,height:e,defaultView:i})},this.state={...this.state,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},this.essentialData=JSON.stringify(this.buildEssentialProjectData())}buildEssentialProjectData(){return Object.keys(this.props.context.views).sort().filter((t=>"___settings"!==t)).map((t=>{var e,i,s,a,o,n;return{id:t,sizex:null===(e=this.props.context.views[t])||void 0===e||null===(i=e.settings)||void 0===i?void 0:i.sizex,sizey:null===(s=this.props.context.views[t])||void 0===s||null===(a=s.settings)||void 0===a?void 0:a.sizey,useAsDefault:null===(o=this.props.context.views[t])||void 0===o||null===(n=o.settings)||void 0===n?void 0:n.useAsDefault}}))}static getWidgetInfo(){return{id:"tplScreenResolution",visSet:"basic",visName:"Screen Resolution",visPrev:"widgets/basic/img/Prev_ScreenResolution.png",visAttrs:[],visDefaultStyle:{width:170,height:75}}}async componentDidMount(){await super.componentDidMount(),window.addEventListener("resize",this.onResize),window.addEventListener("hashchange",this.onResize),this.onResize()}async componentWillUnmount(){super.componentWillUnmount(),window.removeEventListener("resize",this.onResize),window.removeEventListener("hashchange",this.onResize)}getWidgetInfo(){return q.getWidgetInfo()}createScreenText(){return(0,n.jsx)("span",{style:{fontWeight:"bold",cursor:"pointer"},onClick:()=>{window.vis.instance||(window.vis.generateInstance(),window.vis.instance?this.forceUpdate():window.alert("Cannot generate!"))},children:f.I18n.t("click to create")})}renderWidgetBody(t){super.renderWidgetBody(t);const e=this.state,i=JSON.stringify(this.buildEssentialProjectData());i!==this.essentialData&&(this.essentialData=i,setTimeout((()=>this.onResize()),100));const s={marginLeft:8,fontWeight:"bold"};return(0,n.jsxs)("div",{className:"vis-widget-body",style:{border:"1px solid #888",fontSize:12,opacity:.8,width:"100%",height:"100%",boxSizing:"border-box",padding:10,display:"flex",flexDirection:"column",overflow:"hidden",justifyContent:"center"},children:[(0,n.jsxs)("div",{children:[f.I18n.t("Default view"),":",(0,n.jsx)("span",{style:s,children:e.defaultView})]}),(0,n.jsxs)("div",{children:[f.I18n.t("Width"),":",(0,n.jsxs)("span",{style:s,children:[e.width,"px"]})]}),(0,n.jsxs)("div",{children:[f.I18n.t("Height"),":",(0,n.jsxs)("span",{style:s,children:[e.height,"px"]})]}),(0,n.jsxs)("div",{children:[f.I18n.t("Instance"),":",(0,n.jsx)("span",{style:s,children:window.vis.instance||this.createScreenText()})]})]})}}class O extends o.default{constructor(){super(...arguments),this.recognition=void 0,this.ignoreOnEnd=!1}async componentDidMount(){await super.componentDidMount(),this.setState({text:window.webkitSpeechRecognition?"":f.I18n.t("basic_speech2text_info_upgrade"),image:this.state.rxData.imageInactive,result:"",resultColor:this.state.rxData.keyWordColor}),window.webkitSpeechRecognition&&("continuous"!==this.state.rxData.speechMode||this.state.editMode?this.setState({text:f.I18n.t("basic_speech2text_info_start")}):this.startRecognition())}getWidgetInfo(){return O.getWidgetInfo()}static getWidgetInfo(){return{id:"tplSpeech2Text",visSet:"basic",visName:"Speech to Text",visPrev:"widgets/basic/img/Prev_Speech2Text.png",visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"speechMode",type:"select",default:"single",options:[{value:"single",label:"basic_speech2text_single"},{value:"startstop",label:"basic_speech2text_start_stop"},{value:"continuous",label:"basic_speech2text_continuous"}]},{name:"language",type:"select",options:[{value:"",label:""},{value:"en-US",label:"basic_speech2text_en_us"},{value:"de",label:"de"},{value:"ru-RU",label:"basic_speech2text_ru_ru"}]},{name:"keywords"}]},{name:"image",label:"Image",fields:[{name:"noImage",type:"checkbox",label:"basic_speech2text_no_image"},{name:"imageInactive",default:"widgets/basic/img/micInactive.svg",type:"image",label:"basic_speech2text_image_inactive"},{name:"imageActive",default:"widgets/basic/img/micActive.svg",type:"image",label:"basic_speech2text_image_active"},{name:"imageStarted",default:"widgets/basic/img/micStarted.svg",type:"image",label:"basic_speech2text_started"},{name:"imageDetected",default:"widgets/basic/img/micDetected.svg",type:"image",label:"basic_speech2text_detected"},{name:"imageSent",default:"widgets/basic/img/micSent.svg",type:"image",label:"basic_speech2text_sent"},{name:"imageHeightPx",default:"70",type:"slider",min:0,max:200,step:1,label:"basic_speech2text_height"},{name:"imageWidthPx",default:"70",type:"slider",min:0,max:200,step:1,label:"basic_speech2text_width"}]},{name:"text",label:"Text",fields:[{name:"noText",type:"checkbox",label:"basic_speech2text_no_text"},{name:"noResults",type:"checkbox",label:"basic_speech2text_no_results"},{name:"keyWordColor",type:"color",default:"#FFB051",label:"basic_speech2text_key_word_color",tooltip:"basic_speech2text_key_word_color_tooltip"},{name:"textSentColor",type:"color",default:"#7E88D3",label:"basic_speech2text_text_sent_color",tooltip:"basic_speech2text_text_sent_color_tooltip"}]}],visDefaultStyle:{width:500,height:77}}}findKeyWord(t){const e=this.state.rxData.keywords?this.state.rxData.keywords.toLowerCase().split(/[\s,;]+/g):null;let i=!1;if(!e)return!0;{const s=t.toLowerCase().split(" ");for(let a=0;a<e.length;a++){const o=s.indexOf(e[a]);if(-1!==o){let e=0;for(let t=0;t<o;t++)e+=s[t].length+1;t="".concat(t.substring(0,e),"<b>").concat(t.substring(e,e+s[o].length),"</b>").concat(t.substring(e+s[o].length)),i=!0;break}}}return!!i&&t}startRecognition(){if(this.recognition)return void("startstop"===this.state.rxData.speechMode&&(this.recognition.onend=null,this.recognition.stop(),this.recognition=null,this.setState({text:f.I18n.t("basic_speech2text_info_start"),image:this.state.rxData.imageInactive})));this.recognition=new window.webkitSpeechRecognition,this.recognition.continuous="continuous"===this.state.rxData.speechMode||"startstop"===this.state.rxData.speechMode,this.recognition.interimResults=!0,this.recognition.maxAlternatives=1;const t=Date.now();let e,i,s="",a="";this.recognition.onstart=()=>{this.setState({text:f.I18n.t("basic_speech2text_info_speak_now"),image:this.state.rxData.imageActive,result:""})},this.recognition.onerror=e=>{this.setState({result:"",image:this.state.rxData.imageInactive}),"no-speech"===e.error&&this.setState({text:f.I18n.t("basic_speech2text_info_no_speech")}),"audio-capture"===e.error&&(this.setState({text:f.I18n.t("basic_speech2text_info_no_microphone")}),this.ignoreOnEnd=!0),"not-allowed"===e.error&&(e.timeStamp-t<100?this.setState({text:f.I18n.t("basic_speech2text_info_blocked")}):this.setState({text:f.I18n.t("basic_speech2text_info_denied")}),this.ignoreOnEnd=!0)},this.recognition.onend=()=>{this.recognition.stop(),this.recognition=null,this.ignoreOnEnd||setTimeout((()=>{this.setState({image:this.state.rxData.imageInactive}),"continuous"===this.state.rxData.speechMode?(this.setState({result:"",text:f.I18n.t("basic_speech2text_info_speak_now")}),this.startRecognition()):this.setState({result:"",text:f.I18n.t("basic_speech2text_info_start")})}),1e3)},this.recognition.onresult=t=>{let o="";if("undefined"===typeof t.results)return this.recognition.onend=null,void this.recognition.stop();for(let e=t.resultIndex;e<t.results.length;++e)t.results[e].isFinal?s+=t.results[e][0].transcript:o+=t.results[e][0].transcript;this.state.image===this.state.rxData.imageActive&&this.setState({image:this.state.rxData.imageStarted}),this.setState({text:""});let n=s||o;const r=this.findKeyWord(n);i||(i=this.state.resultColor),r&&(n="string"===typeof r?r:n,this.state.image===this.state.rxData.imageStarted&&this.setState({image:this.state.rxData.imageDetected}),this.state.rxData.keyWordColor&&this.setState({resultColor:this.state.rxData.keyWordColor})),this.setState({text:n}),s?(e&&clearTimeout(e),r&&(this.setState({image:this.state.rxData.imageSent}),this.state.rxData.textSentColor&&this.setState({resultColor:this.state.rxData.textSentColor}),this.props.context.setValue(this.state.rxData.oid,s)),s="",a="",setTimeout((()=>{this.setState({image:this.state.rxData.imageActive,text:f.I18n.t("basic_speech2text_info_speak_now"),resultColor:i,result:""})}),1e3)):(a=o,e&&clearTimeout(e),e=setTimeout((()=>{this.recognition.onend=null,this.recognition.stop(),this.recognition=null;!!this.findKeyWord(a)&&(this.setState({image:this.state.rxData.imageSent}),this.state.rxData.textSentColor&&this.setState({resultColor:this.state.rxData.textSentColor}),this.props.context.setValue(this.state.rxData.oid,s)),s="",a="",setTimeout((()=>{this.setState({image:this.state.rxData.imageActive,text:f.I18n.t("basic_speech2text_info_speak_now"),resultColor:i,result:""}),this.startRecognition()}),1e3)}),3e3))},this.recognition.lang=this.state.rxData.language,this.recognition.start()}renderWidgetBody(t){return super.renderWidgetBody(t),(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsx)("table",{style:{height:"100%",width:"100%"},onClick:()=>{"continuous"!==this.state.rxData.speechMode&&!this.state.editMode&&window.webkitSpeechRecognition&&this.startRecognition()},children:(0,n.jsx)("tbody",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{display:this.state.rxData.noImage?"none":void 0},children:(0,n.jsx)(f.Icon,{alt:"mic",style:{height:"".concat(this.state.rxData.imageHeightPx,"px"),width:"".concat(this.state.rxData.imageWidthPx,"px")},src:this.state.image})}),(0,n.jsxs)("td",{className:"mic-text",style:{width:"100%"},children:[(0,n.jsx)("div",{style:{display:this.state.rxData.noText?"none":void 0},dangerouslySetInnerHTML:{__html:this.state.text}}),(0,n.jsx)("div",{style:{display:this.state.rxData.noResults?"none":void 0,color:this.state.resultColor},dangerouslySetInnerHTML:{__html:this.state.result}})]})]})})})})}}class A extends o.default{constructor(t){super(t),this.refreshInterval=null,this.frameRef=void 0,this.hashInstalled=!1,this.onWakeUpInstalled=!1,this.startedInterval=0,this.onHashChange=()=>{this.props.context.activeView===this.props.view&&this.refreshIFrame()},this.frameRef=a().createRef()}static getWidgetInfo(){return{id:"tplIFrame",visSet:"basic",visName:"iFrame",visPrev:"widgets/basic/img/Prev_iFrame.png",visAttrs:[{name:"common",fields:[{name:"src",type:"url"},{name:"refreshInterval",tooltip:"basic_refreshInterval_tooltip",type:"slider",min:0,max:18e4,step:100,default:0},{name:"noSandbox",type:"checkbox"},{name:"refreshOnWakeUp",type:"checkbox"},{name:"refreshOnViewChange",type:"checkbox"},{name:"refreshWithNoQuery",type:"checkbox"},{name:"scrollX",type:"checkbox"},{name:"scrollY",type:"checkbox"},{name:"seamless",type:"checkbox",default:!0}]}],visDefaultStyle:{width:600,height:320}}}async componentDidMount(){super.componentDidMount(),this.onPropertyUpdate()}async componentWillUnmount(){super.componentWillUnmount(),this.refreshInterval&&clearInterval(this.refreshInterval),this.hashInstalled&&(this.hashInstalled=!1,window.removeEventListener("hashchange",this.onHashChange))}getWidgetInfo(){return A.getWidgetInfo()}refreshIFrame(){var t,e;!0===this.state.rxData.refreshWithNoQuery?null===(t=this.frameRef.current)||void 0===t||null===(e=t.contentWindow)||void 0===e||e.location.reload():this.frameRef.current&&(this.frameRef.current.src="".concat(this.state.rxData.src).concat(this.state.rxData.src.includes("?")?"&":"?","_refts=").concat(Date.now()))}static isHidden(t){return null===t.offsetParent}static getParents(t){const e=[];let i=t;do{i=i.parentNode,e.unshift(t)}while(i);return e}onPropertyUpdate(){const t=this.state.rxData.src||"",e=Number(this.state.rxData.refreshInterval)||0,i=!0===this.state.rxData.refreshOnViewChange,s=!0===this.state.rxData.refreshOnWakeUp;t&&(i?this.hashInstalled||(this.hashInstalled=!0,window.addEventListener("hashchange",this.onHashChange)):this.hashInstalled&&(this.hashInstalled=!1,window.removeEventListener("hashchange",this.onHashChange)),e>0?(this.startedInterval!==e&&(this.startedInterval=e,this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=null),this.refreshInterval=this.refreshInterval||setInterval((()=>{if(this.frameRef.current&&!A.isHidden(this.frameRef.current)){const t=A.getParents(this.frameRef.current).filter((t=>A.isHidden(t)));t.length&&"BODY"!==t[0].tagName&&"materialdesign-vuetify-container"!==t[0].id||this.refreshIFrame()}}),e)):this.refreshInterval&&(this.startedInterval=0,clearInterval(this.refreshInterval),this.refreshInterval=null),s?this.onWakeUpInstalled||(this.onWakeUpInstalled=!0,window.vis.onWakeUp(this.onHashChange,this.props.id)):this.onWakeUpInstalled&&(this.onWakeUpInstalled=!1,window.vis.onWakeUp(null,this.props.id)))}onRxDataChanged(){this.onPropertyUpdate()}renderWidgetBody(t){super.renderWidgetBody(t),this.props.editMode&&t.overlayClassNames.push("vis-editmode-helper");const e={position:"absolute",boxSizing:"border-box",padding:0,margin:0,border:0,width:"100%",height:"100%",overflowX:this.state.rxData.scrollX?"scroll":"hidden",overflowY:this.state.rxData.scrollY?"scroll":"hidden"};return this.state.rxData.src||""?(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsx)("iframe",{style:e,ref:this.frameRef,title:this.props.id,src:this.state.rxData.src,sandbox:this.state.rxData.noSandbox?"allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts":void 0,seamless:this.state.rxData.seamless})}):null}}class F extends o.default{constructor(t){super(t),this.refreshInterval=null,this.imageRef=void 0,this.hashInstalled=!1,this.onWakeUpInstalled=!1,this.startedInterval=0,this.onHashChange=()=>{this.props.context.activeView===this.props.view&&this.refreshImage()},this.imageRef=a().createRef()}static getWidgetInfo(){return{id:"tplImage",visSet:"basic",visName:"Image",visPrev:"widgets/basic/img/Prev_Image.png",visAttrs:[{name:"common",fields:[{name:"src",type:"image"},{name:"stretch",type:"checkbox"},{name:"refreshInterval",tooltip:"basic_refreshInterval_tooltip",type:"slider",min:0,max:18e4,step:100,default:0},{name:"refreshOnWakeUp",type:"checkbox"},{name:"refreshOnViewChange",type:"checkbox"},{name:"refreshWithNoQuery",type:"checkbox"},{name:"allowUserInteractions",type:"checkbox"}]}],visDefaultStyle:{width:200,height:130}}}async componentDidMount(){super.componentDidMount(),this.onPropertyUpdate()}async componentWillUnmount(){super.componentWillUnmount(),this.refreshInterval&&clearInterval(this.refreshInterval),this.hashInstalled&&(this.hashInstalled=!1,window.removeEventListener("hashchange",this.onHashChange))}getWidgetInfo(){return F.getWidgetInfo()}refreshImage(){this.imageRef.current&&(!0===this.state.rxData.refreshWithNoQuery?this.imageRef.current.src=this.state.rxData.src:this.imageRef.current.src="".concat(this.state.rxData.src).concat(this.state.rxData.src.includes("?")?"&":"?","_refts=").concat(Date.now()))}static isHidden(t){return null===t.offsetParent}static getParents(t){const e=[];let i=t;do{i=i.parentNode,e.unshift(t)}while(i);return e}onPropertyUpdate(){const t=this.state.rxData.src||"",e=Number(this.state.rxData.refreshInterval)||0,i=!0===this.state.rxData.refreshOnViewChange,s=!0===this.state.rxData.refreshOnWakeUp;t&&(i?this.hashInstalled||(this.hashInstalled=!0,window.addEventListener("hashchange",this.onHashChange)):this.hashInstalled&&(this.hashInstalled=!1,window.removeEventListener("hashchange",this.onHashChange)),e>0?(this.startedInterval!==e&&(this.startedInterval=e,this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=null),this.refreshInterval=this.refreshInterval||setInterval((()=>{if(this.imageRef.current&&!F.isHidden(this.imageRef.current)){const t=F.getParents(this.imageRef.current).filter((t=>F.isHidden(t)));t.length&&"BODY"!==t[0].tagName&&"materialdesign-vuetify-container"!==t[0].id||this.refreshImage()}}),e)):this.refreshInterval&&(this.startedInterval=0,clearInterval(this.refreshInterval),this.refreshInterval=null),s?this.onWakeUpInstalled||(this.onWakeUpInstalled=!0,window.vis.onWakeUp(this.onHashChange,this.props.id)):this.onWakeUpInstalled&&(this.onWakeUpInstalled=!1,window.vis.onWakeUp(null,this.props.id)))}onRxDataChanged(){this.onPropertyUpdate()}renderWidgetBody(t){super.renderWidgetBody(t),this.props.editMode&&t.overlayClassNames.push("vis-editmode-helper");const e={padding:0,margin:0,border:0,width:"100%",height:"auto"};this.state.rxData.stretch&&(e.height="100%"),this.state.rxData.allowUserInteractions||(e.touchAction="none",e.userSelect="none");return this.state.rxData.src||""?(0,n.jsx)("div",{className:"vis-widget-body",style:{overflow:"hidden"},children:(0,n.jsx)(f.Icon,{style:e,ref:this.imageRef,src:this.state.rxData.src,alt:this.props.id})}):null}}class P extends o.default{constructor(){super(...arguments),this.onNavigate=()=>{this.state.rxData.nav_view&&this.props.context.changeView(this.state.rxData.nav_view,this.state.rxData.sub_view||void 0)}}static getWidgetInfo(){return{id:"tplHtmlNav",visSet:"basic",visName:"HTML navigation",visPrev:"widgets/basic/img/Prev_HTMLnavigation.png",visAttrs:[{name:"common",fields:[{name:"html",type:"html"},{name:"nav_view",type:"views"},{name:"sub_view",label:"basic_sub_view",type:"text",tooltip:"sub_view_tooltip",hidden:"!data.nav_view"}]}],visDefaultStyle:{width:200,height:130}}}getWidgetInfo(){return P.getWidgetInfo()}renderWidgetBody(t){return super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=200),void 0===t.style.height&&(t.style.height=130),(0,n.jsx)(v,{className:"vis-widget-body",html:this.state.rxData.html,isDiv:!0,wid:this.props.id,onClick:this.props.editMode?null:this.onNavigate})}}const z=P;var E=i(5770),L=i(23531),B=i(7967),V=i(28298),H=i(54064);class J extends s.Component{constructor(t){var e;super(t),this.originalItems=void 0;const i=(t.items||[]).map((t=>({...t,id:(0,L.A)()})));this.state={filters:(null===(e=window.vis)||void 0===e?void 0:e.updateFilter())||[],items:i,applyItems:JSON.stringify(t.items||[]),selectIcon:null,selectImage:null,anchorEl:null},this.originalItems=this.state.applyItems}updateItems(t){const e=JSON.parse(JSON.stringify(t));e.forEach((t=>delete t.id)),this.setState({items:t,applyItems:JSON.stringify(e)})}renderSelectIconDialog(){return null===this.state.selectIcon?null:(0,n.jsx)(H.A,{themeType:this.props.context.themeType,value:this.state.items[this.state.selectIcon],onClose:t=>{if(null!==t){const e=JSON.parse(JSON.stringify(this.state.items));e[this.state.selectIcon].icon=t,this.updateItems(e)}this.setState({selectIcon:null})}})}renderFilterSelector(){if(!this.state.anchorEl)return null;const t=this.state.filters.filter((t=>!this.state.items.find((e=>e.value===t))));return(0,n.jsxs)(b.Menu,{anchorEl:this.state.anchorEl,open:!0,onClose:()=>this.setState({anchorEl:null}),children:[null===t||void 0===t?void 0:t.map((t=>(0,n.jsx)(b.MenuItem,{onClick:async()=>{const e=JSON.parse(JSON.stringify(this.state.items));e.push({label:t,value:t,id:(0,L.A)()}),this.setState({anchorEl:null},(()=>this.updateItems(e)))},value:t,children:t},t))),(0,n.jsx)(b.MenuItem,{sx:t=>({color:t.palette.primary.main}),onClick:()=>{const t=JSON.parse(JSON.stringify(this.state.items));t.push({label:"",value:"",id:(0,L.A)()}),this.setState({anchorEl:null},(()=>this.updateItems(t)))},children:f.I18n.t("Custom")}),t.length>1?(0,n.jsx)(b.MenuItem,{sx:t=>({color:t.palette.primary.main}),onClick:()=>{const e=JSON.parse(JSON.stringify(this.state.items));t.forEach((t=>e.push({label:t,value:t,id:(0,L.A)()}))),this.setState({anchorEl:null},(()=>this.updateItems(e)))},children:f.I18n.t("basic_all_filters")}):null]})}renderSelectImageDialog(){if(null===this.state.selectImage)return null;let t=this.state.items[this.state.selectImage].image||"";return t.startsWith("../")?t=t.substring(3):t.startsWith("_PRJ_NAME/")&&(t=t.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/"))),(0,n.jsx)(f.SelectFile,{title:f.I18n.t("Select file"),onClose:()=>this.setState({selectImage:null}),restrictToFolder:"".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName),allowNonRestricted:!0,allowUpload:!0,allowDownload:!0,allowCreateFolder:!0,allowDelete:!0,allowView:!0,showToolbar:!0,imagePrefix:"../",selected:t,filterByType:"images",onOk:t=>{var e,i;let s=t?Array.isArray(t)?t[0]:t:"";const a="".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/");null!==(e=s)&&void 0!==e&&e.startsWith(a)?s="_PRJ_NAME/".concat(s.substring(a.length)):null!==(i=s)&&void 0!==i&&i.startsWith("/")?s="..".concat(s):s&&!s.startsWith(".")&&(s="../".concat(s));const o=JSON.parse(JSON.stringify(this.state.items));o[this.state.selectImage].image=s,this.updateItems(o),this.setState({selectImage:null})},socket:this.props.context.socket})}renderTableRow(t,e){let i=t.image;return i&&(i.startsWith("../")?i=i.substring(3):i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/")))),(0,n.jsx)(B.sx,{draggableId:t.id||"",index:e,children:s=>(0,n.jsxs)(b.TableRow,{className:e%2?this.props.classes.rowEven:"",ref:s.innerRef,...s.draggableProps,children:[(0,n.jsxs)(b.TableCell,{className:this.props.classes.handlerCell,...s.dragHandleProps,children:[(0,n.jsx)(E.DragHandle,{className:this.props.classes.grab}),(0,n.jsxs)("div",{className:this.props.classes.index,children:[e+1,"."]})]}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cellText,children:(0,n.jsx)(b.TextField,{variant:"standard",fullWidth:!0,value:t.value||"",onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));i[e].value=t.target.value,this.updateItems(i)},InputLabelProps:{shrink:!0}})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cellText,children:(0,n.jsx)(b.TextField,{variant:"standard",fullWidth:!0,value:t.label||"",onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));i[e].label=t.target.value,this.updateItems(i)},InputLabelProps:{shrink:!0}})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cellImage,children:t.image?null:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(b.TextField,{fullWidth:!0,size:"small",variant:"standard",value:t.icon,onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));i[e].icon=t.target.value,this.updateItems(i)},InputProps:{endAdornment:t.icon?(0,n.jsx)(b.IconButton,{size:"small",onClick:()=>{const t=JSON.parse(JSON.stringify(this.state.items));t[e].icon="",this.updateItems(t)},children:(0,n.jsx)(E.Clear,{})}):null}}),(0,n.jsx)(b.Button,{variant:t.icon?"outlined":void 0,color:t.icon?"grey":void 0,onClick:()=>this.setState({selectIcon:e}),children:t.icon?(0,n.jsx)(f.Icon,{src:t.icon,style:{width:36,height:36}}):"..."})]})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cellImage,children:t.icon?null:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(b.TextField,{variant:"standard",fullWidth:!0,InputProps:{endAdornment:t.image?(0,n.jsx)(b.IconButton,{size:"small",onClick:()=>{const t=JSON.parse(JSON.stringify(this.state.items));t[e].image="",this.updateItems(t)},children:(0,n.jsx)(E.Clear,{})}):null},value:t.image,onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));i[e].image=t.target.value,this.updateItems(i)}}),(0,n.jsx)(b.Button,{variant:i?"outlined":void 0,color:i?"grey":void 0,onClick:()=>this.setState({selectImage:e}),children:i?(0,n.jsx)(f.Icon,{src:i,style:{width:36,height:36}}):"..."})]})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cell,children:(0,n.jsx)(f.ColorPicker,{style:{width:"100%"},value:t.color,onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));i[e].color=t,this.updateItems(i)}})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cell,children:(0,n.jsx)(f.ColorPicker,{style:{width:"100%"},value:t.activeColor,onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));i[e].activeColor=t,this.updateItems(i)}})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cellButton,children:(0,n.jsx)(b.Checkbox,{checked:!!t.default,onChange:t=>{const i=JSON.parse(JSON.stringify(this.state.items));!this.props.multiple&&t.target.checked&&i.forEach((t=>t.default=!1)),i[e].default=t.target.checked,this.updateItems(i)}})}),(0,n.jsx)(b.TableCell,{className:this.props.classes.cellButton,children:(0,n.jsx)(b.IconButton,{size:"small",onClick:()=>{const t=JSON.parse(JSON.stringify(this.state.items));t.splice(e,1),this.updateItems(t)},children:(0,n.jsx)(E.Delete,{})})})]})},t.id)}renderTable(){return(0,n.jsxs)(b.Table,{stickyHeader:!0,size:"small",children:[(0,n.jsx)(b.TableHead,{children:(0,n.jsxs)(b.TableRow,{children:[(0,n.jsx)(b.TableCell,{style:{width:40},children:(0,n.jsx)(b.Fab,{size:"small",onClick:t=>this.setState({anchorEl:t.currentTarget}),children:(0,n.jsx)(E.Add,{})})}),(0,n.jsx)(b.TableCell,{style:{width:70},children:f.I18n.t("Value")}),(0,n.jsx)(b.TableCell,{style:{width:"calc(100% - 700px)"},children:f.I18n.t("Title")}),(0,n.jsx)(b.TableCell,{style:{width:150},children:f.I18n.t("Icon")}),(0,n.jsx)(b.TableCell,{style:{width:150},children:f.I18n.t("Image")}),(0,n.jsx)(b.TableCell,{style:{width:150},children:f.I18n.t("Text color")}),(0,n.jsx)(b.TableCell,{style:{width:150},children:f.I18n.t("jqui_active_color")}),(0,n.jsx)(b.TableCell,{style:{width:70},children:f.I18n.t("Default")}),(0,n.jsx)(b.TableCell,{style:{width:40}})]})}),(0,n.jsx)(B.JY,{onDragEnd:t=>{if(!t.destination)return;const e=JSON.parse(JSON.stringify(this.state.items)),[i]=e.splice(t.source.index,1);e.splice(t.destination.index,0,i),this.updateItems(e)},children:(0,n.jsx)(B.gL,{droppableId:"items",type:"ROW",children:t=>(0,n.jsx)(b.TableBody,{ref:t.innerRef,...t.droppableProps,children:this.state.items.map(((t,e)=>this.renderTableRow(t,e)))})})})]})}render(){return(0,n.jsxs)(b.Dialog,{fullWidth:!0,maxWidth:"xl",open:!0,onClose:()=>this.props.onClose(),children:[(0,n.jsx)(b.DialogTitle,{children:f.I18n.t("Edit")}),(0,n.jsxs)(b.DialogContent,{style:{minHeight:"calc(90vh - 164px)"},children:[this.renderSelectIconDialog(),this.renderSelectImageDialog(),this.renderFilterSelector(),this.renderTable()]}),(0,n.jsxs)(b.DialogActions,{children:[(0,n.jsx)(b.Button,{disabled:this.originalItems===this.state.applyItems,variant:"contained",onClick:()=>this.props.onClose(JSON.parse(this.state.applyItems)),color:"primary",startIcon:(0,n.jsx)(E.Check,{}),children:f.I18n.t("Apply")}),(0,n.jsx)(b.Button,{variant:"contained",color:"grey",onClick:()=>this.props.onClose(),startIcon:(0,n.jsx)(E.Close,{}),children:f.I18n.t("Cancel")})]})]})}}const U=(0,V.withStyles)((t=>({handlerCell:{alignItems:"center",whiteSpace:"nowrap",padding:"1px 4px",verticalAlign:"middle"},grab:{marginRight:4,marginTop:12},index:{display:"inline-block",verticalAlign:"top",marginTop:15},cell:{padding:"1px 4px",verticalAlign:"bottom"},cellText:{padding:"12px 4px 0px 4px"},cellImage:{padding:"0px 4px",verticalAlign:"bottom"},cellButton:{padding:"0px 4px"},rowEven:{backgroundColor:"dark"===t.palette.mode?"rgba(255, 255, 255, 0.04)":"rgba(0, 0, 0, 0.04)"}})))(J);function G(t){const e=t.length;for(let i=0;i<e;i++){const e=t[i];if(e.includes(",")){const s=e.split(",").map((t=>t.trim())).filter((t=>t)),a=s.shift();a&&(t[i]=a,s.length&&t.push(...s))}else if(e.includes(";")){const s=e.split(";").map((t=>t.trim())).filter((t=>t)),a=s.shift();a&&(t[i]=a,s.length&&t.push(...s))}}}const Y=t=>{const[e,i]=(0,s.useState)(!1);let a=t.data.items;if(e&&!a&&t.data.filters&&(a=t.data.filters.split(";").map((t=>({label:t.trim(),value:t.trim()}))).filter((t=>t.value))),e&&"string"===typeof a)try{a=JSON.parse(a)}catch(o){a=[]}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.Button,{style:{whiteSpace:"nowrap"},onClick:()=>i(!0),variant:"outlined",startIcon:(0,n.jsx)(E.Edit,{}),children:f.I18n.t("Edit")}),e?(0,n.jsx)(U,{context:t.context,items:a||[],multiple:t.data.multiple,onClose:e=>{if(e){const i=JSON.parse(JSON.stringify(t.data));i.items=JSON.stringify(e),t.setData(i)}i(!1)}}):null]})};class Q extends o.default{constructor(){super(...arguments),this.editMode=void 0}static getWidgetInfo(){return{id:"tplFilterDropdown",visSet:"basic",visName:"filter - dropdown",visPrev:"widgets/basic/img/Prev_FilterDropdown.png",visAttrs:[{name:"common",fields:[{name:"items",label:"editor",type:"custom",noBinding:!0,component:(t,e,i,s)=>(0,n.jsx)(Y,{data:e,setData:i,context:s.context}),default:"[]"},{name:"type",label:"Type",type:"select",options:[{value:"dropdown",label:"basic_filter_type_dropdown"},{value:"horizontal_buttons",label:"basic_filter_type_horizontal_buttons"},{value:"vertical_buttons",label:"basic_filter_type_vertical_buttons"}],default:"horizontal_buttons"},{name:"widgetTitle",label:"name",hidden:'data.type !== "dropdown"'},{name:"autoFocus",type:"checkbox",hidden:'data.type !== "dropdown"'},{name:"multiple",label:"basic_filter_multiple",type:"checkbox"},{name:"noAllOption",label:"basic_no_all_option",type:"checkbox"},{name:"noFilterText",label:"basic_no_filter_text",type:"text",hidden:"!!data.noAllOption"},{name:"dropdownVariant",label:"jqui_variant",type:"select",noTranslation:!0,options:[{value:"standard",label:"standard"},{value:"outlined",label:"outlined"},{value:"filled",label:"filled"}],default:"standard",hidden:'data.type !== "dropdown"'},{name:"buttonsVariant",label:"jqui_variant",type:"select",noTranslation:!0,options:[{value:"outlined",label:"outlined"},{value:"contained",label:"contained"},{value:"text",label:"text"}],default:"outlined",hidden:'data.type === "dropdown"'},{name:"dropdownSmall",label:"basic_small",default:!1,type:"checkbox",hidden:'data.type !== "dropdown"'}]}],visDefaultStyle:{width:200,height:50}}}getWidgetInfo(){return Q.getWidgetInfo()}async componentDidMount(){if(super.componentDidMount(),this.props.editMode)this.editMode=!0;else{this.editMode=!1;const t=this.getItems();if(t.find((t=>t.default&&t.value))){const e=[];t.forEach((t=>t.default&&e.push(t.value))),G(e),setTimeout((()=>{this.props.askView("getViewClass").onCommand("changeFilter",{filter:e})}),0)}}}onCommand(t){"changeFilter"===t&&this.forceUpdate(),super.onCommand(t)}renderDropdown(t){const e=this.props.viewsActiveFilter[this.props.view]||[];let i;return i=this.state.rxData.multiple?e:e[0]||"",(0,n.jsxs)(b.FormControl,{fullWidth:!0,variant:this.state.rxData.dropdownVariant||"standard",children:[this.state.rxData.widgetTitle?(0,n.jsx)(b.InputLabel,{children:this.state.rxData.widgetTitle}):null,(0,n.jsxs)(b.Select,{fullWidth:!0,value:i||"_",onChange:t=>{let e="_"===t.target.value?[]:t.target.value;"string"===typeof e&&(e=e.split(",")),(e.includes("")||e.includes("_"))&&(e=[]),G(e);this.props.askView("getViewClass").onCommand("changeFilter",{filter:e})},renderValue:e=>{const i=t.find((t=>t.value===e));return i?(0,n.jsx)("span",{style:{color:i.color},children:i.label}):"_"!==e&&e?e:this.state.rxData.noAllOption?"":f.I18n.t("basic_no_filter")},multiple:!!this.state.rxData.multiple,autoFocus:!!this.state.rxData.autoFocus,children:[this.state.rxData.noAllOption?null:(0,n.jsx)(b.MenuItem,{value:"_",children:(0,n.jsx)("em",{children:this.state.rxData.noFilterText||f.I18n.t("basic_no_filter")})}),t.map((t=>{let i=t.icon;return!i&&t.image&&(i=t.image,i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/")))),(0,n.jsxs)(b.MenuItem,{value:t.value,selected:e.includes(t.value),style:{color:e.includes(t.value)?t.color:t.activeColor||t.color},children:[i?(0,n.jsx)(f.Icon,{src:i,style:{width:24,height:24,marginRight:8}}):null,t.label]},t.value)}))]})]})}renderButtons(t){const e=this.props.viewsActiveFilter[this.props.view]||[];return(0,n.jsxs)(b.ButtonGroup,{variant:this.state.rxData.buttonsVariant||"contained",orientation:"horizontal_buttons"===this.state.rxData.type?"horizontal":"vertical",style:{width:"100%",height:"100%"},children:[this.state.rxData.noAllOption?null:(0,n.jsx)(b.Button,{style:{flexGrow:1},onClick:()=>{this.props.askView("getViewClass").onCommand("changeFilter",{filter:[]})},children:(0,n.jsx)("em",{children:this.state.rxData.noFilterText||f.I18n.t("basic_no_filter")})}),t.map((t=>{let i=t.icon;return!i&&t.image&&(i=t.image,i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/")))),(0,n.jsx)(b.Button,{onClick:()=>{let i;i=this.state.rxData.multiple?e.includes(t.value)?e.filter((e=>e!==t.value)):[...e,t.value]:[t.value];const s=this.props.askView("getViewClass");G(i),s.onCommand("changeFilter",{filter:i})},color:e.includes(t.value)?"primary":void 0,sx:i=>({backgroundColor:e.includes(t.value)?"contained"===this.state.rxData.buttonsVariant?i.palette.secondary.main:i.palette.primary.main:void 0,color:e.includes(t.value)?"contained"===this.state.rxData.buttonsVariant?i.palette.secondary.contrastText:i.palette.primary.contrastText:void 0,"&:hover":{backgroundColor:e.includes(t.value)?"contained"===this.state.rxData.buttonsVariant?i.palette.secondary.light:i.palette.primary.light:void 0,color:e.includes(t.value)?"contained"===this.state.rxData.buttonsVariant?i.palette.secondary.contrastText:i.palette.primary.contrastText:void 0}}),startIcon:i?(0,n.jsx)(f.Icon,{src:i,alt:t.label,style:{height:24}}):null,style:{flexGrow:1,color:e.includes(t.value)&&t.activeColor||t.color},children:t.label},t.value)}))]})}getItems(){let t=this.state.data.items;if(!t&&this.state.data.filters&&(t=this.state.data.filters.split(";").map((t=>({label:t.trim(),value:t.trim()}))).filter((t=>t.value))),"string"===typeof t)try{t=JSON.parse(t)}catch(e){t=[]}return t=t||[],t}renderWidgetBody(t){super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=200),void 0===t.style.height&&(t.style.height=50);const e=this.getItems();if(void 0!==this.editMode&&this.editMode!==this.props.editMode&&(this.editMode=this.props.editMode,!this.editMode&&e.find((t=>t.default&&t.value)))){const t=[];e.forEach((e=>e.default&&t.push(e.value))),G(t),setTimeout((()=>{this.props.askView("getViewClass").onCommand("changeFilter",{filter:t})}),0)}const i=this.state.rxData.type||"dropdown";return"horizontal_buttons"===i||"vertical_buttons"===i?this.renderButtons(e):this.renderDropdown(e)}}const X=Q;class K extends o.default{static getWidgetInfo(){return{id:"tplLink",visSet:"basic",visName:"link",visPrev:"widgets/basic/img/Prev_tplLink.png",visAttrs:[{name:"common",fields:[{name:"html",type:"html"},{name:"href",type:"url"},{name:"target",label:"target",type:"auto",options:["auto","_blank","_self","_parent","_top"],hidden:"!data.href"}]}],visDefaultStyle:{width:200,height:130}}}getWidgetInfo(){return K.getWidgetInfo()}renderWidgetBody(t){return super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=200),void 0===t.style.height&&(t.style.height=130),(0,n.jsx)("a",{href:this.state.rxData.href,target:this.state.rxData.target,style:{textDecoration:"none",width:"100%",height:"100%"},children:(0,n.jsx)(v,{className:"vis-widget-body",html:this.state.rxData.html,isDiv:!0,wid:this.props.id})})}}const Z=K;var $=i(47569);class tt extends o.default{static getWidgetInfo(){return{id:"tplStatefulImage8",visSet:"basic",visName:"Image 8",visPrev:"widgets/basic/img/Prev_StatefulImage.png",visDefaultStyle:{width:200,height:130},visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"count",type:"number",default:0,onChange:async(t,e,i)=>{const{count:s}=e;for(let a=0;a<s;a++)e["g_images-".concat(a)]=!0;i(e),$.M_.dispatch((0,$.V_)(!0))}}]},{name:"images",label:"Image",indexFrom:0,indexTo:"count",fields:[{name:"src_",type:"image"}]}]}}getWidgetInfo(){return tt.getWidgetInfo()}renderWidgetBody(t){super.renderWidgetBody(t);const e=[];for(let i=0;i<=this.state.rxData.count;i++)this.state.rxData["src_".concat(i)]&&e.push(this.state.rxData["src_".concat(i)]);return(0,n.jsx)("div",{className:["vis-widget-body"].join(" "),children:(0,n.jsx)(f.Icon,{className:"vis-widget-element",style:{position:"absolute",width:"100%"},src:this.getImage(e),alt:"selected_image"})})}getImage(t){if("nothing_selected"!==this.state.rxData.oid&&void 0!==this.state.values["".concat(this.state.rxData.oid,".val")]){let e=this.state.values["".concat(this.state.rxData.oid,".val")];return"true"!==e&&!0!==e||(e=1),"false"!==e&&!1!==e||(e=0),t[e]}return t[0]}}class et extends o.default{constructor(t){super(t),this.showDialog=t=>{this.setState({dialogVisible:t});let e=this.state.rxData.autoclose;!0!==e&&"true"!==e||(e=1e4),null!==e&&void 0!==e&&""!==e&&(e=parseInt(e,10),e<60&&(e*=1e3),e=e||1e3,e&&(t?this.hideTimeout=setTimeout((()=>{this.hideTimeout=null,this.showDialog(!1)}),e):this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)))},this.state.width=0,this.state.height=0,this.state.dialogVisible=!1,this.state.showPassword=!1,this.state.password="",this.refButton=a().createRef(),this.refDialog=a().createRef()}static getWidgetInfo(){return{id:"tplJquiButtonLink",visSet:"jqui",visName:"Button Link",visSetLabel:"jqui_set_label",visWidgetLabel:"jqui_button_link",visPrev:"widgets/jqui/img/Prev_ButtonLink.png",visOrder:1,visAttrs:[{name:"common",fields:[{name:"buttontext",type:"text",default:"URL",hidden:t=>!!t.html||!(!t.buttontext_view||!t.nav_view)||!!t.externalDialog},{name:"html",type:"html",default:"",tooltip:"jqui_html_tooltip",disabled:t=>!!t.buttontext||!!t.icon||!!t.src||!!t.externalDialog},{name:"Password",type:"password",label:"password",tooltip:"jqui_password_tooltip",disabled:t=>!t.nav_view&&!t.url&&!t.href&&!t.html_dialog&&!t.contains_view}]},{name:"view",label:"jqui_view_group",hidden:t=>!!t.url||!!t.href||!!t.html_dialog||!!t.contains_view,fields:[{name:"nav_view",label:"jqui_nav_view",type:"views"},{name:"buttontext_view",label:"jqui_buttontext_view",type:"checkbox",hidden:t=>!t.nav_view},{name:"sub_view",label:"basic_sub_view",type:"text",tooltip:"sub_view_tooltip",hidden:t=>!t.nav_view}]},{name:"URL",label:"jqui_url_group",hidden:t=>!!t.html_dialog||!!t.contains_view||!!t.nav_view,fields:[{name:"href",label:"jqui_url_in_browser",type:"url",hidden:t=>!!t.url,tooltip:"jqui_href_tooltip"},{name:"url",label:"jqui_url_in_background",type:"url",hidden:t=>!!t.href,tooltip:"jqui_url_tooltip"},{name:"target",type:"auto",options:["_blank","_self","_parent","_top"],hidden:t=>!!t.url||!t.href}]},{name:"style",label:"Style",hidden:t=>!!t.externalDialog,fields:[{name:"no_style",type:"checkbox",hidden:t=>t.jquery_style},{name:"jquery_style",label:"jqui_jquery_style",type:"checkbox",hidden:t=>t.no_style},{name:"padding",type:"slider",min:0,max:100,default:5},{name:"variant",label:"jqui_variant",type:"select",noTranslation:!0,options:["contained","outlined","standard"],default:"contained",hidden:t=>t.jquery_style||t.no_style},{name:"color",label:"jqui_button_color",type:"select",noTranslation:!0,options:["","primary","secondary"],default:"",hidden:t=>t.jquery_style||t.no_style},{name:"html_prepend",type:"html"},{name:"html_append",type:"html"},{name:"visResizable",label:"visResizable",type:"checkbox",default:!1,desiredSize:!1}]},{name:"icon",hidden:t=>!!t.externalDialog||t.jquery_style,fields:[{name:"src",label:"jqui_image",type:"image",hidden:t=>t.icon},{name:"icon",label:"jqui_icon",type:"icon64",hidden:t=>t.src},{name:"invert_icon",type:"checkbox",hidden:t=>!t.icon&&!t.src},{name:"imageHeight",type:"slider",min:0,max:200,default:100,hidden:t=>!t.src}]},{name:"dialog",hidden:t=>!!t.url||!!t.href||!!t.nav_view,fields:[{name:"html_dialog",type:"html",hidden:t=>!!t.contains_view},{name:"contains_view",type:"views",hidden:t=>!!t.html_dialog},{name:"title",type:"text",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"autoclose",type:"slider",min:0,max:3e4,step:100,hidden:t=>!t.html_dialog&&!t.contains_view},{name:"modal",type:"checkbox",default:!0,hidden:t=>!t.html_dialog&&!t.contains_view},{name:"dialog_width",type:"text",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"dialog_height",type:"text",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"dialog_class",label:"CSS Class",type:"text",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"persistent",type:"checkbox",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"preload",type:"checkbox",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"closeOnClick",type:"checkbox",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"hideCloseButton",label:"jqui_hide_close_button",type:"checkbox",hidden:t=>!t.html_dialog&&!t.contains_view&&!!t.closeOnClick},{name:"dialogBackgroundColor",label:"Background color",type:"color",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"dialogTitleColor",type:"color",label:"Text color",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"overflowX",type:"select",noTranslation:!0,options:["","auto","hidden","visible","scroll","initial","inherit"],hidden:t=>!t.html_dialog&&!t.contains_view},{name:"overflowY",type:"select",noTranslation:!0,options:["","auto","hidden","visible","scroll","initial","inherit"],hidden:t=>!t.html_dialog&&!t.contains_view},{name:"setId",type:"id",tooltip:"jqui_dialog_set_id_tooltip",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"setValue",type:"text",hidden:t=>!t.setId||!t.html_dialog&&!t.contains_view},{name:"dialogName",label:"jqui_dialog_name",type:"text",hidden:t=>!t.html_dialog&&!t.contains_view},{name:"externalDialog",label:"jqui_external_dialog",tooltip:"jqui_external_dialog_tooltip",type:"checkbox",hidden:t=>!t.html_dialog&&!t.contains_view}]}]}}static findField(t,e){return o.default.findField(t,e)}getWidgetInfo(){return et.getWidgetInfo()}async componentDidMount(){super.componentDidMount(),await this.componentDidUpdate()}async componentWillUnmount(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=null,super.componentWillUnmount()}async componentDidUpdate(){if(this.refButton.current&&(this.state.rxData.jquery_style&&!this.refButton.current._jQueryDone&&(this.refButton.current._jQueryDone=!0,window.jQuery(this.refButton.current).button()),this.refButton.current.clientWidth===this.state.width&&this.refButton.current.clientHeight===this.state.height||this.setState({width:this.refButton.current.clientWidth,height:this.refButton.current.clientHeight})),this.refService.current&&(this.state.rxData.html_dialog||this.state.rxData.contains_view)&&!this.refService.current._showDialog&&(this.refService.current._showDialog=this.showDialog),this.refService.current){(this.refService.current.dataset.dialogName||"")!==(this.state.rxData.dialogName||"")&&(this.state.rxData.dialogName?this.refService.current.dataset.dialogName=this.state.rxData.dialogName:delete this.refService.current.dataset.dialogName)}}onPasswordEnter(){this.state.password===this.state.rxData.Password?this.setState({showPassword:!1},(()=>this.onClick(!0))):(window.alert(f.I18n.t("Wrong password")),this.setState({passwordError:!0},(()=>{setTimeout((()=>this.setState({passwordError:!1})),3e3)})))}renderPasswordDialog(){return this.state.showPassword?(0,n.jsxs)(b.Dialog,{open:!0,onClose:()=>this.setState({showPassword:!1}),children:[(0,n.jsx)(b.DialogTitle,{children:f.I18n.t("Enter password")}),(0,n.jsx)(b.DialogContent,{children:(0,n.jsx)(b.TextField,{label:f.I18n.t("Password"),error:this.state.passwordError,helperText:this.state.passwordError?f.I18n.t("Wrong password"):null,type:"password",autoFocus:!0,fullWidth:!0,variant:"standard",value:this.state.password||"",onChange:t=>this.setState({password:t.target.value}),onKeyUp:t=>13===t.keyCode&&this.onPasswordEnter()})}),(0,n.jsxs)(b.DialogActions,{children:[(0,n.jsx)(b.Button,{disabled:!this.state.password,startIcon:(0,n.jsx)(E.Check,{}),onClick:t=>{t.stopPropagation(),t.preventDefault(),this.onPasswordEnter()},color:"primary",variant:"contained",children:f.I18n.t("Enter")}),(0,n.jsx)(b.Button,{startIcon:(0,n.jsx)(E.Close,{}),onClick:t=>{t.stopPropagation(),t.preventDefault(),this.setState({showPassword:!1})},color:"grey",variant:"contained",children:f.I18n.t("Cancel")})]})]}):null}async setObjectWithState(t,e){if(void 0!==this.setObjectType)"boolean"===this.setObjectType?e="true"===e||!0===e||"1"===e||1===e||"on"===e||"ON"===e:"number"===this.setObjectType?e=parseFloat(e):null!==e&&void 0!==e&&(e=e.toString()),await this.props.context.setValue(t,e);else try{var i;const s=await this.props.context.socket.getObject(t);this.setObjectType=(null===s||void 0===s||null===(i=s.common)||void 0===i?void 0:i.type)||"string",await this.setObjectWithState(t,e)}catch(s){console.warn("Object ".concat(t," not found: ").concat(s))}}onCommand(t){return super.onCommand(t),"openDialog"===t?(this.showDialog(!0),!0):"closeDialog"===t&&(this.showDialog(!1),!0)}onClick(t){this.state.dialogVisible||(t||!this.state.rxData.Password?(this.state.rxData.nav_view?this.props.context.changeView(this.state.rxData.nav_view):!this.props.editMode&&this.state.rxData.href?this.state.rxData.target||"tplJquiButtonLinkBlank"===this.props.tpl&&void 0===this.state.rxData.target?window.open(this.state.rxData.href,this.state.rxData.target):window.location.href=this.state.rxData.href:this.state.rxData.url&&this.props.socket.getRawSocket().emit("httpGet",this.state.rxData.url,(t=>console.log("httpGet",this.state.rxData.url,t))),(this.state.rxData.html_dialog||this.state.rxData.contains_view)&&(this.state.rxData.setId&&this.setObjectWithState(this.state.rxData.setId,this.state.rxData.setValue).catch((t=>console.warn("Cannot set state: ".concat(t)))),this.showDialog(!0))):this.props.editMode?window.alert(f.I18n.t("Ignored in edit mode")):this.setState({showPassword:!0,password:""}))}renderRxDialog(t,e){if(console.log("test"),this.state.rxData.modal)return console.log("in"),(0,n.jsx)(b.Dialog,{maxWidth:"xl",id:"".concat(this.props.id,"_dialog"),ref:this.refDialog,open:this.state.dialogVisible,onClick:()=>{this.state.rxData.closeOnClick&&this.showDialog(!1)},children:(0,n.jsxs)("div",{style:{backgroundColor:this.state.rxData.dialogBackgroundColor},children:[this.state.rxData.title?(0,n.jsx)(b.DialogTitle,{sx:{color:this.state.rxData.dialogTitleColor},children:this.state.rxData.title}):null,this.state.rxData.hideCloseButton&&this.state.rxData.closeOnClick?null:(0,n.jsx)(b.IconButton,{sx:{color:this.state.rxData.dialogTitleColor},style:{position:"absolute",top:0,right:0,zIndex:800},onClick:()=>this.showDialog(!1),children:(0,n.jsx)(E.Close,{})}),(0,n.jsx)(b.DialogContent,{children:e})]})});this.state.dialogVisible||(t.display="none"),(!t.minWidth||t.minWidth<200)&&(t.minWidth=200),(!t.minHeight||t.minHeight<100)&&(t.minHeight=100),t.backgroundColor="blue";const i={...t};return delete i.top,delete i.left,i.padding=this.state.rxData.title?"0 24px 24px 24px":"26px 24px 24px 24px",(0,n.jsx)(b.Popper,{open:this.state.dialogVisible,id:"".concat(this.props.id,"_dialog"),ref:this.refDialog,anchorEl:this.refButton.current,style:t,onClick:()=>{this.state.rxData.closeOnClick&&this.showDialog(!1)},children:(0,n.jsxs)(b.Paper,{style:{...i,background:"red !important"},children:[this.state.rxData.title?(0,n.jsx)(b.DialogTitle,{style:{padding:"16px 0 0 0"},children:(0,n.jsx)("div",{children:this.state.rxData.title})}):null,(0,n.jsx)(b.IconButton,{style:{position:"absolute",top:0,right:0,zIndex:800},onClick:()=>this.showDialog(!1),children:(0,n.jsx)(E.Close,{})}),(0,n.jsx)(b.DialogContent,{children:e})]})})}renderJQueryDialog(t,e){return(0,n.jsx)("div",{id:"".concat(this.props.id,"_dialog"),className:"vis-widget-dialog",title:this.state.rxData.title,style:t,ref:this.refDialog,children:this.state.rxData.preload?e:null})}renderDialog(){if(this.props.editMode||!this.state.dialogVisible&&!this.state.rxData.persistent&&!this.state.rxData.externalDialog||!this.state.rxData.html_dialog&&!this.state.rxData.contains_view)return null;const t=(0,l.Ny)(this.state.rxData.dialog_width)?parseFloat(this.state.rxData.dialog_width):this.state.rxData.dialog_width,e=(0,l.Ny)(this.state.rxData.dialog_height)?parseFloat(this.state.rxData.dialog_height):this.state.rxData.dialog_height,i={minWidth:t||window.innerWidth-50,minHeight:e||window.innerHeight-50,overflowX:this.state.rxData.overflowX,overflowY:this.state.rxData.overflowY};let s;return s=this.state.rxData.contains_view?(0,n.jsx)("div",{style:i,className:this.state.rxData.dialog_class,children:super.getWidgetView(this.state.rxData.contains_view)}):(0,n.jsx)("div",{style:i,className:this.state.rxData.dialog_class,dangerouslySetInnerHTML:{__html:this.state.rxData.html_dialog}}),this.state.rxData.jquery_style,this.renderRxDialog(i,s)}renderWidgetBody(t){super.renderWidgetBody(t);const e={marginRight:4,filter:this.state.rxData.invert_icon?"invert(1)":void 0};!this.state.rxData.jquery_style&&this.state.rxData.src&&(this.state.width>this.state.height?(e.height="".concat(this.state.rxData.imageHeight||100,"%"),e.width="auto"):(e.width="".concat(this.state.rxData.imageHeight||100,"%"),e.height="auto"));let i=!this.state.rxData.jquery_style&&(this.state.rxData.src||this.state.rxData.icon);i&&i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/")));const s=i?(0,n.jsx)(f.Icon,{src:i,style:e}):null,a={textTransform:"none"};Object.keys(this.state.rxStyle).forEach((t=>{const e=this.state.rxStyle[t];null!==e&&void 0!==e&&o.default.POSSIBLE_MUI_STYLES.includes(t)&&(t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),a[t]=e)}));let r,l,d=this.state.data.visResizable;if(void 0!==d&&null!==d||"tplJquiButtonNav"!==this.props.tpl&&"tplJquiNavPw"!==this.props.tpl&&"tplContainerDialog"!==this.props.tpl&&"tplContainerIconDialog"!==this.props.tpl&&"tplJquiDialog"!==this.props.tpl&&"tplJquiIconDialog"!==this.props.tpl&&"tplIconHttpGet"!==this.props.tpl&&"tplIconLink"!==this.props.tpl&&"tplJquiIconNav"!==this.props.tpl||(d=!0),d?(a.width="100%",a.height="100%"):a.padding=this.state.rxData.padding,this.state.rxData.html);else if(this.state.rxData.nav_view&&this.state.rxData.buttontext_view){var c,h;r=(null===(c=this.props.context.views[this.state.rxData.nav_view])||void 0===c||null===(h=c.settings)||void 0===h?void 0:h.navigationTitle)||this.state.rxData.nav_view}else r=void 0===this.state.rxData.buttontext?this.state.rxData.text||"":this.state.rxData.buttontext;return l=this.state.rxData.externalDialog?this.props.editMode?(0,n.jsxs)("div",{style:{width:"100%",height:"100%",border:"2px dashed red",backgroundColor:"grey",color:"white",boxSizing:"border-box"},children:[(0,n.jsx)(b.IconButton,{style:{position:"absolute",bottom:0,right:0,opacity:.4},className:this.props.context.editModeComponentClass,onClick:t=>{t.stopPropagation(),t.preventDefault();const e="setState('".concat(this.props.context.adapterName,".").concat(this.props.context.instance,".control.command', '").concat(JSON.stringify({command:"dialog",instance:window.localStorage.getItem("visInstance"),data:this.state.rxData.dialogName||this.props.id}),"')");window.alert(f.I18n.t("Copied %s",e)),f.Utils.copyToClipboard(e)},children:(0,n.jsx)(f.IconCopy,{})}),(0,n.jsx)("div",{children:f.I18n.t("External dialog")}),(0,n.jsx)("div",{children:this.state.rxData.html_dialog?"HTML":"View: ".concat(this.state.rxData.contains_view)}),(0,n.jsx)("div",{children:"Name: ".concat(this.state.rxData.dialogName?"".concat(this.state.rxData.dialogName," (").concat(this.props.id,")"):this.props.id)}),(0,n.jsx)("div",{style:{fontSize:10},children:f.I18n.t("You can open dialog with following script:")}),(0,n.jsx)("div",{style:{fontSize:10},children:"setState('".concat(this.props.context.adapterName,".").concat(this.props.context.instance,".control.command', '").concat(JSON.stringify({command:"dialog",instance:window.localStorage.getItem("visInstance"),data:this.state.rxData.dialogName||this.props.id}),"')")})]}):null:[this.state.rxData.html_prepend?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_prepend}},"prepend"):null,this.state.rxData.html?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html}},"content"):this.state.rxData.no_style||this.state.rxData.jquery_style?(0,n.jsxs)("button",{className:this.state.rxData.nav_view&&this.state.rxData.nav_view===window.location.hash.slice(1)?"ui-state-active":void 0,ref:this.refButton,type:"button",style:a,onClick:()=>this.onClick(),children:[s,r]},"content"):(0,n.jsxs)(b.Button,{ref:this.refButton,style:a,color:this.state.rxData.nav_view&&this.state.rxData.nav_view===window.location.hash.slice(1)?"primary"===this.state.rxData.color?"secondary":"primary":this.state.rxData.color||"grey",variant:void 0===this.state.rxData.variant?"contained":this.state.rxData.variant,onClick:()=>this.onClick(),children:[s,r]},"content"),this.state.rxData.html_append?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append}},"append"):null],(0,n.jsxs)("div",{className:"vis-widget-body",onClick:this.state.rxData.html?()=>this.onClick():void 0,children:[l,this.renderDialog(),this.renderPasswordDialog()]})}}et.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const it=et;class st extends it{static getWidgetInfo(){const t={id:"tplJquiButtonLinkBlank",visSet:"jqui",visName:"Button Link",visWidgetLabel:"jqui_button_link_blank",visPrev:"widgets/jqui/img/Prev_ButtonLinkBlank.png",visOrder:2,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"target").default="_blank";it.findField(t,"visResizable").default=!1;return it.findField(t,"buttontext").default="URL Browser",t}getWidgetInfo(){return st.getWidgetInfo()}}st.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const at=st;class ot extends it{static getWidgetInfo(){const t={id:"tplIconLink",visSet:"jqui",visName:"Button Link",visWidgetLabel:"jqui_icon_link",visPrev:"widgets/jqui/img/Prev_IconLink.png",visOrder:3,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"target").default="_blank";return it.findField(t,"visResizable").default=!0,t}getWidgetInfo(){return ot.getWidgetInfo()}}ot.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const nt=ot;class rt extends o.default{constructor(t){super(t),this.state.value="",this.state.valueType=null}static getWidgetInfo(){return{id:"tplIconState",visSet:"jqui",visName:"Icon State",visWidgetLabel:"jqui_write_value",visPrev:"widgets/jqui/img/Prev_WriteState.png",visOrder:26,visAttrs:[{name:"common",fields:[{name:"oid",type:"id",onChange:async(t,e,i,s)=>{if(e[t.name]&&"nothing_selected"!==e[t.name]){var a,o,n,r;const c=await s.getObject(e[t.name]);let h=!1;var l,d;if(void 0!==(null===c||void 0===c||null===(a=c.common)||void 0===a?void 0:a.min)&&null!==(null===c||void 0===c||null===(o=c.common)||void 0===o?void 0:o.min)&&e.min!==c.common.min&&(e.min=c.common.min,h=!0),void 0!==(null===c||void 0===c||null===(n=c.common)||void 0===n?void 0:n.max)&&null!==(null===c||void 0===c||null===(r=c.common)||void 0===r?void 0:r.max)&&(e.max!==c.common.max&&(e.max=c.common.max,h=!0),e.step>0?e.minmax!==c.common.max&&(e.minmax=c.common.max,h=!0):e.minmax!==c.common.min&&(e.minmax=c.common.min,h=!0)),!e.step)void 0!==(null===c||void 0===c||null===(l=c.common)||void 0===l?void 0:l.step)&&null!==(null===c||void 0===c||null===(d=c.common)||void 0===d?void 0:d.step)&&e.step!==c.common.step&&(e.step=c.common.step,h=!0);h&&i(e)}}},{name:"click_id",type:"id",noSubscribe:!0},{name:"type",label:"jqui_type",type:"select",default:"value",options:[{value:"value",label:"jqui_from_value"},{value:"oid",label:"jqui_from_oid"},{value:"toggle",label:"jqui_toggle"},{value:"change",label:"jqui_increment_decrement"}]},{name:"value_oid",type:"id",hidden:t=>"oid"!==t.type},{name:"value",type:"text",hidden:t=>"value"!==t.type},{name:"step",type:"number",hidden:t=>"change"!==t.type,default:1},{name:"minmax",label:"jqui_max",type:"number",hidden:t=>"change"!==t.type||(parseFloat(t.step)||0)<0,default:1},{name:"minmax",label:"jqui_min",type:"number",hidden:t=>"change"!==t.type||(parseFloat(t.step)||0)>=0,default:1},{name:"repeat_delay",type:"number",label:"jqui_repeat_delay",hidden:t=>"change"!==t.type,default:800},{name:"repeat_interval",type:"number",label:"jqui_repeat_interval",hidden:t=>"change"!==t.type,default:300},{name:"min",type:"number",label:"jqui_min",hidden:t=>"toggle"!==t.type,default:0},{name:"max",label:"jqui_max",type:"number",hidden:t=>"toggle"!==t.type,default:100}]},{name:"style",fields:[{name:"variant",label:"jqui_variant",type:"select",noTranslation:!0,options:["contained","outlined","standard"],default:"contained"},{name:"text",type:"text",default:f.I18n.t("Write state")},{name:"src",type:"image",label:"jqui_image",hidden:t=>!!t.icon},{name:"icon",type:"icon64",label:"jqui_icon",hidden:t=>!!t.src},{name:"text_active",label:"jqui_text_active",type:"text"},{name:"src_active",type:"image",label:"jqui_image_active",hidden:t=>!!t.icon_active},{name:"icon_active",type:"icon64",label:"jqui_icon_active",hidden:t=>!!t.src_active},{name:"invert_icon",type:"checkbox",hidden:t=>!t.icon||!t.src},{name:"invert_icon_active",type:"checkbox",hidden:t=>!t.icon_active||!t.src_active}]}],visDefaultStyle:{width:100,height:40}}}async componentDidMount(){if(await super.componentDidMount(),this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid)try{const t=await this.props.context.socket.getState(this.state.rxData.oid);this.onStateUpdated(this.state.rxData.oid,t)}catch(t){console.error("Cannot get state ".concat(this.state.rxData.oid,": ").concat(t))}}static findField(t,e){return o.default.findField(t,e)}getWidgetInfo(){return rt.getWidgetInfo()}onStateUpdated(t,e){if(t===this.state.rxData.oid&&e){const t=null===e.val||void 0===e.val?"":e.val;this.state.value!==t.toString()&&this.setState({value:t.toString()})}}getControlOid(){return this.state.rxData.click_id&&"nothing_selected"!==this.state.rxData.click_id?this.state.rxData.click_id:this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid?this.state.rxData.oid:""}async onClick(){if(this.props.editMode)return;let t;switch(this.state.rxData.type){case"value":t=this.state.rxData.value.toString();break;case"oid":if(t=this.state.values["".concat(this.state.rxData.value_oid,".val")],void 0===t||null===t)return;break;case"toggle":t=parseFloat(this.state.values["".concat(this.state.rxData.oid,".val")])||0,t=t.toString()===(this.state.rxData.max||0).toString()?this.state.rxData.min:this.state.rxData.max;break;case"change":t=parseFloat(this.state.values["".concat(this.state.rxData.oid,".val")])||0,t+=parseFloat(this.state.rxData.step)||0,this.state.rxData.step>0?t>parseFloat(this.state.rxData.minmax)&&(t=parseFloat(this.state.rxData.minmax)):t<parseFloat(this.state.rxData.minmax)&&(t=parseFloat(this.state.rxData.minmax));break;default:return}const e=this.getControlOid();e&&("number"===this.state.valueType?this.props.context.setValue(e,parseFloat(t)):this.props.context.setValue(e,t)),this.setState({value:t})}renderIcon(t){let e,i,s=null;return t&&(s=this.state.rxData.invert_icon_active,i=this.state.rxData.icon_active||this.state.rxData.src_active,e=this.state.rxData.color_active),i||(i=this.state.rxData.icon||this.state.rxData.src,s=this.state.rxData.invert_icon,e=this.state.rxData.color),i?(i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/"))),(0,n.jsx)(f.Icon,{style:{color:e,filter:s?"invert(100%)":void 0,width:"100%",height:"100%"},src:i},"icon")):null}renderText(t){let e=this.state.rxData.text,i=this.state.rxData.color;return t&&this.state.rxData.color_active&&(i=this.state.rxData.color_active),e||("oid"===this.state.rxData.type?e=this.state.values["".concat(this.state.rxData.value_oid,".val")]:"value"===this.state.rxData.type?e=this.state.rxData.value:"change"===this.state.rxData.type&&(e=this.state.rxData.step,e>0&&(e="+".concat(e)))),e?(0,n.jsx)("span",{style:{color:i},children:e}):null}getIsActive(){let t=this.state.value;switch(void 0!==t&&null!==t||(t=""),this.state.rxData.type){case"value":{let e=this.state.rxData.value;return void 0!==e&&null!==e||(e=""),t.toString()===e.toString()}case"oid":{let e=this.state.values["".concat(this.state.rxData.value_oid,".val")];return void 0!==e&&null!==e||(e=""),t.toString()===e.toString()}case"toggle":return t.toString()===(this.state.rxData.max||0).toString();default:return!1}}async componentWillUnmount(){await super.componentWillUnmount(),this.iterateInterval&&clearInterval(this.iterateInterval),this.iterateInterval=null,this.iterateTimeout&&clearTimeout(this.iterateTimeout),this.iterateTimeout=null}renderWidgetBody(t){super.renderWidgetBody(t);const e=this.getIsActive(),i={};Object.keys(this.state.rxStyle).forEach((t=>{const e=this.state.rxStyle[t];null!==e&&void 0!==e&&o.default.POSSIBLE_MUI_STYLES.includes(t)&&(t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),i[t]=e)}));const s=this.renderText(e),a=(0,n.jsx)(b.Button,{style:{width:"100%",height:"100%"},color:e?"primary":"grey",startIcon:s?this.renderIcon(e):null,onClick:()=>this.onClick(),onMouseDown:()=>{if(this.props.editMode)return;const t=parseInt(this.state.rxData.repeat_delay,10);t&&(this.iterateTimeout&&clearTimeout(this.iterateTimeout),this.iterateTimeout=setTimeout((async()=>{this.iterateTimeout=null,this.iterateInterval&&clearInterval(this.iterateInterval),this.iterateInterval=setInterval((()=>this.onClick()),parseInt(this.state.rxData.repeat_interval,10)||500),await this.onClick()}),t))},onMouseUp:()=>{this.props.editMode||(this.iterateInterval&&clearInterval(this.iterateInterval),this.iterateInterval=null,this.iterateTimeout&&clearTimeout(this.iterateTimeout),this.iterateTimeout=null)},variant:this.state.rxData.variant||"contained",children:s||this.renderIcon(e)});return(0,n.jsx)("div",{className:"vis-widget-body",children:a})}}rt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const lt=rt;class dt extends lt{static getWidgetInfo(){const t={id:"tplIconInc",visSet:"jqui",visName:"Icon Increment",visWidgetLabel:"jqui_icon_increment",visPrev:"widgets/jqui/img/Prev_IconInc.png",visOrder:27,visAttrs:lt.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_write_state_note"});return lt.findField(t,"type").default="change",t}getWidgetInfo(){return dt.getWidgetInfo()}}dt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const ct=dt;class ht extends it{static getWidgetInfo(){const t={id:"tplIconHttpGet",visSet:"jqui",visName:"Icon HTTP GET",visWidgetLabel:"jqui_icon_http_get",visPrev:"widgets/jqui/img/Prev_IconHttpGet.png",visOrder:4,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"url").default="http://";it.findField(t,"buttontext").default="URL Backend";return it.findField(t,"visResizable").default=!0,t}getWidgetInfo(){return ht.getWidgetInfo()}}ht.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const pt=ht;class ut extends it{static getWidgetInfo(){const t={id:"tplJquiDialog",visSet:"jqui",visName:"HTML - Dialog",visWidgetLabel:"jqui_html_dialog",visPrev:"widgets/jqui/img/Prev_JquiDialog.png",visOrder:5,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"visResizable").default=!0;it.findField(t,"html").default="<div>HTML</div>";delete it.findField(t,"buttontext").default;return it.findField(t,"html_dialog").default="<div>HTML Dialog</div>",t.visDefaultStyle={"border-width":1,"border-style":"solid","border-color":"#000",width:"200px",height:"130px",cursor:"pointer"},t}getWidgetInfo(){return ut.getWidgetInfo()}}ut.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const gt=ut;class vt extends it{static getWidgetInfo(){const t={id:"tplJquiIconDialog",visSet:"jqui",visName:"Icon - Dialog",visWidgetLabel:"jqui_icon_dialog",visPrev:"widgets/jqui/img/Prev_JquiIconDialog.png",visOrder:6,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"visResizable").default=!0;it.findField(t,"buttontext").default="Icon Dialog";return it.findField(t,"html_dialog").default="<div>HTML Dialog</div>",t}getWidgetInfo(){return vt.getWidgetInfo()}}vt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const mt=vt;class xt extends it{static getWidgetInfo(){const t={id:"tplContainerDialog",visSet:"jqui",visName:"container - HTML - view in jqui Dialog",visWidgetLabel:"jqui_container_dialog",visPrev:"widgets/jqui/img/Prev_ContainerDialog.png",visOrder:7,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"visResizable").default=!0;it.findField(t,"buttontext").default="Container Dialog";return it.findField(t,"html_dialog").default="<div>HTML Dialog</div>",t}getWidgetInfo(){return xt.getWidgetInfo()}}xt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const ft=xt;class yt extends it{static getWidgetInfo(){const t={id:"tplJquiButtonNav",visSet:"jqui",visName:"Navigation Button",visWidgetLabel:"jqui_navigation_button",visPrev:"widgets/jqui/img/Prev_ButtonNav.png",visOrder:8,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_nav_blank_note"});delete it.findField(t,"modal").default;it.findField(t,"nav_view").default="";it.findField(t,"buttontext").default="View";return it.findField(t,"visResizable").default=!0,t}getWidgetInfo(){return yt.getWidgetInfo()}}yt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const wt=yt;class bt extends it{static getWidgetInfo(){const t={id:"tplJquiIconNav",visSet:"jqui",visName:"Navigation Icon",visWidgetLabel:"jqui_navigation_icon",visPrev:"widgets/jqui/img/Prev_IconNav.png",visOrder:9,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_nav_blank_note"});delete it.findField(t,"buttontext").default;delete it.findField(t,"modal").default;it.findField(t,"nav_view").default="";it.findField(t,"icon").default="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik0yMSAzTDMgMTAuNTN2Ljk4bDYuODQgMi42NUwxMi40OCAyMWguOThMMjEgM3oiLz48L3N2Zz4=";return it.findField(t,"visResizable").default=!0,t}getWidgetInfo(){return bt.getWidgetInfo()}}bt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Dt=bt;class _t extends it{static getWidgetInfo(){const t={id:"tplJquiNavPw",visSet:"jqui",visName:"Navigation with password",visWidgetLabel:"jqui_navigation_password",visPrev:"widgets/jqui/img/Prev_ButtonNavPw.png",visOrder:10,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_nav_blank_note"});delete it.findField(t,"modal").default;it.findField(t,"buttontext").default="Password";it.findField(t,"nav_view").default="";it.findField(t,"Password").default="";return it.findField(t,"visResizable").default=!0,t}getWidgetInfo(){return _t.getWidgetInfo()}}_t.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const St=_t;class It extends it{static getWidgetInfo(){const t={id:"tplContainerDialogExternal",visSet:"jqui",visName:"External Dialog",visWidgetLabel:"jqui_html_external_dialog",visPrev:"widgets/jqui/img/Prev_JquiExternalDialog.png",visOrder:11,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"externalDialog").default=!0;return it.findField(t,"html_dialog").default="<div>HTML Dialog</div>",t}getWidgetInfo(){return It.getWidgetInfo()}}It.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const jt=It;class Ct extends o.default{constructor(t){super(t),this.state.width=0,this.state.height=0}static getWidgetInfo(){return{id:"tplJquiButtonDialogClose",visSet:"jqui",visName:"Button dialog close",visWidgetLabel:"jqui_button_dialog_close",visPrev:"widgets/jqui/img/Prev_ButtonDialogClose.png",visOrder:13,visAttrs:[{name:"common",fields:[{name:"dlgName",label:"jqui_dialog_name",tooltip:"jqui_dialog_name_tooltip",type:"custom",component:(t,e,i,s)=>{const a=[];return Object.keys(s.context.views).forEach((t=>{const e=s.context.views[t].widgets;e&&Object.keys(e).forEach((t=>{var i,s,o;(null!==(i=e[t].data)&&void 0!==i&&i.html_dialog||null!==(s=e[t].data)&&void 0!==s&&s.contains_view||null!==(o=e[t].data)&&void 0!==o&&o.externalDialog)&&(e[t].data.dialogName?a.push({label:"".concat(e[t].data.dialogName," (").concat(t,")"),value:e[t].data.dialogName}):a.push({label:t,value:t}))}))})),(0,n.jsx)(b.Autocomplete,{freeSolo:!0,options:a,variant:"standard",value:e[t.name]||"",sx:{width:"100%"},onInputChange:(e,s)=>{"object"===typeof s&&null!==s&&(s=s.value),i({[t.name]:s})},onChange:(e,s)=>{"object"===typeof s&&null!==s&&(s=s.value),i({[t.name]:s})},getOptionLabel:t=>"string"===typeof t?t:t.label,renderInput:t=>(0,n.jsx)(b.TextField,{variant:"standard",...t})})}},{name:"buttontext",type:"text",default:f.I18n.t("jqui_Close").replace("jqui_",""),hidden:t=>!!t.html},{name:"html",type:"html",default:"",tooltip:"jqui_html_tooltip",disabled:t=>!!t.buttontext||!!t.icon||!!t.src}]},{name:"style",hidden:t=>!!t.externalDialog,fields:[{name:"no_style",type:"checkbox",hidden:t=>t.jquery_style},{name:"jquery_style",label:"jqui_jquery_style",type:"checkbox",hidden:t=>t.no_style},{name:"padding",type:"slider",min:0,max:100,default:5},{name:"variant",label:"jqui_variant",type:"select",noTranslation:!0,options:["contained","outlined","standard"],default:"contained",hidden:t=>t.jquery_style||t.no_style},{name:"color",label:"jqui_button_color",type:"select",noTranslation:!0,options:["","primary","secondary"],default:"",hidden:t=>t.jquery_style||t.no_style},{name:"html_prepend",type:"html"},{name:"html_append",type:"html"},{name:"visResizable",label:"visResizable",type:"checkbox",default:!1,desiredSize:!1}]},{name:"icon",hidden:t=>!!t.html,fields:[{name:"src",label:"jqui_image",type:"image",hidden:t=>t.icon||t.jquery_style},{name:"icon",label:"jqui_icon",type:"icon64",default:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik0xOSA2LjQxTDE3LjU5IDVMMTIgMTAuNTlMNi40MSA1TDUgNi40MUwxMC41OSAxMkw1IDE3LjU5TDYuNDEgMTlMMTIgMTMuNDFMMTcuNTkgMTlMMTkgMTcuNTlMMTMuNDEgMTJ6Ii8+PC9zdmc+",hidden:t=>t.src||t.jquery_style},{name:"invert_icon",type:"checkbox",hidden:t=>(!t.icon||!t.image)&&t.jquery_style},{name:"imageHeight",type:"slider",min:0,max:200,default:100,hidden:t=>!t.src||t.jquery_style}]}]}}getWidgetInfo(){return Ct.getWidgetInfo()}onClick(){let t=this.state.rxData.dlgName;if(!t){const i=Object.keys(this.props.context.views);for(let s=0;s<i.length;s++){const a=this.props.context.views[i[s]].widgets;if(a){const i=Object.keys(a);for(let s=0;s<i.length;s++){var e;if((null===(e=a[i[s]].data)||void 0===e?void 0:e.contains_view)===this.props.view){t=i[s];break}}}if(t)break}}if(t){const e=window.document.getElementById(t)||window.document.querySelector('[data-dialog-name="'.concat(t,'"]')),i=Object.keys(this.props.context.views).find((e=>this.props.context.views[e].widgets[t]));this.props.context.onCommand("closeDialog",i,t),null!==e&&void 0!==e&&e._showDialog?e._showDialog(!1):window.jQuery("#".concat(t,"_dialog")).dialog("close")}else window.alert("Dialog not found")}renderWidgetBody(t){super.renderWidgetBody(t);const e={filter:this.state.rxData.invert_icon?"invert(1)":void 0};!this.state.rxData.jquery_style&&this.state.rxData.src&&(this.state.width>this.state.height?(e.height="".concat(this.state.rxData.imageHeight||100,"%"),e.width="auto"):(e.width="".concat(this.state.rxData.imageHeight||100,"%"),e.height="auto"));let i=!this.state.rxData.jquery_style&&(this.state.rxData.src||this.state.rxData.icon);i&&i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/")));const s=i?(0,n.jsx)(f.Icon,{src:i,style:e}):null,a={};let r;Object.keys(this.state.rxStyle).forEach((t=>{const e=this.state.rxStyle[t];null!==e&&void 0!==e&&o.default.POSSIBLE_MUI_STYLES.includes(t)&&(t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),a[t]=e)})),this.state.data.visResizable?(a.width="100%",a.height="100%"):a.padding=this.state.rxData.padding,this.state.rxData.html||(r=this.state.rxData.buttontext);const l=[this.state.rxData.html_prepend?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_prepend}},"prepend"):null,this.state.rxData.html?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html}},"content"):this.state.rxData.no_style||this.state.rxData.jquery_style?(0,n.jsxs)("button",{type:"button",style:a,onClick:()=>this.onClick(),children:[s,r]},"content"):r?(0,n.jsx)(b.Button,{style:a,color:this.state.rxData.color||"grey",variant:void 0===this.state.rxData.variant?"contained":this.state.rxData.variant,onClick:()=>this.onClick(),startIcon:s,children:r},"content"):(0,n.jsx)(b.Fab,{style:{zIndex:this.props.editMode?0:void 0},color:this.state.rxData.color||"grey",onClick:()=>this.onClick(),size:"small",children:s},"content"),this.state.rxData.html_append?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append}},"append"):null];return(0,n.jsx)("div",{className:"vis-widget-body",onClick:this.state.rxData.html?()=>this.onClick():void 0,children:l})}}Ct.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const kt=Ct;class Wt extends it{static getWidgetInfo(){const t={id:"tplContainerButtonDialog",visSet:"jqui",visName:"container - Button - view in jqui Dialog",visWidgetLabel:"jqui_container_button_dialog",visPrev:"widgets/jqui/img/Prev_ContainerButtonDialog.png",visOrder:11,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"buttontext").default="Container Dialog";return it.findField(t,"contains_view").default="",t}getWidgetInfo(){return Wt.getWidgetInfo()}}Wt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const Mt=Wt;class Tt extends it{static getWidgetInfo(){const t={id:"tplContainerIconDialog",visSet:"jqui",visName:"container - Icon - view in jqui Dialog",visWidgetLabel:"jqui_container_icon_dialog",visPrev:"widgets/jqui/img/Prev_ContainerIconDialog.png",visOrder:12,visAttrs:it.getWidgetInfo().visAttrs};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_link_blank_note"});it.findField(t,"visResizable").default=!0;it.findField(t,"icon").default="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik0xOSAxOUg1VjVoN1YzSDVhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0YzEuMSAwIDItLjkgMi0ydi03aC0ydjd6TTE0IDN2MmgzLjU5bC05LjgzIDkuODNsMS40MSAxLjQxTDE5IDYuNDFWMTBoMlYzaC03eiIvPjwvc3ZnPg==";delete it.findField(t,"buttontext").default;return it.findField(t,"contains_view").default="",t}getWidgetInfo(){return Tt.getWidgetInfo()}}Tt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const Rt=Tt;class Nt extends o.default{constructor(t){super(t),this.state.input="",this.focused=!1,this.inputRef=a().createRef()}static getWidgetInfo(){return{id:"tplJquiInput",visSet:"jqui",visName:"Input",visWidgetLabel:"jqui_input",visPrev:"widgets/jqui/img/Prev_Input.png",visOrder:13,visAttrs:[{name:"common",fields:[{name:"label",type:"text",default:f.I18n.t("jqui_input").replace("jqui_","")},{name:"oid",type:"id",onChange:async(t,e,i,s)=>{if(e[t.name]&&"nothing_selected"!==e[t.name]){var a,o,n;const r=await s.getObject(e[t.name]);let l=!1;null!==r&&void 0!==r&&null!==(a=r.common)&&void 0!==a&&a.unit&&e.unit!==r.common.unit&&(e.unit=r.common.unit,l=!0),"number"!==(null===r||void 0===r||null===(o=r.common)||void 0===o?void 0:o.type)?e.asString||(e.asString=!0,l=!0):"number"===(null===r||void 0===r||null===(n=r.common)||void 0===n?void 0:n.type)&&e.asString&&(e.asString=!1,l=!0),l&&i(e)}}},{name:"asString",type:"checkbox",label:"jqui_as_string"},{name:"autoFocus",type:"checkbox",min:0,max:5},{name:"readOnly",type:"checkbox",label:"jqui_read_only"},{name:"withEnter",type:"checkbox",label:"jqui_with_enter_button",hidden:"!!data.readOnly"},{name:"buttontext",type:"text",label:"jqui_button_text",hidden:"!data.withEnter || !!data.readOnly"},{name:"selectAllOnFocus",type:"checkbox",label:"jqui_select_all_on_focus",tooltip:"jqui_select_all_on_focus_tooltip"},{name:"unit",type:"text",label:"jqui_unit"}]},{name:"style",hidden:t=>!!t.externalDialog,fields:[{name:"no_style",type:"checkbox",hidden:t=>t.jquery_style},{name:"jquery_style",label:"jqui_jquery_style",type:"checkbox",hidden:t=>t.no_style},{name:"variant",label:"jqui_variant",type:"select",noTranslation:!0,options:["filled","outlined","standard"],default:"standard",hidden:t=>t.jquery_style||t.no_style},{name:"size",type:"slider",min:4,max:100,default:10,hidden:t=>!t.no_style}]}]}}getWidgetInfo(){return Nt.getWidgetInfo()}static findField(t,e){return super.findField(t,e)}async componentDidMount(){super.componentDidMount();try{const t=await this.props.context.socket.getState(this.state.rxData.oid);t&&void 0!==t.val&&null!==t.val&&(t.val=t.val.toString(),this.setState({input:t.val}))}catch(t){console.error("Cannot get state ".concat(this.state.rxData.oid,": ").concat(t))}this.inputRef.current&&this.state.rxData.autoFocus&&!this.props.editMode&&(this.state.rxData.jquery_style||this.state.rxData.no_style)&&setTimeout((()=>this.inputRef.current.focus()),100)}onStateUpdated(t,e){super.onStateUpdated(t,e),(null!==e&&void 0!==e&&e.val||0===(null===e||void 0===e?void 0:e.val))&&(t!==this.state.rxData.oid||this.focused||e.val.toString()!==this.state.input.toString()&&this.setState({input:e.val}))}async componentDidUpdate(){this.inputRef.current&&this.state.rxData.jquery_style&&!this.inputRef.current._jQueryDone&&(this.inputRef.current._jQueryDone=!0,window.jQuery(this.inputRef.current).button().addClass("ui-state-default"))}async setValue(t){var e,i,s;((null===(e=this.object)||void 0===e?void 0:e._id)===this.state.rxData.oid||(this.object=await this.props.context.socket.getObject(this.state.rxData.oid),this.object))&&("number"===(null===(i=this.object)||void 0===i||null===(s=i.common)||void 0===s?void 0:s.type)&&(t=parseFloat(t.replace(",",".")),Number.isNaN(t)&&(t=0)),await this.props.context.setValue(this.state.rxData.oid,t))}onChange(t){this.setState({input:t}),this.state.rxData.withEnter||this.setValue(t)}renderWidgetBody(t){let e;super.renderWidgetBody(t),t.style.overflow="visible";const i=void 0===this.state.rxData.label?this.state.rxData.title:this.state.rxData.label;return e=this.state.rxData.jquery_style||this.state.rxData.no_style?[(0,n.jsx)("div",{style:{marginRight:8},children:i},"label"),(0,n.jsx)("input",{style:{flexGrow:1},readOnly:this.state.rxData.readOnly,value:this.state.input||"",ref:this.inputRef,size:this.state.rxData.size||10,onFocus:t=>{this.focused=!0,this.state.rxData.selectAllOnFocus&&t.target.select()},onBlur:()=>this.focused=!1,onChange:t=>this.onChange(t.target.value)},"input"),this.state.rxData.withEnter&&!this.state.rxData.readOnly?(0,n.jsx)(b.IconButton,{style:{marginRight:5},onClick:()=>this.setValue(this.state.input),edge:"end",children:(0,n.jsx)(E.KeyboardReturn,{})},"button"):void 0]:(0,n.jsx)(b.TextField,{fullWidth:!0,value:null===this.state.input||void 0===this.state.input?"":this.state.rxData.asString?this.state.input.toString():this.state.input,type:this.state.rxData.asString?"text":"number",onFocus:t=>{this.focused=!0,this.state.rxData.selectAllOnFocus&&t.target.select()},onBlur:()=>this.focused=!1,autoFocus:!this.props.editMode&&this.state.rxData.autoFocus,variant:void 0===this.state.rxData.variant?"standard":this.state.rxData.variant,inputProps:{readOnly:this.state.rxData.readOnly},InputProps:{endAdornment:this.state.rxData.withEnter&&!this.state.rxData.readOnly?(0,n.jsx)(b.InputAdornment,{position:"end",children:this.state.rxData.buttontext?(0,n.jsx)(b.Button,{onClick:()=>this.setValue(this.state.input),variant:"contained",style:{marginBottom:10,minWidth:40},children:this.state.rxData.buttontext}):(0,n.jsx)(b.IconButton,{onClick:()=>this.setValue(this.state.input),edge:"end",children:(0,n.jsx)(E.KeyboardReturn,{})})}):void 0,startAdornment:this.state.rxData.unit?(0,n.jsx)(b.InputAdornment,{position:"start",children:this.state.rxData.unit}):void 0},label:i,onChange:t=>this.onChange(t.target.value)}),(0,n.jsx)("div",{className:"vis-widget-body",style:{display:"flex",alignItems:"center"},children:e})}}Nt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const qt=Nt;class Ot extends qt{static getWidgetInfo(){const t={id:"tplJquiInputSet",visSet:"jqui",visName:"Input + Button",visWidgetLabel:"jqui_input_with_button",visPrev:"widgets/jqui/img/Prev_InputWithButton.png",visOrder:14,visAttrs:qt.getWidgetInfo().visAttrs,visDefaultStyle:{width:150,height:45}};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_input_note"});const e=qt.findField(t,"withEnter");e&&(e.default=!0);const i=qt.findField(t,"buttontext");return i&&(i.default="OK"),t}getWidgetInfo(){return Ot.getWidgetInfo()}}Ot.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const At=Ot;class Ft extends o.default{constructor(t){super(t),this.state.isOn=!1,this.state.height=0,this.state.width=0}static getWidgetInfo(){return{id:"tplJquiBool",visSet:"jqui",visName:"Html Bool",visWidgetLabel:"jqui_binary_control",visPrev:"widgets/jqui/img/Prev_BinaryControl.png",visOrder:14,visAttrs:[{name:"common",fields:[{name:"type",label:"jqui_type",type:"select",noTranslation:!0,default:"button",options:["button","round-button","html","radio","checkbox","image","switch"]},{name:"oid",type:"id"},{name:"readOnly",type:"checkbox"},{name:"pushMode",type:"checkbox",label:"jqui_push_mode",tooltip:"jqui_push_mode_tooltip",hidden:t=>"button"!==t.type&&"round-button"!==t.type&&"image"!==t.type},{name:"click_id",type:"id",noSubscribe:!0,hidden:t=>!!t.readOnly},{name:"invert",label:"jqui_inverted",type:"checkbox"},{name:"test",type:"select",label:"jqui_test",options:[{value:"",label:"none"},{value:!0,label:"jqui_true"},{value:!1,label:"jqui_false"}]}]},{name:"html",label:"jqui_html",hidden:t=>"html"!==t.type,fields:[{name:"html_true",type:"html",label:"jqui_html_true"},{name:"html_false",type:"html",label:"jqui_html_false"}]},{name:"text",label:"group_text",fields:[{name:"text_false",type:"text",label:"text_false",default:f.I18n.t("jqui_off").replace("jqui_",""),hidden:t=>"image"===t.type||"html"===t.type},{name:"text_true",type:"text",label:"text_true",default:f.I18n.t("jqui_on").replace("jqui_",""),hidden:t=>"image"===t.type||"html"===t.type||"round-button"===t.type},{name:"color_false",type:"color",label:"color_false",hidden:t=>"image"===t.type||"html"===t.type||!t.text_false},{name:"color_true",type:"color",label:"color_true",hidden:t=>"image"===t.type||"html"===t.type||!t.text_true},{name:"alt_false",type:"text",label:"alt_false"},{name:"alt_true",type:"text",label:"alt_true"},{name:"equal_text_length",type:"checkbox",label:"jqui_equal_text_length",tooltip:"jqui_equal_text_length_tooltip",hidden:t=>!t.text_true||!t.text_false}]},{name:"style",fields:[{name:"jquery_style",label:"jqui_jquery_style",type:"checkbox",hidden:t=>"button"!==t.type},{name:"padding",type:"slider",min:0,max:100,default:5},{name:"variant",label:"jqui_variant",type:"select",noTranslation:!0,options:["contained","outlined","standard"],default:"contained",hidden:t=>"button"!==t.type&&"radio"!==t.type},{name:"orientation",label:"jqui_orientation",type:"select",noTranslation:!0,options:["horizontal","vertical"],default:"horizontal",hidden:t=>"radio"!==t.type},{name:"notEqualLength",label:"jqui_not_equal_length",type:"checkbox",hidden:t=>"radio"!==t.type||"horizontal"!==t.orientation},{name:"html_prepend",type:"html"},{name:"html_append",type:"html"}]},{name:"icon_false",label:"group_icon_false",fields:[{name:"src_false",label:"jqui_image",type:"image",hidden:t=>t.icon_false},{name:"icon_false",label:"jqui_icon",type:"icon64",hidden:t=>t.src_false},{name:"icon_color_false",label:"jqui_color",type:"color",hidden:t=>!t.icon_false},{name:"invert_icon_false",label:"jqui_invert_icon",type:"checkbox",hidden:t=>!t.src_false&&!t.icon_false},{name:"imageHeight_false",label:"jqui_image_height",type:"slider",min:0,max:200,hidden:t=>!t.src_false&&!t.icon_false}]},{name:"icon_true",label:"group_icon_true",fields:[{name:"src_true",label:"jqui_image",type:"image",hidden:t=>t.icon_true},{name:"icon_true",label:"jqui_icon",type:"icon64",hidden:t=>t.src_true},{name:"icon_color_true",label:"jqui_color",type:"color",hidden:t=>!t.icon_true&&!t.icon_false},{name:"invert_icon_true",label:"jqui_invert_icon",type:"checkbox",hidden:t=>!t.src_true&&!t.icon_true},{name:"imageHeight_true",label:"jqui_image_height",type:"slider",min:0,max:200,hidden:t=>!t.src_true&&!t.icon_true}]}]}}async componentDidMount(){if(await super.componentDidMount(),("tplIconStateBool"===this.props.tpl||"tplIconStatePushButton"===this.props.tpl)&&(this.state.data.false_text||this.state.data.true_text)){const t=JSON.parse(JSON.stringify(this.state.data));t.text_false=t.false_text,t.text_true=t.true_text,t.src_false=t.false_src,t.src_true=t.true_src,t.alt_false=t.false_alt,t.alt_true=t.true_alt,t.invert_icon_false=t.invert_icon,t.invert_icon_true=t.invert_icon,"tplIconStatePushButton"===this.props.tpl&&(t.pushMode=!0),t.false_text=null,t.true_text=null,setTimeout((()=>this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,data:t}])),100)}if(this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid)try{const t=await this.props.context.socket.getState(this.state.rxData.oid);this.onStateUpdated(this.state.rxData.oid,t)}catch(t){console.error("Cannot get state ".concat(this.state.rxData.oid,": ").concat(t))}}static findField(t,e){return o.default.findField(t,e)}getWidgetInfo(){return Ft.getWidgetInfo()}onStateUpdated(t,e){if(t===this.state.rxData.oid&&e){const t=!0===e.val||"true"===e.val||1===e.val||"1"===e.val||"on"===e.val||"ON"===e.val||"On"===e.val;this.state.isOn!==t&&this.setState({isOn:t})}}getControlOid(){return this.state.rxData.click_id&&"nothing_selected"!==this.state.rxData.click_id?this.state.rxData.click_id:this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid?this.state.rxData.oid:""}onClick(t){if(this.state.rxData.readOnly||this.props.editMode)return;!1!==t&&!0!==t&&(t=!this.isOn());const e=this.getControlOid();e&&this.props.context.setValue(e,t),this.setState({isOn:t})}onMyMouseDown(){const t=this.getControlOid();t&&this.props.context.setValue(t,!this.state.rxData.invert),this.setState({isOn:!0})}onMyMouseUp(){const t=this.getControlOid();t&&this.props.context.setValue(t,!!this.state.rxData.invert),this.setState({isOn:!1})}isOn(){let t;return t=!this.props.editMode||!0!==this.state.rxData.test&&!1!==this.state.rxData.test?this.state.isOn:this.state.rxData.test,void 0!==t&&null!==t||(t=!1),this.state.rxData.invert&&(t=!t),t}renderIcon(t,e){let i,s,a,o;t&&(i=this.state.rxData.src_true||this.state.rxData.icon_true,i&&(s=this.state.rxData.invert_icon_true,a=this.state.rxData.imageHeight_true),o=this.state.rxData.icon_color_true),i||t&&e||(i=this.state.rxData.src_false||this.state.rxData.icon_false,i&&(s=this.state.rxData.invert_icon_false,a=this.state.rxData.imageHeight_false,o=o||this.state.rxData.icon_color_false));const r={};return s&&(r.filter="invert(1)"),o&&(r.color=o),a?(r.height=a,r.width="auto"):this.state.width&&"image"===this.state.rxData.type?this.state.width<this.state.height?(r.width="calc(100% - ".concat(2*(this.state.rxData.padding||0),"px)"),r.height="auto",r.maxHeight="100%"):(r.height="calc(100% - ".concat(2*(this.state.rxData.padding||0),"px)"),r.width="auto",r.maxWidth="100%"):"round-button"===this.state.rxData.type?this.state.width<this.state.height?(r.width="calc(70% - ".concat(2*(this.state.rxData.padding||0),"px)"),r.height="auto",r.maxHeight="100%"):(r.height="calc(70% - ".concat(2*(this.state.rxData.padding||0),"px)"),r.width="auto",r.maxWidth="100%"):this.state.width<this.state.height?(r.width="calc(100% - ".concat(2*(this.state.rxData.padding||0),"px)"),r.height="auto",r.maxHeight="100%"):(r.height="calc(100% - ".concat(2*(this.state.rxData.padding||0),"px)"),r.width="auto",r.maxWidth="100%"),this.state.rxData.padding&&(r.padding=this.state.rxData.padding),i?(i.startsWith("_PRJ_NAME/")&&(i=i.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/"))),(0,n.jsx)(f.Icon,{style:r,src:i},"icon")):null}getTextWidth(t){if(!this.refService.current)return 14*t;if(this.textsLengthCache=this.textsLengthCache||{},this.textsLengthCache[t])return this.textsLengthCache[t];const e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.height="auto",e.style.width="auto",e.innerHTML=t,this.refService.current.appendChild(e);const i=e.clientWidth;return this.refService.current.removeChild(e),this.textsLengthCache[t]=i,i}renderText(t){let e,i;if(t&&(e=void 0!==this.state.rxData.text_true?this.state.rxData.text_true:this.state.rxData.on_text,i=this.state.rxData.color_true),e=e||(void 0!==this.state.rxData.text_false?this.state.rxData.text_false:this.state.rxData.off_text),i=i||this.state.rxData.color_false,this.state.rxData.equal_text_length&&this.state.rxData.text_false&&this.state.rxData.text_true){const t=this.getTextWidth(this.state.rxData.text_false),s=this.getTextWidth(this.state.rxData.text_true),a=Math.max(t,s);return{text:(0,n.jsx)("div",{style:{width:a,display:"inline-block",color:i},children:e}),color:i}}return{text:e,color:i}}renderButton(t,e){const i=this.renderIcon(t),s=this.renderText(t);return e.color=s.color||void 0,(0,n.jsxs)(b.Button,{variant:void 0===this.state.rxData.variant?"contained":this.state.rxData.variant,color:t?"primary":"grey",onMouseDown:!this.state.rxData.pushMode||this.state.rxData.readOnly||this.props.editMode?void 0:()=>this.onMyMouseDown(),onMouseUp:!this.state.rxData.pushMode||this.state.rxData.readOnly||this.props.editMode?void 0:()=>this.onMyMouseUp(),onClick:this.state.rxData.pushMode||this.state.rxData.readOnly||this.props.editMode?void 0:()=>this.onClick(),style:e,children:[i,s.text]})}renderFab(t,e){const i=this.renderIcon(t),s=this.renderText(t);return e.zIndex=this.props.editMode?0:void 0,(0,n.jsx)(b.Fab,{style:e,color:t?"primary":"grey",onMouseDown:!this.state.rxData.pushMode||this.state.rxData.readOnly||this.props.editMode?void 0:()=>this.onMyMouseDown(),onMouseUp:!this.state.rxData.pushMode||this.state.rxData.readOnly||this.props.editMode?void 0:()=>this.onMyMouseUp(),onClick:this.state.rxData.pushMode||this.state.rxData.readOnly||this.props.editMode?void 0:()=>this.onClick(),children:i||s.text})}renderHtml(t){let e;t&&(e=this.state.rxData.html_true),e||(e=this.state.rxData.html_false);const i=this.renderIcon(t);return[this.state.rxData.html_prepend?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_prepend}},"prepend"):null,i,e?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:e}},"content"):null,this.state.rxData.html_append?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.rxData.html_append}},"append"):null]}renderSwitch(t,e){const i=void 0!==this.state.rxData.text_true?this.state.rxData.text_true:this.state.rxData.on_text,s=this.state.rxData.color_true,a=void 0!==this.state.rxData.text_false?this.state.rxData.text_false:this.state.rxData.off_text,o=this.state.rxData.color_false,r=this.renderIcon(!0,!0),l=this.renderIcon(!1);if((i||r)&&(a||l))return e.display="flex",e.alignItems="center",(0,n.jsxs)("div",{style:e,children:[(0,n.jsx)("div",{style:{marginTop:-2,color:o},children:a}),(0,n.jsx)("div",{children:l}),(0,n.jsx)(b.Switch,{checked:t,onChange:()=>this.onClick()}),(0,n.jsx)("div",{children:r}),(0,n.jsx)("div",{style:{marginTop:-2,color:s},children:i})]});if(a||l){let i;return i=l&&a?(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",color:o},children:[l,a]}):a||l,e.marginLeft=5,(0,n.jsx)(b.FormControlLabel,{style:e,control:(0,n.jsx)(b.Switch,{checked:t,onChange:()=>this.onClick()}),label:i})}return(0,n.jsx)("div",{style:e,children:(0,n.jsx)(b.Switch,{checked:!1,onChange:()=>this.onClick()})})}renderCheckbox(t,e){let i=t?void 0!==this.state.rxData.text_true?this.state.rxData.text_true:this.state.rxData.on_text:void 0!==this.state.rxData.text_false?this.state.rxData.text_false:this.state.rxData.off_text;i||(i=void 0!==this.state.rxData.text_false?this.state.rxData.text_false:this.state.rxData.off_text);const s=t?this.renderIcon(!0):this.renderIcon(!1);return e.marginLeft=5,i||s?(0,n.jsx)(b.FormControlLabel,{style:e,control:(0,n.jsx)(b.Checkbox,{checked:t,onChange:()=>this.onClick()}),label:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[s,i]})}):(0,n.jsx)(b.Checkbox,{style:e,checked:t,onChange:()=>this.onClick()})}renderRadio(t,e){const i=void 0!==this.state.rxData.text_true?this.state.rxData.text_true:this.state.rxData.on_text,s=void 0!==this.state.rxData.text_false?this.state.rxData.text_false:this.state.rxData.off_text,a=this.renderIcon(!0),o=this.renderIcon(!1);let r=void 0===this.state.rxData.variant?"contained":this.state.rxData.variant;"standard"===r&&(r="text");const l="vertical"===this.state.rxData.orientation?{height:"50%"}:this.state.rxData.notEqualLength?void 0:{width:"50%"};return(0,n.jsxs)(b.ButtonGroup,{style:e,variant:r,orientation:this.state.rxData.orientation||"horizontal",children:[(0,n.jsx)(b.Button,{style:l,startIcon:o,color:t?"grey":"primary",onClick:()=>this.onClick(!1),children:s||f.I18n.t("off")}),(0,n.jsx)(b.Button,{style:l,color:t?"primary":"grey",startIcon:a,onClick:()=>this.onClick(!0),children:i||f.I18n.t("on")})]})}componentDidUpdate(){if(this.refService.current&&("image"===this.state.rxData.type||"html"===this.state.rxData.type||"button"===this.state.rxData.type&&this.state.rxData.jquery_style)){if("button"===this.state.rxData.type){const t=this.refService.current.getElementsByClassName("vis-widget-body");if(null!==t&&void 0!==t&&t.length&&!this.refService.current._jQueryDone){this.refService.current._jQueryDone=!0,window.jQuery(t[0]).button();const e=t[0].getElementsByClassName("ui-button-text");null!==e&&void 0!==e&&e.length&&(e[0].style.display="flex",e[0].style.alignItems="center")}}this.refService.current.clientWidth===this.state.width&&this.refService.current.clientHeight===this.state.height||this.setState({width:this.refService.current.clientWidth,height:this.refService.current.clientHeight})}}renderWidgetBody(t){super.renderWidgetBody(t);const e=this.isOn(),i={};Object.keys(this.state.rxStyle).forEach((t=>{const e=this.state.rxStyle[t];null!==e&&void 0!==e&&o.default.POSSIBLE_MUI_STYLES.includes(t)&&(t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),i[t]=e)}));let s,a=this.state.rxData.type;a||"tplJquiRadio"!==this.props.tpl||(a="radio"),i.width="100%",i.height="100%";const r={textAlign:"center"};"radio"===a?s=this.renderRadio(e,i):"html"===a||"button"===a&&this.state.rxData.jquery_style?(r.display="flex",r.flexDirection=this.state.height>this.state.width?"column":"row",r.alignItems="center",r.justifyContent="center",r.cursor=this.state.rxData.readOnly?void 0:"pointer",s=this.renderHtml(e)):"switch"===a?s=this.renderSwitch(e,i):"checkbox"===a?s=this.renderCheckbox(e,i):"image"===a?(r.cursor=this.state.rxData.readOnly?void 0:"pointer",s=this.renderIcon(e,i)):"round-button"===a?s=this.renderFab(e,i):this.state.rxData.jquery_style||(s=this.renderButton(e,i));const l=(0,n.jsx)("div",{className:"vis-widget-body",style:r,onClick:"image"===a||"html"===a?()=>this.onClick():void 0,children:s});return e&&this.state.rxData.alt_true?(0,n.jsx)(b.Tooltip,{title:this.state.rxData.alt_true,children:l}):!e&&this.state.rxData.alt_false?(0,n.jsx)(b.Tooltip,{title:this.state.rxData.alt_false,children:l}):l}}Ft.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Pt=Ft;class zt extends Pt{static getWidgetInfo(){const t={id:"tplJquiRadio",visSet:"jqui",visName:"Radiobuttons on/off",visWidgetLabel:"jqui_radio_buttons_on_off",visPrev:"widgets/jqui/img/Prev_RadioButtonsOnOff.png",visOrder:15,visAttrs:Pt.getWidgetInfo().visAttrs,visDefaultStyle:{width:150,height:45}};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_binary_control_note"});const e=Pt.findField(t,"type");return e&&(e.default="radio"),t}getWidgetInfo(){return zt.getWidgetInfo()}}zt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Et=zt,Lt={AUTO:"thermostat_auto",MANUAL:"pan_tool",VACATION:"houseboat",PARTY:"celebration",COOL:"ac_unit",DRY:"dry",ECO:"park",FAN_ONLY:"air",HEAT:"wb_sunny",HEATING:"wb_sunny",OFF:"power_settings_new"};class Bt extends a().Component{constructor(t){super(t),this.textRef=void 0,this.state={textDialogFocused:[],states:null,unit:"",originalUnit:"",usePercents:!0,min:0,max:100,steps:4,texts:[],values:[],colors:[],activeColors:[],icons:[],images:[],tooltips:[],iconDialog:null,imageDialog:null,dialog:!1,dialogDelete:null},this.textRef=[]}static getIcon(t){return Bt.iconPromise||(Bt.iconPromise=fetch("./material-icons/baseline.json").then((t=>t.json()))),Bt.iconPromise.then((e=>e[t]?"data:image/svg+xml;base64,".concat(e[t]):null)).catch((t=>(console.error(t),null)))}static async generateFields(t,e){const i=t.oid;if(!i||"nothing_selected"===i)return!1;if(t.count<=1){var s,a;let o=!1;const n=await e.getObject(i);if(null!==n&&void 0!==n&&null!==(s=n.common)&&void 0!==s&&s.states){let e=n.common.states;Array.isArray(e)&&(e={},Object.keys(n.common.states).forEach((t=>e[t]=t)));const i=Object.keys(n.common.states);for(let s=0;s<i.length;s++){if(t["text".concat(s+1)]!==e[i[s]]&&(t["text".concat(s+1)]=e[i[s]],o=!0),t["value".concat(s+1)]!==i[s]&&(t["value".concat(s+1)]=i[s],o=!0),Lt[e[i[s]].toUpperCase()]){const a=await Bt.getIcon(Lt[e[i[s]].toUpperCase()]);t["icon".concat(s+1)]!==a&&(t["icon".concat(s+1)]=a),o=!0}t["g_states-".concat(s+1)]||(t["g_states-".concat(s+1)]=!0,o=!0)}t.count!==i.length&&(t.count=i.length,o=!0)}else if("number"===(null===n||void 0===n||null===(a=n.common)||void 0===a?void 0:a.type)){const e=n.common.unit||"",i=void 0!==n.common.min?n.common.min:0,s=void 0!==n.common.max?n.common.max:100,a=(s-i)/4;let r=0;for(let n=i;n<s;n+=a){r++;const a=Math.round((n-i)/(s-i)*100);t["text".concat(r)]!==a.toString()+e&&(t["text".concat(r)]=a.toString()+e,o=!0),t["value".concat(r)]!==n.toString()&&(t["value".concat(r)]=n.toString(),o=!0),t["g_states-".concat(r)]||(t["g_states-".concat(r)]=!0,o=!0)}r++,t["text".concat(r)]!==100+e&&(t["text".concat(r)]=100+e,o=!0),t["value".concat(r)]!==s.toString()&&(t["value".concat(r)]=s.toString(),o=!0),t["g_states-".concat(r)]||(t["g_states-".concat(r)]=!0,o=!0),t.count!==r&&(o=!0,t.count=r)}return!!o&&t}return!1}async calculateFirst(t){const e={...this.state,dialog:!0};if(this.props.data.count<1||void 0!==t){const t=this.props.data.oid;if(t&&"nothing_selected"!==t){var i,s;const a=await this.props.socket.getObject(t);if(e.texts=[],e.values=[],null!==a&&void 0!==a&&null!==(i=a.common)&&void 0!==i&&i.states){e.numbers=!1;let t=a.common.states;Array.isArray(t)&&(t={},Object.keys(a.common.states).forEach((e=>t[e]=e))),e.states=t;const i=Object.keys(t);e.texts=[],e.values=[];for(let s=0;s<i.length;s++)e.texts[s]=t[i[s]],e.values[s]=i[s],Lt[t[i[s]].toUpperCase()]&&(e.icons[s]=await Bt.getIcon(Lt[t[i[s]].toUpperCase()]))}else if("number"===(null===a||void 0===a||null===(s=a.common)||void 0===s?void 0:s.type)){e.numbers=!0,e.unit=a.common.unit||"",e.min=void 0!==a.common.min?a.common.min:0,e.max=void 0!==a.common.max?a.common.max:100,e.step=(e.max-e.min)/4;for(let t=e.min;t<e.max;t+=e.step){const i=Math.round((t-e.min)/(e.max-e.min)*100);e.texts.push(i+e.unit),e.values.push(t)}e.texts.push(100+e.unit),e.values.push(e.max)}}}else{e.texts=[],e.values=[],e.icons=[],e.images=[],e.colors=[],e.activeColors=[],e.tooltips=[];for(let t=0;t<this.props.data.count;t++)e.texts[t]=this.props.data["text".concat(t+1)]||"",e.values[t]=this.props.data["value".concat(t+1)]||"",e.icons[t]=this.props.data["icon".concat(t+1)]||"",e.images[t]=this.props.data["image".concat(t+1)]||"",e.colors[t]=this.props.data["color".concat(t+1)]||"",e.activeColors[t]=this.props.data["activeColor".concat(t+1)]||"",e.tooltips[t]=this.props.data["tooltip".concat(t+1)]||""}this.setState(e)}renderDeleteDialog(){return null===this.state.dialogDelete?null:(0,n.jsxs)(b.Dialog,{open:!0,onClose:()=>this.setState({dialogDelete:null}),children:[(0,n.jsx)(b.DialogContent,{children:f.I18n.t("jqui_Are you sure?")}),(0,n.jsxs)(b.DialogActions,{children:[(0,n.jsx)(b.Button,{variant:"contained",color:"primary",startIcon:(0,n.jsx)(E.Delete,{}),onClick:()=>{const t=[...this.state.values],e=[...this.state.texts],i=[...this.state.icons],s=[...this.state.images],a=[...this.state.colors],o=[...this.state.activeColors],n=[...this.state.tooltips];"number"===typeof this.state.dialogDelete&&(t.splice(this.state.dialogDelete,1),e.splice(this.state.dialogDelete,1),i.splice(this.state.dialogDelete,1),s.splice(this.state.dialogDelete,1),a.splice(this.state.dialogDelete,1),n.splice(this.state.dialogDelete,1),o.splice(this.state.dialogDelete,1)),this.setState({values:t,texts:e,icons:i,images:s,colors:a,activeColors:o,tooltips:n,dialogDelete:null})},children:f.I18n.t("Delete")}),(0,n.jsx)(b.Button,{variant:"contained",color:"grey",startIcon:(0,n.jsx)(E.Close,{}),onClick:()=>this.setState({dialogDelete:null}),children:f.I18n.t("Cancel")})]})]},"deleteDialog")}renderMaterialDialog(){return null===this.state.iconDialog?null:(0,n.jsx)(H.A,{themeType:this.props.themeType,value:this.state.icons[this.state.iconDialog],onClose:t=>{if(this.setState({iconDialog:null}),null!==t){const e=[...this.state.icons];"number"===typeof this.state.iconDialog&&(e[this.state.iconDialog]=t),this.setState({icons:e,iconDialog:null})}}},"iconDialog")}renderImageDialog(){if(null===this.state.imageDialog)return null;let t=this.state.images[this.state.imageDialog];t.startsWith("../")?t=t.substring(3):t.startsWith("_PRJ_NAME/")&&(t=t.replace("_PRJ_NAME/","../".concat(this.props.adapterName,".").concat(this.props.instance,"/").concat(this.props.projectName,"/")));const e=(t,e)=>{var i,s;const a="".concat(this.props.adapterName,".").concat(this.props.instance,"/").concat(this.props.projectName,"/");null!==(i=t)&&void 0!==i&&i.startsWith(a)?t="_PRJ_NAME/".concat(t.substring(a.length)):null!==(s=t)&&void 0!==s&&s.startsWith("/")?t="..".concat(t):t&&!t.startsWith(".")&&(t="../".concat(t));const o=[...this.state.images];"number"===typeof this.state.imageDialog&&(o[this.state.imageDialog]=t||""),this.setState({images:o}),e&&this.setState({imageDialog:null})};return(0,n.jsx)(f.SelectFile,{title:f.I18n.t("jqui_Select file"),onClose:()=>this.setState({imageDialog:null}),restrictToFolder:"".concat(this.props.adapterName,".").concat(this.props.instance,"/").concat(this.props.projectName),allowNonRestricted:!0,allowUpload:!0,allowDownload:!0,allowCreateFolder:!0,allowDelete:!0,allowView:!0,showToolbar:!0,imagePrefix:"../",selected:t,filterByType:"images",onOk:t=>e(Array.isArray(t)?t[0]:t,!0),socket:this.props.socket},"imageDialog")}onEnter(){var t;const e=[...this.state.values];if(null!==(t=this.state.editDialog)&&void 0!==t&&t.add){const t=e.length;e[t]=this.state.editDialog.value;const i=[...this.state.texts],s=[...this.state.icons],a=[...this.state.images],o=[...this.state.colors],n=[...this.state.activeColors],r=[...this.state.tooltips];i[t]=i[t]||"",s[t]=s[t]||"",a[t]=a[t]||"",o[t]=o[t]||"",n[t]=n[t]||"",r[t]=r[t]||"",this.setState({values:e,texts:i,icons:s,images:a,colors:o,activeColors:n,tooltips:r,editDialog:null})}else{var i;void 0!==(null===(i=this.state.editDialog)||void 0===i?void 0:i.index)&&(e[this.state.editDialog.index]=this.state.editDialog.value),this.setState({values:e,editDialog:null})}}renderEditDialog(){if(!this.state.editDialog)return null;const t=!this.state.values.map((t=>"string"===typeof t?t.trim():t)).includes(this.state.editDialog.value);return(0,n.jsxs)(b.Dialog,{maxWidth:"sm",open:!0,onClose:()=>this.setState({editDialog:null}),children:[(0,n.jsx)(b.DialogTitle,{children:this.state.editDialog.add?f.I18n.t("jqui_Add new value"):f.I18n.t("Edit")}),(0,n.jsx)(b.DialogContent,{children:(0,n.jsx)(b.TextField,{onKeyDown:e=>{var i;return 13===e.keyCode&&t&&(null===(i=this.state.editDialog)||void 0===i?void 0:i.value)&&this.onEnter()},fullWidth:!0,autoFocus:!0,variant:"standard",label:f.I18n.t("Value"),value:this.state.editDialog.value,onChange:t=>{this.state.editDialog&&this.setState({editDialog:{value:t.target.value,add:this.state.editDialog.add,index:this.state.editDialog.index}})}})}),(0,n.jsxs)(b.DialogActions,{children:[(0,n.jsx)(b.Button,{variant:"contained",color:"primary",disabled:!t||!this.state.editDialog.value,startIcon:this.state.editDialog.add?(0,n.jsx)(E.Add,{}):(0,n.jsx)(E.Check,{}),onClick:()=>this.onEnter(),children:this.state.editDialog.add?f.I18n.t("Add"):f.I18n.t("Apply")}),(0,n.jsx)(b.Button,{variant:"contained",color:"grey",startIcon:(0,n.jsx)(E.Close,{}),onClick:()=>this.setState({editDialog:null}),children:f.I18n.t("Cancel")})]})]},"editDialog")}renderLine(t){let e,i=null;if(this.textRef[t]=this.textRef[t]||a().createRef(),!this.state.icons[t]){var s;const e=this.state.images[t],a=(0,n.jsx)(b.Popper,{open:!(!this.state.textDialogFocused[t]||null===e||void 0===e||!e.toString().startsWith(window.location.origin)),anchorEl:null===(s=this.textRef[t])||void 0===s?void 0:s.current,placement:"bottom",transition:!0,children:i=>{let{TransitionProps:s}=i;return(0,n.jsx)(b.Fade,{...s,timeout:350,children:(0,n.jsxs)(b.Paper,{children:[(0,n.jsxs)(b.Button,{style:{textTransform:"none"},onClick:()=>{const e=[...this.state.images];e[t]=".".concat(e[t].toString().slice(window.location.origin.length)),this.setState({images:e})},children:[f.I18n.t("jqui_Replace to")," .".concat(e.toString().slice(window.location.origin.length))]}),(0,n.jsx)(b.IconButton,{size:"small",onClick:()=>{const e=[...this.state.textDialogFocused];e[t]=!1,this.setState({textDialogFocused:e})},children:(0,n.jsx)(E.Clear,{fontSize:"small"})})]})})}},"popper");i=[(0,n.jsx)(b.TextField,{variant:"standard",fullWidth:!0,InputProps:{classes:{input:f.Utils.clsx(this.props.classes.clearPadding,this.props.classes.fieldContent)},endAdornment:(0,n.jsx)(b.Button,{size:"small",onClick:()=>this.setState({imageDialog:t}),children:"..."})},ref:this.textRef[t],value:this.state.images[t]||"",onFocus:()=>{const e=[...this.state.textDialogFocused];e[t]=!0,this.setState({textDialogFocused:e})},onBlur:()=>{const e=[...this.state.textDialogFocused];e[t]=!1,this.setState({textDialogFocused:e})},onChange:e=>{const i=[...this.state.images];i[t]=e.target.value,this.setState({images:i})}},"image"),a]}let o=this.state.images[t]||this.state.icons[t]||"";if(o.startsWith("_PRJ_NAME/")&&(o=o.replace("_PRJ_NAME/","../".concat(this.props.adapterName,".").concat(this.props.instance,"/").concat(this.props.projectName,"/"))),"radio"===this.props.data.type){const i=(0,n.jsx)(f.Icon,{src:o,style:{width:24,height:24}}),s=(0,n.jsxs)("div",{style:{display:"flex",gap:4},children:[i,this.state.texts[t]]});e=(0,n.jsx)(b.FormControlLabel,{control:(0,n.jsx)(b.Radio,{onClick:()=>this.setState({activeLine:t}),checked:this.state.activeLine===t}),labelPlacement:"end",label:s})}else if("select"===this.props.data.type){const i=(0,n.jsx)(f.Icon,{src:o,style:{width:24,height:24}}),s=(0,n.jsxs)("div",{style:{display:"flex",gap:4},children:[i,this.state.texts[t]]});e=(0,n.jsx)(b.MenuItem,{onClick:()=>this.setState({activeLine:t}),selected:this.state.activeLine===t,children:s})}else e=(0,n.jsx)(b.Button,{style:{color:this.state.activeLine===t?this.state.activeColors[t]||this.state.colors[t]:this.state.colors[t]||void 0},color:this.state.activeLine===t?"primary":"grey",variant:void 0===this.props.data.variant?"contained":this.props.data.variant,onClick:()=>this.setState({activeLine:t}),startIcon:(0,n.jsx)(f.Icon,{src:o,style:{width:24,height:24}}),children:this.state.texts[t]});return(0,n.jsxs)(b.TableRow,{children:[(0,n.jsxs)(b.TableCell,{style:{display:"flex",alignItems:"center"},children:[this.state.values[t],(0,n.jsx)(b.IconButton,{size:"small",onClick:()=>this.setState({editDialog:{add:!1,index:t,value:this.state.values[t]}}),children:(0,n.jsx)(E.Edit,{})})]}),(0,n.jsx)(b.TableCell,{children:(0,n.jsx)(b.TextField,{size:"small",fullWidth:!0,variant:"standard",value:this.state.texts[t]||"",onChange:e=>{const i=[...this.state.texts];i[t]=e.target.value,this.setState({texts:i})}})}),(0,n.jsx)(b.TableCell,{children:this.state.images[t]?null:(0,n.jsxs)("div",{style:{display:"flex",width:"100%",alignItems:"center"},children:[(0,n.jsx)(b.TextField,{fullWidth:!0,size:"small",variant:"standard",value:this.state.icons[t]||"",onChange:e=>{const i=[...this.state.icons];i[t]=e.target.value,this.setState({icons:i})},InputProps:{endAdornment:this.state.icons[t]?(0,n.jsx)(b.IconButton,{size:"small",onClick:()=>{const e=[...this.state.icons];e[t]="",this.setState({icons:e})},children:(0,n.jsx)(E.Clear,{})}):null,classes:{input:f.Utils.clsx(this.props.classes.clearPadding,this.props.classes.fieldContent)}}}),(0,n.jsx)(b.Button,{variant:this.state.icons[t]?"outlined":void 0,color:this.state.icons[t]?"grey":void 0,onClick:()=>this.setState({iconDialog:t}),children:this.state.icons[t]?(0,n.jsx)(f.Icon,{src:this.state.icons[t],style:{width:36,height:36}}):"..."})]})}),(0,n.jsx)(b.TableCell,{children:i}),(0,n.jsx)(b.TableCell,{children:(0,n.jsx)(f.ColorPicker,{value:this.state.colors[t],onChange:e=>{const i=[...this.state.colors];i[t]=e,this.setState({colors:i})}})}),(0,n.jsx)(b.TableCell,{children:(0,n.jsx)(f.ColorPicker,{value:this.state.activeColors[t],onChange:e=>{const i=[...this.state.activeColors];i[t]=e,this.setState({activeColors:i})}})}),(0,n.jsx)(b.TableCell,{children:(0,n.jsx)(b.TextField,{size:"small",fullWidth:!0,variant:"standard",value:this.state.tooltips[t]||"",onChange:e=>{const i=[...this.state.tooltips];i[t]=e.target.value,this.setState({tooltips:i})}})}),(0,n.jsx)(b.TableCell,{children:(0,n.jsx)(b.IconButton,{onClick:()=>this.setState({dialogDelete:t}),children:(0,n.jsx)(E.Delete,{})})}),(0,n.jsx)(b.TableCell,{children:e})]},"".concat(this.state.values[t],"_").concat(t))}renderMinMaxDialog(){if(!this.state.minMaxDialog)return null;const t=[],e=Math.round((this.state.max-this.state.min)/this.state.steps);for(let i=this.state.min;i<this.state.max;i+=e){let e=i;this.state.usePercents&&(e=Math.round((i-this.state.min)/(this.state.max-this.state.min)*100)),t.push((0,n.jsx)(b.Button,{variant:"contained",disabled:!0,children:Math.round(e).toString()+this.state.unit},i))}return t.push((0,n.jsx)(b.Button,{variant:"contained",disabled:!0,children:(this.state.usePercents?100:this.state.max).toString()+this.state.unit},1e3)),(0,n.jsxs)(b.Dialog,{fullWidth:!0,maxWidth:"md",open:!0,onClose:()=>this.setState({minMaxDialog:!1}),children:[(0,n.jsx)(b.DialogTitle,{children:f.I18n.t("jqui_Number settings")}),(0,n.jsxs)(b.DialogContent,{children:[0!==this.state.min||100!==this.state.max?(0,n.jsx)("div",{style:{width:"100%"},children:(0,n.jsx)(b.FormControlLabel,{control:(0,n.jsx)(b.Checkbox,{checked:this.state.usePercents,onChange:t=>{let e=this.state.unit;t.target.checked?e=e||"%":"%"===e&&(e=this.state.originalUnit||""),this.setState({usePercents:t.target.checked,unit:e})}}),label:f.I18n.t("jqui_Percents")})}):null,(0,n.jsx)(b.TextField,{fullWidth:!0,type:"number",variant:"standard",label:f.I18n.t("jqui_Minimum value"),value:this.state.min,onChange:t=>this.setState({min:Number(t.target.value)})}),(0,n.jsx)(b.TextField,{fullWidth:!0,type:"number",variant:"standard",label:f.I18n.t("jqui_Maximum value"),value:this.state.max,onChange:t=>this.setState({max:Number(t.target.value)})}),(0,n.jsxs)("div",{style:{width:"100%"},children:[(0,n.jsx)("div",{style:{width:"100%"},children:f.I18n.t("Steps")}),(0,n.jsx)("div",{style:{width:"100%"},children:(0,n.jsx)(b.Slider,{value:this.state.steps,step:1,valueLabelDisplay:"auto",min:2,max:20,marks:[{value:0,label:"0"},{value:20,label:"20"}],onChange:(t,e)=>this.setState({steps:e})})})]}),(0,n.jsx)(b.TextField,{fullWidth:!0,variant:"standard",label:f.I18n.t("Unit"),value:this.state.unit,onChange:t=>this.setState({unit:t.target.value})}),(0,n.jsx)(b.ButtonGroup,{style:{marginTop:20},variant:void 0===this.props.data.variant?"contained":this.props.data.variant,children:t})]}),(0,n.jsxs)(b.DialogActions,{children:[(0,n.jsx)(b.Button,{variant:"contained",color:"primary",startIcon:(0,n.jsx)(E.Check,{}),onClick:()=>{const t={...this.state,minMaxDialog:!1,values:[],texts:[...this.state.texts],icons:[...this.state.icons],images:[...this.state.images],colors:[...this.state.colors],activeColors:[...this.state.activeColors],tooltips:[...this.state.tooltips]},e=Math.round((this.state.max-this.state.min)/this.state.steps);let i=0;for(let s=this.state.min;s<this.state.max;s+=e)this.state.usePercents?t.texts[i]=Math.round((s-this.state.min)/(this.state.max-this.state.min)*100)+this.state.unit:t.texts[i]=s+this.state.unit,t.values[i]=s.toString(),t.icons[i]=t.icons[i]||"",t.images[i]=t.images[i]||"",t.colors[i]=t.colors[i]||"",t.activeColors[i]=t.activeColors[i]||"",t.tooltips[i]=t.tooltips[i]||"",i++;t.values[i]=this.state.max.toString(),t.texts[i]=100+this.state.unit,this.setState(t)},children:f.I18n.t("Apply")}),(0,n.jsx)(b.Button,{variant:"contained",color:"grey",startIcon:(0,n.jsx)(E.Close,{}),onClick:()=>this.setState({minMaxDialog:!1}),children:f.I18n.t("Cancel")})]})]},"minMaxDialog")}renderDialog(){return this.state.dialog?(0,n.jsxs)(b.Dialog,{fullWidth:!0,maxWidth:"lg",open:!0,onClose:()=>this.setState({dialog:!1}),children:[(0,n.jsx)(b.DialogTitle,{children:f.I18n.t("jqui_Bulk edit")}),(0,n.jsxs)(b.DialogContent,{children:[(0,n.jsx)(b.Button,{variant:"contained",onClick:async()=>{const t=this.props.data.oid,e={...this.state,minMaxDialog:!0,usePercents:!0,min:this.state.min,max:this.state.max||100,steps:4,unit:"%"};if(t&&"nothing_selected"!==t){var i,s,a;const o=await this.props.socket.getObject(t);e.min=null===o||void 0===o||null===(i=o.common)||void 0===i?void 0:i.min,void 0!==e.min&&null!==e.min||(e.min=0),e.max=null===o||void 0===o||null===(s=o.common)||void 0===s?void 0:s.max,void 0!==e.max&&null!==e.max||(e.max=100),e.originalUnit=(null===o||void 0===o||null===(a=o.common)||void 0===a?void 0:a.unit)||""}this.setState(e)},children:f.I18n.t("jqui_Generate steps")}),this.state.states?(0,n.jsx)(b.Button,{variant:"contained",onClick:()=>this.calculateFirst(!0),children:f.I18n.t("jqui_Generate states")}):null,(0,n.jsxs)(b.Table,{children:[(0,n.jsx)(b.TableHead,{children:(0,n.jsxs)(b.TableRow,{children:[(0,n.jsx)(b.TableCell,{children:f.I18n.t("Value")}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("Text")}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("Icon")}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("Image")}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("color")}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("jqui_active_color")}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("jqui_tooltip")}),(0,n.jsx)(b.TableCell,{children:(0,n.jsx)(b.Fab,{size:"small",style:{marginRight:8},onClick:()=>this.setState({editDialog:{add:!0,value:""}}),children:(0,n.jsx)(E.Add,{})})}),(0,n.jsx)(b.TableCell,{children:f.I18n.t("jqui_Example")})]})}),(0,n.jsx)(b.TableBody,{children:this.state.values.map(((t,e)=>this.renderLine(e)))})]})]}),(0,n.jsxs)(b.DialogActions,{children:[(0,n.jsx)(b.Button,{variant:"contained",color:"primary",startIcon:(0,n.jsx)(E.Check,{}),onClick:()=>{const t={...this.props.data};for(let e=0;e<this.state.values.length;e++)t["text".concat(e+1)]=this.state.texts[e],t["value".concat(e+1)]=this.state.values[e],t["icon".concat(e+1)]=this.state.icons[e],t["image".concat(e+1)]=this.state.images[e],t["color".concat(e+1)]=this.state.colors[e],t["tooltip".concat(e+1)]=this.state.tooltips[e],t["activeColor".concat(e+1)]=this.state.activeColors[e],t["g_states-".concat(e+1)]=!0;for(let e=this.state.values.length+1;e<30;e++)delete t["text".concat(e)],delete t["value".concat(e)],delete t["icon".concat(e)],delete t["image".concat(e)],delete t["color".concat(e)],delete t["tooltip".concat(e)],delete t["activeColor".concat(e)],delete t["g_states-".concat(e)];t.count=this.state.values.length,this.props.onDataChange(t),this.setState({dialog:!1})},children:f.I18n.t("Apply")}),(0,n.jsx)(b.Button,{variant:"contained",color:"grey",startIcon:(0,n.jsx)(E.Close,{}),onClick:()=>this.setState({dialog:!1}),children:f.I18n.t("Cancel")})]})]},"dialog"):null}render(){return[(0,n.jsx)(b.Button,{fullWidth:!0,variant:"outlined",disabled:!this.props.data.oid,onClick:()=>this.calculateFirst(),children:f.I18n.t("jqui_generate")},"button"),this.renderMinMaxDialog(),this.renderImageDialog(),this.renderMaterialDialog(),this.renderDeleteDialog(),this.renderDialog(),this.renderEditDialog()]}}Bt.iconPromise=void 0;const Vt=(0,V.withStyles)((()=>({clearPadding:{"&&&&":{padding:0,margin:0,minHeight:"initial"}},fieldContent:{"&&&&&&":{fontSize:"80%"},"& svg":{fontSize:"1rem"}}})))(Bt);class Ht extends o.default{static getWidgetInfo(){return{id:"tplJquiButtonState",visSet:"jqui",visName:"States control",visWidgetLabel:"jqui_states_control",visPrev:"widgets/jqui/img/Prev_ButtonState.png",visOrder:14,visAttrs:[{name:"common",fields:[{name:"type",label:"jqui_type",type:"select",noTranslation:!0,default:"button",options:["button","select","radio","slider"]},{name:"oid",type:"id",onChange:async(t,e,i,s)=>{e[t.name]&&await Vt.generateFields(e,s)&&i(e)}},{name:"readOnly",type:"checkbox"},{name:"click_id",type:"id",noSubscribe:!0,hidden:t=>!!t.readOnly},{name:"count",type:"slider",min:0,default:1,max:10,hidden:t=>!!t.percents},{type:"custom",component:(t,e,i,s)=>(0,n.jsx)(Vt,{data:e||{},onDataChange:i,socket:s.context.socket,themeType:s.context.themeType,adapterName:s.context.adapterName,instance:s.context.instance,projectName:s.context.projectName})},{name:"variant",label:"jqui_variant",type:"select",noTranslation:!0,options:["contained","outlined","text","standard"],default:"contained",hidden:t=>"button"!==t.type&&"select"!==t.type},{name:"orientation",label:"orientation",type:"select",options:["horizontal","vertical"],default:"horizontal",hidden:t=>"button"!==t.type&&"slider"!==t.type},{name:"widgetTitle",label:"jqui_name",type:"text"},{name:"timeout",label:"jqui_set_timeout",type:"number",hidden:t=>"slider"!==t.type},{name:"open",label:"jqui_open",type:"checkbox",hidden:t=>"select"!==t.type}]},{name:"states",label:"jqui_group_value",indexFrom:1,indexTo:"count",hidden:t=>!!t.percents,fields:[{name:"value",type:"text",label:"jqui_value",default:"0"},{name:"test",type:"checkbox",label:"jqui_test",onChange:async(t,e,i,s,a)=>{if(e[t.name]){let t=!1;for(let i=1;i<=e.count;i++)i!==a&&e["test".concat(i)]&&(t=!0,e["test".concat(i)]=!1);t&&i(e)}},hidden:(t,e)=>"slider"===t.type||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]},{name:"onlyIcon",type:"checkbox",label:"jqui_only_icon"},{name:"text",default:f.I18n.t("Value"),type:"text",label:"jqui_text",hidden:(t,e)=>!!t["onlyIcon".concat(e)]||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]},{name:"color",type:"color",label:"color",hidden:(t,e)=>"slider"===t.type||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]},{name:"activeColor",type:"color",label:"jqui_active_color",hidden:(t,e)=>"slider"===t.type||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]},{name:"image",label:"jqui_image",type:"image",hidden:(t,e)=>"slider"===t.type||!!t.icon||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]},{name:"icon",label:"jqui_icon",type:"icon64",hidden:(t,e)=>"slider"===t.type||!!t.image||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]},{name:"tooltip",label:"jqui_tooltip",type:"text",hidden:(t,e)=>"slider"===t.type||""===t["value".concat(e)]||null===t["value".concat(e)]||void 0===t["value".concat(e)]}]}],visDefaultStyle:{width:300,height:40}}}async componentDidMount(){if(await super.componentDidMount(),"tplJquiRadioSteps"===this.props.tpl&&this.state.data&&this.props.context.onWidgetsChanged&&void 0===this.state.data.count){const t=(0,l.Go)(this.state.data);t.count=5;const e=parseFloat(t.min||0,10),i=parseFloat(t.max||100,10);t.value1=e,t.text1=f.I18n.t("jqui_off"),t["g_states-1"]=!0,t.value5=i,t.text5="100%",t["g_states-5"]=!0,t.value2=.25*(i-e)+e,t.text2="25%",t["g_states-2"]=!0,t.value3=.5*(i-e)+e,t.text3="50%",t["g_states-3"]=!0,t.value4=.75*(i-e)+e,t.text4="75%",t["g_states-4"]=!0,t.min=null,t.max=null,setTimeout((()=>this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,data:t}])),100)}if(("tplJquiRadioList"===this.props.tpl||"tplJquiSelectList"===this.props.tpl)&&this.state.data&&this.state.data.values&&this.state.data.texts&&this.props.context.onWidgetsChanged){const t=this.state.data.values.split(";"),e=this.state.data.texts.split(";"),i=(0,l.Go)(this.state.data);i.values=null,i.texts=null,i.count=t.length;for(let s=1;s<=t.length;s++)i["value".concat(s)]=t[s-1],i["text".concat(s)]=e[s-1],i["g_states-".concat(s)]=!0;i.type="tplJquiRadioList"===this.props.tpl?"radio":"select",setTimeout((()=>this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,data:i}])),100)}if(this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid)try{const t=await this.props.context.socket.getState(this.state.rxData.oid);this.onStateUpdated(this.state.rxData.oid,t)}catch(t){console.error("Cannot get state ".concat(this.state.rxData.oid,": ").concat(t))}}async componentWillUnmount(){super.componentWillUnmount(),this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=null}static findField(t,e){return o.default.findField(t,e)}getWidgetInfo(){return Ht.getWidgetInfo()}onStateUpdated(t,e){if(t===this.state.rxData.oid&&e){const t=null===e.val||void 0===e.val?"":e.val;this.state.value!==t.toString()&&this.setState({value:t.toString()})}}getControlOid(){return this.state.rxData.click_id&&"nothing_selected"!==this.state.rxData.click_id?this.state.rxData.click_id:this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid?this.state.rxData.oid:""}async onClick(t,e){if(!this.state.rxData.readOnly&&!this.props.editMode)if("slider"===this.state.rxData.type)this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout((()=>{this.controlTimeout=null;const e=this.getControlOid();e&&this.props.context.setValue(e,parseFloat(t))}),e?0:parseInt(this.state.rxData.timeout,10)||300),this.setState({value:t});else{const e=this.getControlOid();e&&("number"===this.state.object.common.type?this.props.context.setValue(e,parseFloat(this.state.rxData["value".concat(t)])):this.props.context.setValue(e,this.state.rxData["value".concat(t)])),this.setState({value:this.state.rxData["value".concat(t)]})}}getSelectedIndex(t){if(void 0===t&&(t=this.state.value),this.props.editMode)for(let e=1;e<=this.state.rxData.count;e++)if(this.state.rxData["test".concat(e)])return e;for(let e=1;e<=this.state.rxData.count;e++)if(this.state.rxData["value".concat(e)]===t)return e;return 0}renderIcon(t,e){let i,s=this.state.rxData["icon".concat(t)]||this.state.rxData["image".concat(t)];if(s&&this.state.rxData["color".concat(t)]&&(i=this.state.rxData["color".concat(t)],t===e&&this.state.rxData["activeColor".concat(t)]&&(i=this.state.rxData["activeColor".concat(t)])),s){s.startsWith("_PRJ_NAME/")&&(s=s.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/")));const t={color:i,width:"auto",height:24};return(0,n.jsx)(f.Icon,{style:t,src:s},"icon")}return null}renderText(t,e){if(this.state.rxData["onlyIcon".concat(t)])return null;let i=this.state.rxData["text".concat(t)],s=this.state.rxData["color".concat(t)];return t===e&&this.state.rxData["activeColor".concat(t)]&&(s=this.state.rxData["activeColor".concat(t)]),i=i||this.state.rxData["value".concat(t)],(0,n.jsx)("span",{style:{color:s},children:i})}renderButton(t,e,i){const s=this.renderIcon(t,e),a=this.renderText(t,e),o=(0,n.jsx)(b.Button,{style:{...i,flexGrow:1},startIcon:a?s:void 0,color:e===t?"primary":"grey",onClick:()=>this.onClick(t),children:a||s},t);return this.state.rxData["tooltip".concat(t)]?(0,n.jsx)(b.Tooltip,{title:this.state.rxData["tooltip".concat(t)],children:o},t):o}renderRadio(t,e,i){const s=this.renderIcon(t,e);let a=this.renderText(t,e);s&&a&&(a=(0,n.jsxs)("div",{style:{display:"flex",gap:4},children:[s,a]}));const o=(0,n.jsx)(b.FormControlLabel,{style:i,control:(0,n.jsx)(b.Radio,{onClick:()=>this.onClick(t),checked:e===t}),labelPlacement:"end",label:a||s},t);return this.state.rxData["tooltip".concat(t)]?(0,n.jsx)(b.Tooltip,{title:this.state.rxData["tooltip".concat(t)],children:o},t):o}renderMenuItem(t,e,i){const s=this.renderIcon(t,e);let a=this.renderText(t,e);return s&&a&&(a=(0,n.jsxs)("div",{style:{display:"flex",gap:4},children:[s,a]})),(0,n.jsx)(b.MenuItem,{title:this.state.rxData["tooltip".concat(t)],selected:e===t,style:i,value:this.state.rxData["value".concat(t)],onClick:this.state.rxData.open?()=>this.onClick(t):void 0,children:a||s},t)}renderWidgetBody(t){var e;super.renderWidgetBody(t);const i=this.getSelectedIndex();(null===(e=this.state.object)||void 0===e?void 0:e._id)!==this.state.rxData.oid&&!1!==this.state.object&&(this.state.object=!1,setTimeout((async()=>{if(this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid){var t;const e=await this.props.context.socket.getObject(this.state.rxData.oid);if(null!==e&&void 0!==e&&null!==(t=e.common)&&void 0!==t&&t.type)return void this.setState({object:{_id:e._id,common:{type:e.common.type}}})}this.setState({object:{_id:this.state.rxData.oid,common:{type:"string"}}})}),0));const s={};let a;if(Object.keys(this.state.rxStyle).forEach((t=>{const e=this.state.rxStyle[t];null!==e&&void 0!==e&&o.default.POSSIBLE_MUI_STYLES.includes(t)&&(t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),s[t]=e)})),this.state.rxData.count&&(1!==this.state.rxData.count||this.state.rxData.text0||this.state.rxData.icon0||this.state.rxData.image0)||this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid)if(this.state.rxData.count)if("radio"===this.state.rxData.type){const t=[];for(let e=1;e<=this.state.rxData.count;e++)t.push(this.renderRadio(e,i,s));a=(0,n.jsx)(b.RadioGroup,{style:{width:"100%",height:"100%"},variant:void 0===this.state.rxData.variant?"contained":this.state.rxData.variant,children:t})}else if("select"===this.state.rxData.type){const t=[];for(let a=1;a<=this.state.rxData.count;a++)t.push(this.renderMenuItem(a,i,s));let e="standard";"contained"===this.state.rxData.variant?e="filled":"outlined"===this.state.rxData.variant&&(e="outlined"),a=this.state.rxData.open?(0,n.jsx)(b.List,{style:{width:"100%",height:"100%"},value:this.state.value,onChange:t=>this.onClick(this.getSelectedIndex(t.target.value)),variant:e,children:t}):(0,n.jsx)(b.Select,{style:{width:"100%",height:"100%"},value:void 0===this.state.value?"":this.state.value,onChange:t=>this.onClick(this.getSelectedIndex(t.target.value)),variant:e,children:t})}else if("slider"===this.state.rxData.type){t.style.overflow="visible";const e=[];for(let t=1;t<=this.state.rxData.count;t++)e.push({value:parseFloat(this.state.rxData["value".concat(t)]||0),label:this.state.rxData["text".concat(t)]||0});a=(0,n.jsx)(b.Slider,{style:this.state.rxData.orientation&&"horizontal"!==this.state.rxData.orientation?{marginTop:10,marginBottom:10}:{marginLeft:20,marginRight:20,width:"calc(100% - 40px)"},value:parseFloat(this.state.value)||0,valueLabelDisplay:"auto",min:e[0].value,max:e[e.length-1].value,orientation:this.state.rxData.orientation||"horizontal",marks:e,onChangeCommitted:(t,e)=>this.onClick(e,!0),onChange:(t,e)=>this.onClick(e)})}else{const t=[];for(let e=1;e<=this.state.rxData.count;e++)t.push(this.renderButton(e,i,s));a=(0,n.jsx)(b.ButtonGroup,{style:{width:"100%",height:"100%"},orientation:this.state.rxData.orientation||"horizontal",variant:void 0===this.state.rxData.variant?"contained":this.state.rxData.variant,children:t})}else a=(0,n.jsx)(b.Button,{variant:"outlined",style:{width:"100%",height:"100%"},children:f.I18n.t("Please define states")});else a=(0,n.jsx)(b.Button,{variant:"outlined",style:{width:"100%",height:"100%"},children:f.I18n.t("Select object ID")});return this.state.rxData.widgetTitle&&(a=(0,n.jsxs)(b.FormControl,{fullWidth:!0,style:{marginTop:"select"===this.state.rxData.type?5:void 0,width:"100%",height:"100%"},children:["select"===this.state.rxData.type?(0,n.jsx)(b.InputLabel,{children:this.state.rxData.widgetTitle}):(0,n.jsx)(b.FormLabel,{style:"slider"===this.state.rxData.type?{marginLeft:10}:void 0,children:this.state.rxData.widgetTitle}),a]})),(0,n.jsx)("div",{className:"vis-widget-body",children:a})}}Ht.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Jt=Ht;class Ut extends Jt{static getWidgetInfo(){const t={id:"tplJquiRadioList",visSet:"jqui",visName:"Radiobuttons ValueList",visWidgetLabel:"jqui_radio_list",visPrev:"widgets/jqui/img/Prev_RadioList.png",visOrder:15,visAttrs:Jt.getWidgetInfo().visAttrs,visDefaultStyle:{width:250,height:45}};return Jt.findField(t,"type").default="radio",t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_state_note"}),t}getWidgetInfo(){return Ut.getWidgetInfo()}}Ut.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Gt=Ut;class Yt extends Jt{static getWidgetInfo(){const t={id:"tplJquiSelectList",visSet:"jqui",visName:"Select ValueList",visWidgetLabel:"jqui_select_list",visPrev:"widgets/jqui/img/Prev_SelectList.png",visOrder:16,visAttrs:Jt.getWidgetInfo().visAttrs,visDefaultStyle:{width:250,height:45}};return Jt.findField(t,"type").default="select",t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_state_note"}),t}getWidgetInfo(){return Yt.getWidgetInfo()}}Yt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Qt=Yt;class Xt extends Pt{static getWidgetInfo(){const t={id:"tplIconStatePushButton",visSet:"jqui",visName:"Binary Icon Push Button",visWidgetLabel:"jqui_icon_state_push_button",visPrev:"widgets/jqui/img/Prev_IconPushButton.png",visOrder:15,visAttrs:Pt.getWidgetInfo().visAttrs,visDefaultStyle:{width:70,height:30}},e=Pt.findField(t,"pushMode");return e&&(e.default=!0),t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_binary_control_note"}),t}getWidgetInfo(){return Xt.getWidgetInfo()}}Xt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const Kt=Xt;class Zt extends Pt{static getWidgetInfo(){const t={id:"tplIconStateBool",visSet:"jqui",visName:"Binary Icon State",visWidgetLabel:"jqui_icon_state_bool",visPrev:"widgets/jqui/img/Prev_IconStateBool.png",visOrder:15,visAttrs:Pt.getWidgetInfo().visAttrs,visDefaultStyle:{width:70,height:30}},e=Pt.findField(t,"icon_false");return e&&(e.default="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik05IDIxYzAgLjUuNCAxIDEgMWg0Yy42IDAgMS0uNSAxLTF2LTFIOXYxem0zLTE5QzguMSAyIDUgNS4xIDUgOWMwIDIuNCAxLjIgNC41IDMgNS43VjE3YzAgLjUuNCAxIDEgMWg2Yy42IDAgMS0uNSAxLTF2LTIuM2MxLjgtMS4zIDMtMy40IDMtNS43YzAtMy45LTMuMS03LTctN3oiLz48L3N2Zz4="),t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_binary_control_note"}),t}getWidgetInfo(){return Zt.getWidgetInfo()}}Zt.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const $t=Zt;class te extends Jt{static getWidgetInfo(){const t={id:"tplJquiRadioSteps",visSet:"jqui",visName:"Radiobuttons 25%",visWidgetLabel:"jqui_radio_steps",visPrev:"widgets/jqui/img/Prev_RadioSteps.png",visOrder:25,visAttrs:Jt.getWidgetInfo().visAttrs,visDefaultStyle:{width:350,height:35}};return t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_state_note"}),t}getWidgetInfo(){return te.getWidgetInfo()}}te.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const ee=te;class ie extends o.default{constructor(t){super(t),this.state.value="",this.state.valueMax=""}static getWidgetInfo(){return{id:"tplJquiSlider",visSet:"jqui",visName:"Slider",visWidgetLabel:"jqui_slider",visPrev:"widgets/jqui/img/Prev_Slider.png",visOrder:24,visAttrs:[{name:"common",fields:[{name:"type",label:"jqui_type",type:"select",options:[{value:"single",label:"jqui_single"},{value:"range",label:"jqui_range"}]},{name:"oid",type:"id",onChange:async(t,e,i,s)=>{if(e[t.name]&&"nothing_selected"!==e[t.name]){var a,o,n,r,l;const h=await s.getObject(e[t.name]);let p=!1;var d,c;if(void 0!==(null===h||void 0===h||null===(a=h.common)||void 0===a?void 0:a.min)&&null!==(null===h||void 0===h||null===(o=h.common)||void 0===o?void 0:o.min)&&(e.min!==h.common.min&&(e.min=h.common.min,p=!0),e.text!==h.common.min.toString()+(h.common.unit||"")&&(e.text=h.common.min.toString()+(h.common.unit||""),p=!0)),void 0!==(null===h||void 0===h||null===(n=h.common)||void 0===n?void 0:n.max)&&null!==(null===h||void 0===h||null===(r=h.common)||void 0===r?void 0:r.max)&&(e.max!==h.common.max&&(e.max=h.common.max,p=!0),e["text-2"]!==h.common.max.toString()+(h.common.unit||"")&&(e["text-2"]=h.common.max.toString()+(h.common.unit||""),p=!0)),null!==h&&void 0!==h&&null!==(l=h.common)&&void 0!==l&&l.unit&&e.unit!==h.common.unit&&(e.unit=h.common.unit,p=!0),!e.step)void 0!==(null===h||void 0===h||null===(d=h.common)||void 0===d?void 0:d.step)&&null!==(null===h||void 0===h||null===(c=h.common)||void 0===c?void 0:c.step)&&e.step!==h.common.step&&(e.step=h.common.step,p=!0);p&&i(e)}}},{name:"click_id",type:"id",noSubscribe:!0,hidden:t=>!!t.readOnly},{name:"inverted",type:"checkbox",label:"jqui_inverted"},{name:"min",type:"number",label:"jqui_min"},{name:"max",type:"number",label:"jqui_max"},{name:"min_distance",type:"number",hidden:t=>"range"!==t.type},{name:"shift_min_distance",type:"checkbox",hidden:t=>"range"!==t.type||!t.min_distance},{name:"step",type:"number",min:0},{name:"unit"},{name:"timeout",label:"jqui_set_timeout",type:"number"},{name:"oid-working",label:"jqui_oid_working",type:"id"}]},{name:"second",hidden:t=>"range"!==t.type,fields:[{name:"inverted-2",type:"checkbox",label:"jqui_inverted"},{name:"oid-2",type:"id",hidden:t=>"range"!==t.type},{name:"click_id-2",type:"id",noSubscribe:!0,hidden:t=>!t["oid-2"]||"range"!==t.type}]},{name:"style",fields:[{name:"widgetTitle",label:"jqui_name",type:"text"},{name:"orientation",label:"orientation",type:"select",options:["horizontal","vertical"],default:"horizontal"},{name:"text",label:"jqui_text",hidden:t=>!!t.icon||!!t.image},{name:"text-2",label:"jqui_text_max",hidden:t=>!!t["icon-2"]||!!t["image-2"]},{name:"image",label:"jqui_image",type:"image",hidden:t=>!!t.icon||!!t.text},{name:"icon",label:"jqui_icon",type:"icon64",hidden:t=>!!t.image||!!t.text},{name:"image-2",label:"jqui_image_max",type:"image",hidden:t=>!!t["icon-2"]||!!t["text-2"]},{name:"icon-2",label:"jqui_icon_max",type:"icon64",hidden:t=>!!t["image-2"]||!!t["text-2"]},{name:"valueLabelDisplay",type:"select",label:"jqui_value_label_display",options:[{value:"auto",label:"jqui_auto"},{value:"on",label:"jqui_on"},{value:"off",label:"jqui_off"}]}]}],visDefaultStyle:{width:300,height:40}}}async componentDidMount(){if(super.componentDidMount(),this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid)try{const t=await this.props.context.socket.getState(this.state.rxData.oid);this.onStateUpdated(this.state.rxData.oid,t)}catch(t){console.error("Cannot get state ".concat(this.state.rxData.oid,": ").concat(t))}if("range"===this.state.rxData.type&&this.state.rxData["oid-2"]&&"nothing_selected"!==this.state.rxData["oid-2"])try{const t=await this.props.context.socket.getState(this.state.rxData["oid-2"]);this.onStateUpdated(this.state.rxData["oid-2"],t)}catch(t){console.error("Cannot get state ".concat(this.state.rxData.oid,": ").concat(t))}}componentWillUnmount(){super.componentWillUnmount(),this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=null}static findField(t,e){return o.default.findField(t,e)}getWidgetInfo(){return ie.getWidgetInfo()}onStateUpdated(t,e){if(t===this.state.rxData.oid&&e){let t=parseFloat(null===e.val||void 0===e.val?0:e.val)||0;this.state.rxData.inverted&&(t=parseFloat(this.state.rxData.max)-t+parseFloat(this.state.rxData.min)),this.state.value!==t&&this.setState({value:t})}else if(t===this.state.rxData["oid-2"]&&e){let t=parseFloat(null===e.val||void 0===e.val?0:e.val)||0;this.state.rxData["inverted-2"]&&(t=parseFloat(this.state.rxData.max)-t+parseFloat(this.state.rxData.min)),this.state.valueMax!==t&&this.setState({valueMax:t.toString()})}}getControlOid(t){if(t){if(this.state.rxData["click_id-2"]&&"nothing_selected"!==this.state.rxData["click_id-2"])return this.state.rxData["click_id-2"];if(this.state.rxData["oid-2"]&&"nothing_selected"!==this.state.rxData["oid-2"])return this.state.rxData["oid-2"]}else{if(this.state.rxData.click_id&&"nothing_selected"!==this.state.rxData.click_id)return this.state.rxData.click_id;if(this.state.rxData.oid&&"nothing_selected"!==this.state.rxData.oid)return this.state.rxData.oid}return""}async onChange(t,e,i){if(this.props.editMode)return;this.newState=this.newState||{};const s=(e||"range"===this.state.rxData.type)&&parseFloat(this.state.rxData.min_distance)||0;e?Array.isArray(t)?(console.log("Set ".concat(t[0]," - ").concat(t[1])),this.newState.value=t[0],this.newState.valueMax=t[1],s&&(2===this.lastChanged?this.state.rxData.shift_min_distance?(this.newState.valueMax=Math.max(this.newState.valueMax,parseFloat(this.state.rxData.min)+s),this.newState.valueMax-s<this.newState.value&&(this.newState.value=this.newState.valueMax-s)):this.newState.valueMax=Math.max(this.newState.valueMax,this.state.value+s):this.state.rxData.shift_min_distance?(this.newState.value=Math.min(this.newState.value,parseFloat(this.state.rxData.max)-s),this.newState.valueMax=this.state.valueMax,this.newState.valueMax-s<this.newState.value&&(this.newState.valueMax=this.newState.value+s)):this.newState.value=Math.min(this.newState.value,this.state.valueMax-s)),console.log("Set ".concat(this.newState.value," - ").concat(this.newState.valueMax))):(this.lastChanged=2,this.newState.valueMax=t,s&&(this.state.rxData.shift_min_distance?(this.newState.valueMax=Math.max(this.newState.valueMax,parseFloat(this.state.rxData.min)+s),this.newState.value=this.state.value,this.newState.valueMax-s<this.newState.value&&(this.newState.value=this.newState.valueMax-s)):this.newState.valueMax=Math.max(t,this.state.value+s)),console.log("Set (".concat(this.newState.value||this.state.value,") - ").concat(this.newState.valueMax))):(this.lastChanged=1,this.newState.value=t,s&&(this.state.rxData.shift_min_distance?(this.newState.value=Math.min(this.newState.value,parseFloat(this.state.rxData.max)-s),this.newState.valueMax=this.state.valueMax,this.newState.valueMax-s<this.newState.value&&(this.newState.valueMax=this.newState.value+s)):this.newState.value=Math.min(t,this.state.valueMax-s)),console.log("Set ".concat(this.newState.value," - (").concat(this.newState.valueMax||this.state.valueMax,")"))),this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout((async()=>{this.controlTimeout=null;const t=this.newState;if(this.newState=null,t){if(void 0!==t.value){const e=this.getControlOid();if(e){let i=parseFloat(t.value);this.state.rxData.inverted&&(i=parseFloat(this.state.rxData.max)-i+parseFloat(this.state.rxData.min)),this.state.values["".concat(this.state.rxData.oid,".val")]!==i&&this.props.context.setValue(e,i)}}if(void 0!==t.valueMax){const e=this.getControlOid(!0);if(e){let i=parseFloat(t.valueMax);this.state.rxData["inverted-2"]&&(i=parseFloat(this.state.rxData.max)-i+parseFloat(this.state.rxData.min)),this.state.values["".concat(this.state.rxData["oid-2"],".val")]!==i&&this.props.context.setValue(e,i)}}}else console.error("This can't be true!")}),i?0:parseInt(this.state.rxData.timeout,10)||300),this.setState(this.newState)}renderIcon(t){let e;return e=t?this.state.rxData["icon-2"]||this.state.rxData["image-2"]:this.state.rxData.icon||this.state.rxData.image,e?(e&&e.startsWith("_PRJ_NAME/")&&(e=e.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/"))),(0,n.jsx)(f.Icon,{src:e})):null}renderText(t){return t?this.state.rxData["text-2"]:this.state.rxData.text}renderWidgetBody(t){super.renderWidgetBody(t),t.style.overflow="visible";const e=void 0===this.state.rxData.step||null===this.state.rxData.step?0:parseFloat(this.state.rxData.step);let i;return i="range"===this.state.rxData.type?(0,n.jsx)(b.Slider,{valueLabelFormat:t=>t+(this.state.rxData.unit||""),value:[parseFloat(this.state.value)||0,parseFloat(this.state.valueMax)||0],valueLabelDisplay:this.state.rxData.valueLabelDisplay||"auto",min:parseFloat(void 0===this.state.rxData.min||null===this.state.rxData.min?0:this.state.rxData.min),max:parseFloat(void 0===this.state.rxData.max||null===this.state.rxData.max?100:this.state.rxData.max),orientation:this.state.rxData.orientation||"horizontal",disabled:!!this.state.values["".concat(this.state.rxData["oid-working"],".val")],step:0===e?void 0:e,disableSwap:"range"===this.state.rxData.type||void 0,marks:0!==e||void 0,onChangeCommitted:(t,e)=>this.onChange(e,!0,!0),onChange:(t,e,i)=>this.onChange(e[i],!!i)},"control"):(0,n.jsx)(b.Slider,{valueLabelFormat:t=>t+(this.state.rxData.unit||""),value:parseFloat(this.state.value)||0,valueLabelDisplay:this.state.rxData.valueLabelDisplay||"auto",min:parseFloat(void 0===this.state.rxData.min||null===this.state.rxData.min?0:this.state.rxData.min),max:parseFloat(void 0===this.state.rxData.max||null===this.state.rxData.max?100:this.state.rxData.max),disabled:!!this.state.values["".concat(this.state.rxData["oid-working"],".val")],orientation:this.state.rxData.orientation||"horizontal",step:0===e?void 0:e,marks:0!==e||void 0,onChangeCommitted:(t,e)=>this.onChange(e,!1,!0),onChange:(t,e)=>this.onChange(e)},"control2"),(this.state.rxData.text||this.state.rxData["text-2"]||this.state.rxData.icon||this.state.rxData["icon-2"]||this.state.rxData.image||this.state.rxData["image-2"])&&(i=(0,n.jsxs)(b.Stack,{spacing:1,style:{width:"100%",height:"100%"},direction:"vertical"===this.state.rxData.orientation?"column":"row",sx:{mb:1},alignItems:"center",children:[this.renderText("vertical"===this.state.rxData.orientation),this.renderIcon("vertical"===this.state.rxData.orientation),i,this.renderIcon("vertical"!==this.state.rxData.orientation),this.renderText("vertical"!==this.state.rxData.orientation)]},"stack")),this.state.rxData.widgetTitle&&(i=(0,n.jsxs)(b.FormControl,{fullWidth:!0,style:{marginTop:"select"===this.state.rxData.type?5:void 0,width:"100%",height:"100%"},children:["select"===this.state.rxData.type?(0,n.jsx)(b.InputLabel,{children:this.state.rxData.widgetTitle}):(0,n.jsx)(b.FormLabel,{style:"slider"===this.state.rxData.type?{marginLeft:10}:void 0,children:this.state.rxData.widgetTitle}),i]},"form")),this.state.rxData["oid-working"]&&this.state.values["".concat(this.state.rxData["oid-working"],".val")]&&(i=[i,(0,n.jsx)(b.LinearProgress,{style:{position:"absolute",bottom:0,left:0,right:0}},"progress")]),(0,n.jsx)("div",{className:"vis-widget-body",style:{position:"relative"},children:i})}}ie.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const se=ie;class ae extends se{static getWidgetInfo(){const t={id:"tplJquiSliderVertical",visSet:"jqui",visName:"Vertical slider ",visWidgetLabel:"jqui_slider_vertical",visPrev:"widgets/jqui/img/Prev_SliderVertical.png",visOrder:25,visAttrs:se.getWidgetInfo().visAttrs,visDefaultStyle:{width:40,height:300}};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_slider_note"});return se.findField(t,"orientation").default="vertical",t}getWidgetInfo(){return ae.getWidgetInfo()}}ae.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const oe=ae;var ne=i(88160),re=i(5272),le=i(68344),de=(i(56119),i(74851),i(42197),i(29410),i(48512),i(15129),i(16708),i(84104),i(13740),i(60868),i(52610),i(76360)),ce=i.n(de);class he extends o.default{constructor(){super(...arguments),this.EASY_DATE_FORMAT="DD.MM.YYYY"}static getWidgetInfo(){return{id:"tplJquiInputDate",visSet:"jqui",visName:"Input Date",visWidgetLabel:"jqui_input_date",visPrev:"widgets/jqui/img/Prev_InputDate.png",visOrder:30,visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"variant",label:"jqui_variant",type:"select",options:[{label:"standard",value:"standard"},{label:"outlined",value:"outlined"},{label:"filled",value:"filled"}],default:"standard"},{name:"autoFocus",type:"checkbox"},{name:"clearable",label:"jqui_clearable",type:"checkbox"},{name:"widgetTitle",label:"jqui_widgetTitle",type:"text"},{name:"disableFuture",label:"jqui_disableFuture",type:"checkbox",hidden:"!!data.disablePast"},{name:"disablePast",label:"jqui_disablePast",type:"checkbox",hidden:"!!data.disableFuture"},{name:"asFullDate",label:"jqui_asFullDate",type:"checkbox"},{name:"displayWeekNumber",label:"jqui_displayWeekNumber",type:"checkbox"},{name:"wideFormat",label:"jqui_wideFormat",type:"checkbox"}]}],visDefaultStyle:{width:250,height:56}}}getWidgetInfo(){return he.getWidgetInfo()}renderWidgetBody(t){return super.renderWidgetBody(t),(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsx)(ne.$,{dateAdapter:le.R,adapterLocale:this.props.context.lang,children:(0,n.jsx)(re.l,{value:this.state.rxData.asFullDate?ce()(this.state.values["".concat(this.state.rxData.oid,".val")])||"":ce()(this.state.values["".concat(this.state.rxData.oid,".val")],this.EASY_DATE_FORMAT),label:this.state.rxData.widgetTitle||null,autoFocus:this.state.rxData.autoFocus||!1,onChange:t=>{if(!t)return;const e=this.state.rxData.asFullDate?t.toDate().toString():t.format(this.EASY_DATE_FORMAT);this.props.context.setValue(this.state.rxData.oid,e)},formatDensity:this.state.rxData.wideFormat?"spacious":"dense",slotProps:{textField:{variant:this.state.rxData.variant||"standard",style:{width:"100%",height:"100%"},classes:{root:this.props.classes.textRoot}},field:{clearable:this.state.rxData.clearable,onClear:()=>this.props.context.setValue(this.state.rxData.oid,"")}},disableFuture:this.state.rxData.disableFuture||!1,disablePast:this.state.rxData.disablePast||!1,displayWeekNumber:this.state.rxData.displayWeekNumber||!1})})})}}const pe=(0,V.withStyles)({textRoot:{"& .MuiInputBase-root":{width:"100%",height:"100%"}}})(he);var ue=i(98808);class ge extends o.default{static getWidgetInfo(){return{id:"tplJquiInputDatetime",visSet:"jqui",visName:"Input Time",visWidgetLabel:"jqui_input_time",visPrev:"widgets/jqui/img/Prev_InputDateTime.png",visOrder:31,visAttrs:[{name:"common",fields:[{name:"oid",type:"id"},{name:"variant",label:"jqui_variant",type:"select",options:[{label:"standard",value:"standard"},{label:"outlined",value:"outlined"},{label:"filled",value:"filled"}],default:"standard"},{name:"autoFocus",type:"checkbox"},{name:"clearable",label:"jqui_clearable",type:"checkbox"},{name:"widgetTitle",label:"jqui_widgetTitle",type:"text"},{name:"ampm",label:"jqui_ampm",type:"checkbox"},{name:"asDate",label:"jqui_asDate",type:"checkbox"},{name:"stepMinute",label:"jqui_stepMinute",type:"select",options:[{label:"1 minute",value:1},{label:"2 minutes",value:2},{label:"3 minutes",value:3},{label:"4 minutes",value:4},{label:"5 minutes",value:5},{label:"10 minutes",value:10},{label:"15 minutes",value:15},{label:"20 minutes",value:20},{label:"30 minutes",value:30},{label:"60 minutes",value:60}]}]}],visDefaultStyle:{width:250,height:56}}}getWidgetInfo(){return ge.getWidgetInfo()}renderWidgetBody(t){super.renderWidgetBody(t);const e=this.state.values["".concat(this.state.rxData.oid,".val")],i=this.state.rxData.asDate;return(0,n.jsx)("div",{className:"vis-widget-body",children:(0,n.jsx)(ne.$,{dateAdapter:le.R,adapterLocale:this.props.context.lang,children:(0,n.jsx)(ue.A,{value:e&&!i?ce()(e,"HH:mm"):ce()(e),ampm:this.state.rxData.ampm||!1,minutesStep:parseInt(this.state.rxData.stepMinute,10)||1,label:this.state.rxData.widgetTitle||null,formatDensity:"dense",format:"HH:mm",autoFocus:this.state.rxData.autoFocus||!1,onChange:t=>{if(!t)return;const e=i?t.second(0).millisecond(0).toDate().toString():t.format("HH:mm");this.props.context.setValue(this.state.rxData.oid,e)},slotProps:{textField:{variant:this.state.rxData.variant||"standard",style:{width:"100%",height:"100%"},classes:{root:this.props.classes.textRoot}},field:{clearable:this.state.rxData.clearable,onClear:()=>this.props.context.setValue(this.state.rxData.oid,"")}}})})})}}const ve=(0,V.withStyles)({textRoot:{"& .MuiInputBase-root":{width:"100%",height:"100%"}}})(ge);class me extends Pt{static getWidgetInfo(){const t={id:"tplJquiToogle",visSet:"jqui",visName:"Icon Toggle",visWidgetLabel:"jqui_icon_toggle",visPrev:"widgets/jqui/img/Prev_IconToggle.png",visOrder:32,visAttrs:Pt.getWidgetInfo().visAttrs,visDefaultStyle:{width:92,height:36}};t.visAttrs[0].fields.unshift({name:"_note",type:"help",text:"jqui_button_binary_control_note"});const e=Pt.findField(t,"icon_false");e&&(e.default="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik0xMyAzaC0ydjEwaDJWM3ptNC44MyAyLjE3bC0xLjQyIDEuNDJBNi45MiA2LjkyIDAgMCAxIDE5IDEyYzAgMy44Ny0zLjEzIDctNyA3QTYuOTk1IDYuOTk1IDAgMCAxIDcuNTggNi41OEw2LjE3IDUuMTdBOC45MzIgOC45MzIgMCAwIDAgMyAxMmE5IDkgMCAwIDAgMTggMGMwLTIuNzQtMS4yMy01LjE4LTMuMTctNi44M3oiLz48L3N2Zz4=");const i=Pt.findField(t,"color_true");return i&&(i.default="#93ff93"),t}getWidgetInfo(){return me.getWidgetInfo()}}me.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired,tpl:u().string.isRequired};const xe=me;class fe extends o.default{static getWidgetInfo(){return{id:"tplSTab",visSet:"tabs",visName:"SliderTabs",visSetLabel:"Tabs",visPrev:"widgets/tabs/img/Prev_SliderTabs.png",visWidgetLabel:"vis_2_widgets_widgets_tabs_label",visSetIcon:"widgets/tabs/img/Prev_SliderTabs.png",visAttrs:[{name:"common",fields:[{name:"show_tabs",type:"slider",min:1,max:20,label:"vis_2_widgets_widgets_tabs_show_tabs",default:2},{name:"vertical",type:"checkbox",label:"vis_2_widgets_widgets_tabs_vertical"},{name:"variant",type:"select",label:"vis_2_widgets_widgets_tabs_variant",hidden:t=>t.vertical,options:[{value:"",label:"vis_2_widgets_widgets_tabs_variant_default"},{value:"centered",label:"vis_2_widgets_widgets_tabs_variant_centered"},{value:"fullWidth",label:"vis_2_widgets_widgets_tabs_variant_full_width"}]},{name:"color",type:"color",label:"vis_2_widgets_widgets_tabs_color"}]},{name:"node",label:"vis_2_widgets_widgets_tabs_group_tab",indexFrom:1,indexTo:"show_tabs",fields:[{name:"title_tab_",label:"vis_2_widgets_widgets_tabs_tab_title"},{name:"contains_view_",multiple:!1,type:"select-views",label:"vis_2_widgets_widgets_tabs_tab_view"},{name:"icon_tab_",type:"icon64",label:"vis_2_widgets_widgets_tabs_tab_icon",hidden:(t,e)=>t["image_tab_".concat(e)]},{name:"image_tab_",type:"image",label:"vis_2_widgets_widgets_tabs_tab_image",hidden:(t,e)=>t["icon_tab_".concat(e)]},{name:"icon_size_",type:"slider",min:0,max:100,label:"vis_2_widgets_widgets_tabs_tab_icon_size",hidden:(t,e)=>!t["icon_tab_".concat(e)]&&!t["image_tab_".concat(e)]},{name:"icon_color_",type:"color",label:"vis_2_widgets_widgets_tabs_tab_icon_color",hidden:(t,e)=>!t["icon_tab_".concat(e)]},{name:"overflow_x_",label:"vis_2_widgets_widgets_tabs_tab_overflow_x",type:"select",noTranslation:!0,options:["","visible","hidden","scroll","auto","initial","inherit"]},{name:"overflow_y_",label:"vis_2_widgets_widgets_tabs_tab_overflow_y",type:"select",noTranslation:!0,options:["","visible","hidden","scroll","auto","initial","inherit"]}]}],visDefaultStyle:{width:250,height:250}}}async componentDidMount(){super.componentDidMount();let t=window.localStorage.getItem("".concat(this.props.id,"-tabIndex"));t&&(t=parseInt(t,10)||0),this.setState({tabIndex:t})}getWidgetInfo(){return fe.getWidgetInfo()}getWidgetView(){const t=this.state.rxData["contains_view_".concat(this.state.tabIndex+1)],e={flex:1,position:"relative"},i=this.state.rxData["overflow_x_".concat(this.state.tabIndex+1)],s=this.state.rxData["overflow_y_".concat(this.state.tabIndex+1)];return i&&s?s===i?e.overflow=i:(e.overflowX=i,e.overflowY=s):i?e.overflowX=i:s?e.overflowY=s:e.overflow="hidden",(0,n.jsxs)("div",{className:"vis-widget-body",style:e,children:[this.state.editMode?(0,n.jsx)("div",{className:"vis-editmode-helper"}):null,t?super.getWidgetView(t):null]})}renderWidgetBody(t){super.renderWidgetBody(t),void 0===t.style.width&&(t.style.width=250),void 0===t.style.height&&(t.style.height=250);const e=[];for(let i=0;i<parseInt(this.state.rxData.show_tabs,10);i++){const t=this.state.rxData["icon_color_".concat(i+1)],s=this.state.rxData["icon_tab_".concat(i+1)];let a=this.state.rxData["image_tab_".concat(i+1)];const o=this.state.rxData["icon_size_".concat(i+1)],r=this.state.rxData["title_tab_".concat(i+1)];a&&a.startsWith("_PRJ_NAME/")&&(a=a.replace("_PRJ_NAME/","../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName,"/"))),e.push((0,n.jsx)(b.Tab,{label:r||(s||a?"":"Tab ".concat(i+1)),icon:s?(0,n.jsx)(f.Icon,{src:s,style:{color:t,width:o,height:o}}):a?(0,n.jsx)(f.Icon,{src:a,style:{width:o,height:o}}):null,iconPosition:"start",value:i,style:{color:this.state.rxData.color,textTransform:"none"},wrapped:!0},i.toString()))}return(0,n.jsxs)("div",{className:"vis-widget-body",style:{display:"flex",flexDirection:this.state.rxData.vertical?"row":"column"},children:[(0,n.jsx)("div",{style:{width:"100%",overflow:"hidden"},children:(0,n.jsx)(b.Tabs,{TabIndicatorProps:{style:{backgroundColor:this.state.rxData.color}},value:this.state.tabIndex||0,onChange:(t,e)=>{window.localStorage.setItem("".concat(this.props.id,"-tabIndex"),e.toString()),this.setState({tabIndex:e})},scrollButtons:"auto",centered:"centered"===this.state.rxData.variant,variant:"fullWidth"===this.state.rxData.variant?"fullWidth":"centered"===this.state.rxData.variant?void 0:"scrollable",orientation:this.state.rxData.vertical?"vertical":void 0,children:e})}),this.getWidgetView()]})}}fe.propTypes={id:u().string.isRequired,context:u().object.isRequired,view:u().string.isRequired,editMode:u().bool.isRequired};const ye=[r,d,x,z,X,Z,w,j,k,M,R,h,N,q,O,A,F,tt,it,at,nt,ct,pt,gt,mt,ft,wt,Dt,St,jt,Mt,Rt,kt,qt,At,Pt,Et,Jt,Gt,Qt,ee,lt,se,oe,Kt,$t,pe,ve,xe,fe]},83640:(t,e,i)=>{i.d(e,{A:()=>D});var s=i(30678),a=i.n(s),o=i(5770),n=i(73258),r=i(30419),l=i(18644),d=i(28298),c=i(21388),h=i(37886),p=i(26879),u=i(2913),g=i(65198),v=i(86219),m=i(99277);const x=[".png",".jpg",".svg",".gif",".apng",".avif",".webp"],f=t=>{let{id:e,children:i,index:a,moveCard:o,onDropped:n,selected:r}=t;const l=(0,s.useRef)(null),[{handlerId:d},p]=(0,c.H)({accept:"widget",collect:t=>({handlerId:t.getHandlerId()}),drop(){n()},hover(t,e){var i;if(!l.current)return;const s=t.index,n=a;if(s===n)return;const r=null===(i=l.current)||void 0===i?void 0:i.getBoundingClientRect(),d=(r.bottom-r.top)/2,c=e.getClientOffset(),h=((null===c||void 0===c?void 0:c.y)||0)-r.top;s<n&&h<d||s>n&&h>d||(o(s,n),t.index=n)}}),[{isDragging:u},v]=(0,h.i)({type:"widget",item:()=>({id:e,index:a}),collect:t=>({isDragging:t.isDragging()})}),x=u?0:1;return v(p(l)),(0,m.jsx)(g.MenuItem,{ref:l,selected:r,style:{opacity:x},"data-handler-id":d,onClick:()=>n(a),children:i})};class y extends a().Component{constructor(t){super(t),this.imageRef=void 0,this.widgetTypes=void 0,this.moveCard=(t,e)=>{const i=[...this.state.order],s=i[t];i.splice(t,1),i.splice(e,0,s),this.setState({order:i})},this.widgetTypes=(0,v.Y7)(),this.imageRef=[];for(let e=0;e<this.props.order.length;e++)this.imageRef.push(a().createRef());this.state={order:[...this.props.order]}}componentDidUpdate(){for(let e=0;e<this.state.order.length;e++){var t;if(null!==(t=this.imageRef[e].current)&&void 0!==t&&t.children[0]){const t=this.imageRef[e].current.children[0].clientHeight;t>34&&(this.imageRef[e].current.style.transform="scale(".concat(34/t,")"))}}}getWidgetDiv(t,e){var i;const s=this.props.views[this.props.view].widgets[t],a=s.tpl,o=this.widgetTypes.find((t=>t.name===a));let r=(null===o||void 0===o?void 0:o.title)||"",l=null===o||void 0===o?void 0:o.setColor;null!==o&&void 0!==o&&o.label&&(r=n.I18n.t(o.label)),r=r.split("<br")[0],r=r.split("<span")[0],r=r.split("<div")[0];let d=null===o||void 0===o?void 0:o.set;if(null!==o&&void 0!==o&&o.setLabel)d=n.I18n.t(o.setLabel);else if(d){const t=this.widgetTypes.find((t=>t.set===d&&t.setLabel));t&&(l=t.setColor,t.setLabel&&(d=n.I18n.t(t.setLabel)))}let c,h,p=(null===o||void 0===o?void 0:o.preview)||"";if(p.startsWith("<img")){const t=p.match(/src="([^"]+)"/);t&&t[1]&&(p=t[1])}if(null!==o&&void 0!==o&&null!==(i=o.preview)&&void 0!==i&&i.startsWith("<img")){const e=(null===o||void 0===o?void 0:o.preview.match(/src="([^"]+)"/))||(null===o||void 0===o?void 0:o.preview.match(/src='([^']+)'/));e&&(c=(0,m.jsx)("img",{src:e[1],className:this.props.classes.icon,alt:t}))}else if(null!==o&&void 0!==o&&o.preview){const e=o.preview.toLowerCase();x.find((t=>e.endsWith(t)))&&(c=(0,m.jsx)("img",{src:null===o||void 0===o?void 0:o.preview,className:this.props.classes.icon,alt:t}))}return!c&&null!==o&&void 0!==o&&o.preview&&(c=(0,m.jsx)("span",{className:this.props.classes.widgetImage,ref:this.imageRef[e],dangerouslySetInnerHTML:{__html:o.preview}})),l&&(h=n.Utils.getInvertedColor(l,this.props.themeType,!1),"#DDD"===h?h="#FFF":"#111"===h&&(h="#000")),"_tplGroup"===a&&(r=n.I18n.t("group")),s.marketplace&&(d="".concat(s.marketplace.name),r="".concat(n.I18n.t("version")," ").concat(s.marketplace.version)),(0,m.jsx)(f,{id:t,index:e,selected:this.props.wid===t,moveCard:this.moveCard,onDropped:t=>this.onMove(t),children:(0,m.jsxs)("div",{style:{display:"flex",flexWrap:"wrap"},children:[p?(0,m.jsx)("div",{className:this.props.classes.widgetIcon,children:c}):null,(0,m.jsx)("div",{className:this.props.classes.widgetName,children:t}),(0,m.jsxs)("div",{className:this.props.classes.widgetType,children:[(0,m.jsx)("div",{style:{fontWeight:"bold",color:l,backgroundColor:h},className:n.Utils.clsx(this.props.classes.widgetNameText,h&&this.props.classes.coloredWidgetSet),children:d}),(0,m.jsx)("div",{className:this.props.classes.widgetNameText,children:r})]})]})},t)}onMove(t){if(void 0!==t){const e=[...this.state.order],i=e[t];return e[t]=this.props.wid,e[this.state.order.indexOf(this.props.wid)]=i,void this.setState({order:e},(()=>{JSON.stringify(this.state.order)!==JSON.stringify(this.props.order)&&this.props.onClose(this.state.order)}))}JSON.stringify(this.state.order)!==JSON.stringify(this.props.order)&&this.props.onClose(this.state.order)}render(){return(0,m.jsxs)(g.Menu,{anchorEl:this.props.anchorEl,open:!0,onClose:()=>this.props.onClose(),children:[(0,m.jsx)("div",{style:{padding:21,fontWeight:"normal",width:250,fontSize:12,fontStyle:"italic",textAlign:"center"},children:n.I18n.t("order_help")}),(0,m.jsx)(p.Q,{backend:u.t2,children:this.state.order.map(((t,e)=>this.getWidgetDiv(t,e)))})]})}}const w=(0,d.withStyles)((()=>({widgetIcon:{overflow:"hidden",width:40,height:40,display:"inline-block",marginRight:4},icon:{width:"100%",height:"100%",objectFit:"contain"},widgetName:{verticalAlign:"top",display:"inline-block"},widgetImage:{display:"block",width:30,height:30,transformOrigin:"0 0"},widgetType:{verticalAlign:"top",display:"inline-block",fontSize:12,fontStyle:"italic",marginLeft:8},widgetNameText:{lineHeight:"20px"},coloredWidgetSet:{padding:"0 3px",borderRadius:3},number:{marginRight:8}})))(y);class b extends a().Component{constructor(t){var e,i,s;super(t),this.relativeMoveMenu=void 0,this.resize=!1,this.uuid="".concat(Date.now(),".").concat(Math.round(1e6*Math.random())),this.refService=a().createRef(),this.widDiv=null,this.onCommandBound=void 0,this.onResize=void 0,this.updateInterval=void 0,this.pressTimeout=void 0,this.shadowDiv=void 0,this.stealCursor=void 0,this.beforeIncludeColor=void 0,this.lastClick=void 0,this.movement=void 0,this.resizeLocked=void 0,this.visDynamicResizable=void 0,this.isCanWidget=void 0,this.onMove=(t,e,i,s)=>{if(this.state.multiViewWidget||!this.state.editMode)return;const a=this.movement;if(this.refService.current)if(this.resize){if(!1===this.isResizable())return;if(void 0===t){var o;const t=null===(o=this.widDiv||this.refService.current)||void 0===o?void 0:o.getBoundingClientRect();t&&(this.movement={top:this.refService.current.offsetTop,left:this.refService.current.offsetLeft,width:t.width,height:t.height});this.refService.current.querySelectorAll(".vis-editmode-resizer").forEach((t=>{t._storedOpacity=t.style.opacity,t.style.opacity="0.3"}))}else a&&void 0!==e&&void 0!==t&&("top"===this.resize?(this.refService.current.style.top="".concat(a.top+e,"px"),this.refService.current.style.height="".concat(a.height-e,"px"),this.resizeLocked&&(this.refService.current.style.width=this.refService.current.style.height),this.widDiv&&(this.widDiv.style.top="".concat(a.top+e,"px"),this.widDiv.style.height="".concat(a.height-e,"px"),this.resizeLocked&&(this.widDiv.style.width=this.widDiv.style.height))):"bottom"===this.resize?(this.widDiv&&(this.widDiv.style.height="".concat(a.height+e,"px")),this.refService.current.style.height="".concat(a.height+e,"px"),this.resizeLocked&&(this.refService.current.style.width=this.refService.current.style.height),this.widDiv&&this.resizeLocked&&(this.widDiv.style.width=this.widDiv.style.height)):"left"===this.resize?(this.refService.current.style.left="".concat(a.left+t,"px"),this.refService.current.style.width="".concat(a.width-t,"px"),this.resizeLocked&&(this.refService.current.style.height=this.refService.current.style.width),this.widDiv&&(this.widDiv.style.left="".concat(a.left+t,"px"),this.widDiv.style.width="".concat(a.width-t,"px"),this.resizeLocked&&(this.widDiv.style.height=this.widDiv.style.width))):"right"===this.resize?(this.widDiv&&(this.widDiv.style.width="".concat(a.width+t,"px")),this.refService.current.style.width="".concat(a.width+t,"px"),this.resizeLocked&&(this.refService.current.style.height=this.refService.current.style.width),this.widDiv&&this.resizeLocked&&(this.widDiv.style.height=this.widDiv.style.width)):"top-left"===this.resize?(this.refService.current.style.top="".concat(a.top+e,"px"),this.refService.current.style.left="".concat(a.left+t,"px"),this.refService.current.style.height="".concat(a.height-e,"px"),this.refService.current.style.width="".concat(a.width-t,"px"),this.resizeLocked&&(this.refService.current.style.height=this.refService.current.style.width),this.widDiv&&(this.widDiv.style.top="".concat(a.top+e,"px"),this.widDiv.style.left="".concat(a.left+t,"px"),this.widDiv.style.height="".concat(a.height-e,"px"),this.widDiv.style.width="".concat(a.width-t,"px"),this.resizeLocked&&(this.widDiv.style.height=this.widDiv.style.width))):"top-right"===this.resize?(this.refService.current.style.top="".concat(a.top+e,"px"),this.refService.current.style.height="".concat(a.height-e,"px"),this.refService.current.style.width="".concat(a.width+t,"px"),this.resizeLocked&&(this.refService.current.style.height=this.refService.current.style.width),this.widDiv&&(this.widDiv.style.top="".concat(a.top+e,"px"),this.widDiv.style.height="".concat(a.height-e,"px"),this.widDiv.style.width="".concat(a.width+t,"px"),this.resizeLocked&&(this.widDiv.style.height=this.widDiv.style.width))):"bottom-left"===this.resize?(this.refService.current.style.left="".concat(a.left+t,"px"),this.refService.current.style.height="".concat(a.height+e,"px"),this.refService.current.style.width="".concat(a.width-t,"px"),this.resizeLocked&&(this.refService.current.style.height=this.refService.current.style.width),this.widDiv&&(this.widDiv.style.left="".concat(a.left+t,"px"),this.widDiv.style.height="".concat(a.height+e,"px"),this.widDiv.style.width="".concat(a.width-t,"px"),this.resizeLocked&&(this.widDiv.style.height=this.widDiv.style.width))):(this.refService.current.style.height="".concat(a.height+e,"px"),this.refService.current.style.width="".concat(a.width+t,"px"),this.resizeLocked&&(this.refService.current.style.height=this.refService.current.style.width),this.widDiv&&(this.widDiv.style.height="".concat(a.height+e,"px"),this.widDiv.style.width="".concat(a.width+t,"px"),this.resizeLocked&&(this.widDiv.style.height=this.widDiv.style.width))));if(i){var n;const t=null===(n=this.refService.current)||void 0===n?void 0:n.querySelectorAll(".vis-editmode-resizer");null===t||void 0===t||t.forEach((t=>{void 0!==t._storedOpacity&&(t.style.opacity=t._storedOpacity,delete t._storedOpacity)})),this.resize=!1,this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,style:{top:this.refService.current.style.top,left:this.refService.current.style.left,width:this.refService.current.style.width,height:this.refService.current.style.height}}]),this.movement=void 0}}else if(void 0===t){if(!1===this.state.draggable)return;this.movement={top:this.refService.current.offsetTop,left:this.refService.current.offsetLeft,order:[...this.props.relativeWidgetOrder],width:0,height:0};this.refService.current.querySelectorAll(".vis-editmode-resizer").forEach((t=>t.style.display="none")),this.props.isRelative&&this.createWidgetMovementShadow()}else if(this.movement&&void 0!==e&&void 0!==t){const a="".concat(this.movement.left+t,"px"),o="".concat(this.movement.top+e,"px");if(this.refService.current&&(this.refService.current.style.left=a,this.refService.current.style.top=o),this.widDiv&&(this.widDiv.style.left=a,this.widDiv.style.top=o,this.widDiv._customHandlers&&this.widDiv._customHandlers.onMove&&this.widDiv._customHandlers.onMove(this.widDiv,this.props.id)),this.props.isRelative&&s&&s(this.props.id,a,o,this.shadowDiv,this.movement.order),i){if(this.refService.current.querySelectorAll(".vis-editmode-resizer").forEach((t=>t.style.display="block")),this.props.isRelative){let t=this.props.refParent;Object.prototype.hasOwnProperty.call(t,"current")&&(t=t.current),this.widDiv?(this.widDiv.style.position="relative",this.widDiv.style.top="0",this.widDiv.style.left="0",t.insertBefore(this.widDiv,this.shadowDiv),this.refService.current.style.top="".concat(this.widDiv.offsetTop,"px"),this.refService.current.style.left="".concat(this.widDiv.offsetLeft,"px")):(t.insertBefore(this.refService.current,this.shadowDiv),this.refService.current.style.position="relative",this.refService.current.style.top="0",this.refService.current.style.left="0"),this.shadowDiv.remove(),this.shadowDiv=null,this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,style:{left:null,top:null}}],this.props.view,{order:this.movement.order})}else this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,style:{left:this.movement.left+t,top:this.movement.top+e}}]);this.movement=void 0}}},this.onTempSelect=t=>{var e;const i=null===(e=this.refService.current)||void 0===e?void 0:e.querySelector(".vis-editmode-overlay");i&&(null===t||void 0===t?this.props.selectedWidgets.includes(this.props.id)?i.className.includes("vis-editmode-selected")||(i.className=(0,l.iQ)("vis-editmode-selected",i.className)):(i.style.backgroundColor="",i.className=(0,l.vy)(i.className,"vis-editmode-selected")):t?i.className.includes("vis-editmode-selected")||(i.className=(0,l.iQ)("vis-editmode-selected",i.className)):i.className=(0,l.vy)(i.className,"vis-editmode-selected"))};const o=t.context.views[t.view].widgets[t.id],n=t.id.includes("_"),d=!n&&t.editMode&&(null===(e=t.selectedWidgets)||void 0===e?void 0:e.includes(t.id)),c=(0,r.Go)(o.data||{}),h=(0,r.Go)(o.style||{});b.replacePRJ_NAME(c,h,t),this.state={data:c,style:h,applyBindings:!1,editMode:!n&&this.props.editMode,multiViewWidget:n,selected:d,selectedOne:d&&1===this.props.selectedWidgets.length,resizable:!0,resizeHandles:["n","e","s","w","nw","ne","sw","se"],widgetHint:t.context.widgetHint,isHidden:b.isWidgetFilteredOutStatic(t.viewsActiveFilter,o.data,t.view,t.editMode),hideHelper:!1,gap:"relative"===h.position&&(0,r.Ny)(null===(i=t.context.views[t.view].settings)||void 0===i?void 0:i.rowGap)?parseFloat(null===(s=t.context.views[t.view].settings)||void 0===s?void 0:s.rowGap):0},this.onCommandBound=this.onCommand.bind(this)}static replacePRJ_NAME(t,e,i){const s=i.context;t&&(delete t._originalData,Object.keys(t).forEach((e=>{e&&t[e]&&"string"===typeof t[e]&&(e.startsWith("src")||e.endsWith("src")||e.includes("icon"))&&t[e].startsWith("_PRJ_NAME")&&(t._originalData||(t._originalData=JSON.stringify(t)),t[e]="../".concat(s.adapterName,".").concat(s.instance,"/").concat(s.projectName).concat(t[e].substring(9)))}))),e&&(delete e._originalData,e["background-image"]&&e["background-image"].startsWith("_PRJ_NAME")&&(e._originalData||(e._originalData=JSON.stringify(e)),e["background-image"]="../".concat(s.adapterName,".").concat(s.instance,"/").concat(s.projectName).concat(e["background-image"].substring(9))))}componentDidMount(){this.props.askView&&this.props.askView("register",{id:this.props.id,uuid:this.uuid,widDiv:this.widDiv,refService:this.refService,onMove:this.onMove,onResize:this.onResize,onTempSelect:this.onTempSelect,onCommand:this.onCommandBound})}componentWillUnmount(){this.updateInterval&&clearInterval(this.updateInterval),this.updateInterval=void 0,this.pressTimeout&&clearTimeout(this.pressTimeout),this.pressTimeout=void 0,this.props.askView&&this.props.askView("unregister",{id:this.props.id,uuid:this.uuid}),this.shadowDiv&&(this.shadowDiv.remove(),this.shadowDiv=null)}onCommand(t,e){if("includePossible"===t){var i;const t=null===(i=this.refService.current)||void 0===i?void 0:i.querySelector(".vis-editmode-overlay");return t&&void 0===this.beforeIncludeColor&&(this.beforeIncludeColor=t.style.backgroundColor,t.style.backgroundColor="rgba(0, 255, 0, 0.3)"),!0}if("includePossibleNOT"===t){if(void 0!==this.beforeIncludeColor){var s;const t=null===(s=this.refService.current)||void 0===s?void 0:s.querySelector(".vis-editmode-overlay");t&&(t.style.backgroundColor=this.beforeIncludeColor),this.beforeIncludeColor=void 0}return!0}if("startStealMode"===t){var a,o;this.stealCursor=(null===(a=this.refService.current)||void 0===a?void 0:a.style.cursor)||"nocursor",this.refService.current&&(this.refService.current.style.cursor="crosshair",this.refService.current.className=(0,l.iQ)(this.refService.current.className,"vis-editmode-steal-style"));const t=null===(o=this.refService.current)||void 0===o?void 0:o.querySelectorAll(".vis-editmode-resizer");return null===t||void 0===t||t.forEach((t=>t.style.display="none")),!0}if("cancelStealMode"===t){var n;"nocursor"!==this.stealCursor&&this.refService.current&&this.stealCursor&&(this.refService.current.style.cursor=this.stealCursor),this.stealCursor=void 0,this.refService.current&&(this.refService.current.className=(0,l.vy)(this.refService.current.className,"vis-editmode-steal-style"));const t=null===(n=this.refService.current)||void 0===n?void 0:n.querySelectorAll(".vis-editmode-resizer");return null===t||void 0===t||t.forEach((t=>t.style.display="")),!0}if("startMove"===t||"startResize"===t){var r;const e=null===(r=this.refService.current)||void 0===r?void 0:r.querySelector(".vis-editmode-overlay");return e&&(this.state.selected?e.className=(0,l.vy)(e.className,"vis-editmode-selected"):e.className=(0,l.vy)(e.className,"vis-editmode-overlay-not-selected")),"startResize"===t&&(this.resize=!0),!0}if("stopMove"===t||"stopResize"===t){var d,c;const e=null===(d=this.refService.current)||void 0===d?void 0:d.querySelector(".vis-editmode-overlay");e&&(void 0!==this.beforeIncludeColor&&(e.style.backgroundColor=this.beforeIncludeColor,this.beforeIncludeColor=void 0),this.state.selected?e.className=(0,l.iQ)(e.className,"vis-editmode-selected"):e.className=(0,l.iQ)(e.className,"vis-editmode-overlay-not-selected"));const i=null===(c=this.refService.current)||void 0===c?void 0:c.querySelectorAll(".vis-editmode-resizer");return null===i||void 0===i||i.forEach((t=>t.style.display="block")),"stopResize"===t&&(this.resize=!1),!0}return!1}static getDerivedStateFromProps(t,e){var i,s,a,o;const n=t.context;let d=null,c=n.views[t.view].widgets[t.id];const h="relative"===c.style.position&&(0,r.Ny)(null===(i=n.views[t.view].settings)||void 0===i?void 0:i.rowGap)?parseFloat(null===(s=n.views[t.view].settings)||void 0===s?void 0:s.rowGap):0;let p=!1;if(c.groupid){const e=n.views[t.view].widgets[c.groupid].data,i=Object.keys(e).map((t=>t.startsWith("attrType_")?t.substring(9):null)).filter((t=>t));if(i.length&&c.data)for(const[t,s]of Object.entries(c.data))if("string"===typeof s&&i.find((t=>s.includes(t)))){const i=(0,l.bx)(c.data[t],e);i.doesMatch&&(p||(p=!0,c=(0,r.Go)(c)),c.data[t]=i.newString||"")}}const u=null!==(a=e.style)&&void 0!==a&&a._originalData?e.style._originalData:JSON.stringify(e.style),g=null!==(o=e.data)&&void 0!==o&&o._originalData?e.data._originalData:JSON.stringify(e.data),v=b.isWidgetFilteredOutStatic(t.viewsActiveFilter,c.data,t.view,t.editMode);if(JSON.stringify(c.style||{})!==u||JSON.stringify(c.data||{})!==g||h!==e.gap||v!==e.isHidden){if(!t.runtime){const e=JSON.parse(u);Object.keys(e).forEach((i=>{const s=c.style[i],a=e[i];a!==s&&console.log("[".concat(Date.now()," / ").concat(t.id,"] Rerender because of style.").concat(i,": ").concat(a," !== ").concat(s))})),Object.keys(c.style).forEach((i=>{const s=c.style[i],a=e[i];a!==s&&console.log("[".concat(Date.now()," / ").concat(t.id,"] Rerender because of style.").concat(i,": ").concat(a," !== ").concat(s))}));const i=JSON.parse(g);Object.keys(i).forEach((e=>{JSON.stringify(i[e])!==JSON.stringify(c.data[e])&&console.log("[".concat(Date.now()," / ").concat(t.id,"] Rerender because of data.").concat(e,": ").concat(i[e]," !== ").concat(c.data[e]))}))}let e,i;p?(e=c.data||{bindings:[]},i=c.style||{bindings:[]}):(e=c.data?(0,r.Go)(c.data):{bindings:[]},i=c.style?(0,r.Go)(c.style):{bindings:[]}),b.replacePRJ_NAME(e,i,t),d={},d.isHidden=v,d.style=i,d.data=e,d.gap=h,d.applyBindings={top:c.style.top,left:c.style.left}}t.editMode!==e.editMode&&(d=d||{},d.editMode=t.editMode,d.applyBindings=!0),t.context.widgetHint!==e.widgetHint&&(d=d||{},d.widgetHint=t.context.widgetHint);const m=!e.multiViewWidget&&t.editMode&&t.selectedWidgets&&t.selectedWidgets.includes(t.id),x=m&&1===t.selectedWidgets.length;return m===e.selected&&x===e.selectedOne||(d=d||{},d.selected=m,d.selectedOne=x),d}static removeFromArray(t,e,i,s){t&&Object.keys(t).forEach((a=>{if(!e||e.includes(a))for(let e=t[a].length-1;e>=0;e--){const o=t[a][e];o.view===i&&o.widget===s&&t[a].splice(e,1)}}))}static parseStyle(t,e){const i={};return(t||"").split(";").forEach((t=>{if(t=t.trim()){let[s,a]=t.split(":");if(s=s.trim(),s&&a){if(a=a.trim(),!e&&("top"===s||"left"===s||"width"===s||"height"===s))if(e){const t=parseFloat(a);a===t.toString()&&(a=t)}else"0"!==a&&a.match(/^[-+]?\d+$/)&&(a="".concat(a,"px"));a&&(e&&(s=s.replace(/(-\w)/,(t=>t[1].toUpperCase()))),i[s]=a)}}})),i}onMouseDown(t){if(t.stopPropagation(),this.stealCursor&&!this.state.multiViewWidget)return t.stopPropagation(),void this.props.mouseDownOnView(t,this.props.id,this.props.isRelative);if(!this.props.context.views[this.props.view].widgets[this.props.id].data.locked)if(void 0!==this.lastClick&&Date.now()-this.lastClick<250&&console.log("AAA"),this.lastClick&&this.state.multiViewWidget){if(Date.now()-this.lastClick<250){const t=this.props.id.split("_"),e=t[0],i=t[1];this.props.context.setSelectedWidgets([i],e)}this.lastClick=Date.now()}else if(t.shiftKey||t.ctrlKey){const t=this.props.selectedWidgets.indexOf(this.props.id);if(-1===t){const t=[...this.props.selectedWidgets,this.props.id];this.props.context.setSelectedWidgets(t)}else{const e=[...this.props.selectedWidgets];e.splice(t,1),this.props.context.setSelectedWidgets(e)}}else this.props.selectedWidgets.includes(this.props.id)?this.props.moveAllowed&&!1!==this.state.draggable&&(this.props.isRelative?this.lastClick&&Date.now()-this.lastClick<250&&1===this.props.selectedWidgets.length&&"_tplGroup"===this.props.context.views[this.props.view].widgets[this.props.selectedWidgets[0]].tpl&&this.props.context.setSelectedGroup(this.props.selectedWidgets[0]):this.props.mouseDownOnView(t,this.props.id,this.props.isRelative,!1,void 0!==this.lastClick&&Date.now()-this.lastClick<300)):this.props.context.setSelectedWidgets([this.props.id]),this.lastClick=Date.now()}createWidgetMovementShadow(){if(this.shadowDiv&&(this.shadowDiv.remove(),this.shadowDiv=null),!this.movement)return void console.error("Unknown issue, movement is falsy");this.shadowDiv=window.document.createElement("div"),this.shadowDiv.setAttribute("id","".concat(this.props.id,"_shadow")),this.shadowDiv.className="vis-editmode-widget-shadow",this.refService.current&&(this.shadowDiv.style.width="".concat(this.refService.current.clientWidth,"px"),this.shadowDiv.style.height="".concat(this.refService.current.clientHeight,"px"),this.refService.current.style.borderRadius&&(this.shadowDiv.style.borderRadius=this.refService.current.style.borderRadius));let t=this.props.refParent;Object.prototype.hasOwnProperty.call(t,"current")&&(t=t.current),this.widDiv?(t.insertBefore(this.shadowDiv,this.widDiv),this.widDiv.style.position="absolute",this.widDiv.style.left="".concat(this.movement.left,"px"),this.widDiv.style.top="".concat(this.movement.top,"px")):(t.insertBefore(this.shadowDiv,this.refService.current),this.refService.current&&(this.refService.current.style.position="absolute")),this.refService.current&&(this.refService.current.style.left="".concat(this.movement.left,"px"),this.refService.current.style.top="".concat(this.movement.top,"px"))}isResizable(){return this.visDynamicResizable?"boolean"===typeof this.state.data.visResizable?this.state.data.visResizable:this.visDynamicResizable.default:this.state.resizable}onResizeStart(t,e){t.stopPropagation(),this.resize=e,this.props.mouseDownOnView(t,this.props.id,this.props.isRelative,!0)}getResizeHandlers(t,e){var i;if(!this.state.editMode||!t||1!==(null===(i=this.props.selectedWidgets)||void 0===i?void 0:i.length))return null;const s="".concat(.3-.4,"em"),a="".concat(.4,"em"),o="".concat(.3,"em"),n="".concat(.4,"em"),r="".concat(.3-.4,"em"),l="100%"===e.style.width,d="100%"===e.style.height,c="#014488",h="0.1em dashed ".concat(c),p="0.1em dashed #888",u=this.isResizable();let g=u&&this.state.resizeHandles?this.state.resizeHandles:[];u&&this.props.selectedGroup&&this.props.selectedGroup===this.props.id&&(g=["s","e","se"]);const v=.9,x=.5,f=e.usedInWidget||this.props.isRelative,y={top:!f&&g.includes("n"),bottom:!e.usedInWidget&&!d&&g.includes("s"),left:!f&&g.includes("w"),right:!e.usedInWidget&&!l&&g.includes("e"),"top-left":!d&&!l&&!f&&g.includes("nw"),"top-right":!d&&!l&&!f&&g.includes("ne"),"bottom-left":!d&&!l&&!f&&g.includes("sw"),"bottom-right":!d&&!l&&!e.usedInWidget&&g.includes("se")},w={top:{top:r,height:n,left:y["top-left"]?o:0,right:y["top-right"]?o:0,cursor:"ns-resize",background:"transparent",opacity:y.top?v:x,borderTop:y.top?h:p},bottom:{bottom:r,height:n,left:y["bottom-left"]?o:0,right:y["bottom-right"]?o:0,cursor:"ns-resize",background:"transparent",opacity:y.bottom?v:x,borderBottom:y.bottom?h:p},left:{top:y["top-left"]?o:0,bottom:y["bottom-left"]?o:0,left:r,width:n,cursor:"ew-resize",background:"transparent",opacity:y.left?v:x,borderLeft:y.left?h:p},right:{top:y["top-right"]?o:0,bottom:y["bottom-right"]?o:0,right:r,width:n,cursor:"ew-resize",background:"transparent",opacity:y.right?v:x,borderRight:y.right?h:p},"top-left":{top:s,height:a,left:s,width:a,cursor:"nwse-resize",background:c,opacity:v},"top-right":{top:s,height:a,right:s,width:a,cursor:"nesw-resize",background:c,opacity:v},"bottom-left":{bottom:s,height:a,left:s,width:a,cursor:"nesw-resize",background:c,opacity:v},"bottom-right":{bottom:s,height:a,right:s,width:a,cursor:"nwse-resize",background:c,opacity:v}},b={position:"absolute",zIndex:1001};return Object.keys(w).map((t=>{const e=w[t];if(!y[t]){if(t.includes("-"))return null;e.cursor="default"}return(0,m.jsx)("div",{className:"vis-editmode-resizer",style:Object.assign(e,b),onMouseDown:e.opacity===v?e=>this.onResizeStart(e,t):void 0},t)}))}isUserMemberOfGroup(t,e){return!e||(Array.isArray(e)||(e=[e]),!!e.find((e=>{var i,s;const a=this.props.context.userGroups["system.group.".concat(e)];return(null===a||void 0===a||null===(i=a.common)||void 0===i||null===(s=i.members)||void 0===s?void 0:s.length)&&a.common.members.includes("system.user.".concat(t))})))}static isWidgetFilteredOutStatic(t,e,i,s){if(!t)return console.warn("viewsActiveFilter is not defined in ".concat(i,", data: ").concat(JSON.stringify(e))),!1;const a=t[i];if(!s&&null!==e&&void 0!==e&&e.filterkey&&null!==a&&void 0!==a&&a.length){if("$"===a[0])return!0;let t=e.filterkey;"string"===typeof t&&(t=t.split(",").map((t=>t.trim())).filter((t=>t)));for(let e=0;e<t.length;e++)if(a.includes(t[e]))return!1;return!0}return!1}isWidgetFilteredOut(t){return b.isWidgetFilteredOutStatic(this.props.viewsActiveFilter,t,this.props.view,this.state.editMode)}static isWidgetHidden(t,e,i){const s=t["visibility-oid"],a=t["visibility-cond"];if(!s)return a&&"not exist"===a;{if(!Object.keys(e).includes("".concat(s,".val")))return!0;let o=e["".concat(s,".val")];if(void 0===o||null===o)return"not exist"===a;let n=t["visibility-val"];if(!a||void 0===n||null===n)return"not exist"===a;if("null"===o&&"exist"!==a&&"not exist"!==a)return!1;const r=typeof o;switch("boolean"===r||"false"===o||"true"===o?n="true"===n||!0===n||1===n||"1"===n:"number"===r?n=parseFloat(n):"object"===r&&(o=JSON.stringify(o)),a){case"==":return n=n.toString(),o=o.toString(),"1"===o&&(o="true"),"1"===n&&(n="true"),"0"===o&&(o="false"),"0"===n&&(n="false"),n!==o;case"!=":return n=n.toString(),o=o.toString(),"1"===o&&(o="true"),"1"===n&&(n="true"),"0"===o&&(o="false"),"0"===n&&(n="false"),n===o;case">=":return o<n;case"<=":return o>n;case">":return o<=n;case"<":return o>=n;case"consist":return n=n.toString(),o=o.toString(),!o.toString().includes(n);case"not consist":return n=n.toString(),o=o.toString(),o.toString().includes(n);case"exist":return"null"===o;case"not exist":return"null"!==o;default:return console.log("[".concat(i,"] Unknown visibility condition: ").concat(a)),!1}}}renderWidgetBody(t){return(0,m.jsxs)("div",{style:{width:"100%",height:"100%",overflow:"hidden",background:"repeating-linear-gradient(45deg, #333, #333 10px, #666 10px, #666 20px)",color:"#FFF"},children:[(0,m.jsx)("div",{style:{color:"#FF0000",paddingLeft:10},children:n.I18n.t('Unknown widget type "%s"',this.props.tpl)}),(0,m.jsx)("pre",{children:JSON.stringify(this.state.data,null,2)})]})}changeOrder(t,e){if(t.stopPropagation(),t.preventDefault(),this.state.multiViewWidget||!this.state.editMode)return;const i=[...this.props.relativeWidgetOrder],s=i.indexOf(this.props.id);if(e>0){if(s===i.length-1)return;const t=i[s+1];i[s+1]=this.props.id,i[s]=t}else{if(!s)return;{const t=i[s-1];i[s-1]=this.props.id,i[s]=t}}this.props.context.onWidgetsChanged(null,this.props.view,{order:i})}static formatValue(t,e,i){"number"!==typeof e&&(i=e=2);const s=void 0===i?".,":i;return"number"!==typeof t&&(t=parseFloat(t)),Number.isNaN(t)?"":t.toFixed(e||0).replace(s[0],s[1]).replace(/\B(?=(\d{3})+(?!\d))/g,s[0])}formatIntervalHelper(t,e){let i,s,a;if("de"===this.props.context.lang?"seconds"===e?(i="Sekunde",s="Sekunden"):"minutes"===e?(i="Minute",s="Minuten"):"hours"===e?(i="Stunde",s="Stunden"):"days"===e&&(i="Tag",s="Tagen"):"ru"===this.props.context.lang?"seconds"===e?(i="\u0441\u0435\u043a\u0443\u043d\u0434\u0443",s="\u0441\u0435\u043a\u0443\u043d\u0434",a="\u0441\u0435\u043a\u0443\u043d\u0434\u044b"):"minutes"===e?(i="\u043c\u0438\u043d\u0443\u0442\u0443",s="\u043c\u0438\u043d\u0443\u0442",a="\u043c\u0438\u043d\u0443\u0442\u044b"):"hours"===e?(i="\u0447\u0430\u0441",s="\u0447\u0430\u0441\u043e\u0432",a="\u0447\u0430\u0441\u0430"):"days"===e&&(i="\u0434\u0435\u043d\u044c",s="\u0434\u043d\u0435\u0439",a="\u0434\u043d\u044f"):"seconds"===e?(i="second",s="seconds"):"minutes"===e?(i="minute",s="minutes"):"hours"===e?(i="hour",s="hours"):"days"===e&&(i="day",s="days"),1===t)return"de"===this.props.context.lang?"days"===e?"einem ".concat(i):"einer ".concat(i):"ru"===this.props.context.lang?"days"===e||"hours"===e?"\u043e\u0434\u0438\u043d ".concat(i):"\u043e\u0434\u043d\u0443 ".concat(i):"one ".concat(i);if("de"===this.props.context.lang)return"".concat(t," ").concat(s);if("ru"===this.props.context.lang){const e=t%10;return 1===e&&11!==t?"".concat(t," ").concat(i):e>=2&&e<=4&&(t>20||t<10)?"".concat(t," ").concat(a):"".concat(t," ").concat(s)}return"".concat(t," ").concat(s)}formatInterval(t,e){if(e)return this.props.context.moment(new Date(t)).fromNow();let i,s=Date.now()-t;if(s=Math.round(s/1e3),s<=60)i="de"===this.props.context.lang?"vor ".concat(this.formatIntervalHelper(s,"seconds")):"ru"===this.props.context.lang?"".concat(this.formatIntervalHelper(s,"seconds")," \u043d\u0430\u0437\u0430\u0434"):"".concat(this.formatIntervalHelper(s,"seconds")," ago");else if(s<3600){const t=Math.floor(s/60),e=s-60*t;i="",i="de"===this.props.context.lang?"vor ".concat(this.formatIntervalHelper(t,"minutes")):(this.props.context.lang,this.formatIntervalHelper(t,"minutes")),t<5&&("de"===this.props.context.lang?i+=" und ".concat(this.formatIntervalHelper(e,"seconds")):"ru"===this.props.context.lang?i+=" \u0438 ".concat(this.formatIntervalHelper(e,"seconds")):i+=" and ".concat(this.formatIntervalHelper(e,"seconds"))),"de"===this.props.context.lang||("ru"===this.props.context.lang?i+=" \u043d\u0430\u0437\u0430\u0434":i+=" ago")}else if(s<86400){const t=Math.floor(s/3600),e=Math.floor((s-3600*t)/60);i="",i="de"===this.props.context.lang?"vor ".concat(this.formatIntervalHelper(t,"hours")):(this.props.context.lang,this.formatIntervalHelper(t,"hours")),t<10&&("de"===this.props.context.lang?i+=" und ".concat(this.formatIntervalHelper(e,"minutes")):"ru"===this.props.context.lang?i+=" \u0438 ".concat(this.formatIntervalHelper(e,"minutes")):i+=" and ".concat(this.formatIntervalHelper(e,"minutes"))),"de"===this.props.context.lang||("ru"===this.props.context.lang?i+=" \u043d\u0430\u0437\u0430\u0434":i+=" ago")}else{const t=Math.floor(s/86400),e=Math.floor((s-86400*t)/3600);i="",i="de"===this.props.context.lang?"vor ".concat(this.formatIntervalHelper(t,"days")):(this.props.context.lang,this.formatIntervalHelper(t,"days")),t<3&&("de"===this.props.context.lang?i+=" und ".concat(this.formatIntervalHelper(e,"hours")):"ru"===this.props.context.lang?i+=" \u0438 ".concat(this.formatIntervalHelper(e,"hours")):i+=" and ".concat(this.formatIntervalHelper(e,"hours"))),"de"===this.props.context.lang||("ru"===this.props.context.lang?i+=" \u043d\u0430\u0437\u0430\u0434":i+=" ago")}return i}startUpdateInterval(){this.updateInterval=this.updateInterval||setInterval((()=>{var t;const e=null===(t=this.widDiv||this.refService.current)||void 0===t?void 0:t.querySelector(".time-interval");if(e){const t=parseInt(e.dataset.time,10);e.innerHTML=this.formatInterval(t,"true"===e.dataset.moment)}}),1e4)}formatDate(t,e,i,s,a){if("boolean"===typeof e&&(i=e,e="auto"),"auto"===e&&(e="".concat(this.props.context.dateFormat||"DD.MM.YYYY"," hh:mm:ss")),e=e||this.props.context.dateFormat||"DD.MM.YYYY",!t)return"";const o=typeof t;if("string"===o&&(t=new Date(t)),"object"!==o)if((0,r.Ny)(t)){t=parseInt(t,10)>9466812e5?new Date(t):new Date(1e3*t)}else t=new Date(t);if(i)return this.startUpdateInterval(),a?(0,m.jsx)("span",{className:"time-interval","data-time":t.getTime(),"data-moment":s||!1,title:t.toLocaleString(),children:this.formatInterval(t.getTime(),s)}):'<span class="time-interval" data-time="'.concat(t.getTime(),'" data-moment="').concat(s||!1,'">').concat(this.formatInterval(t.getTime(),s),"</span>");let n;return e.includes("YYYY")||e.includes("JJJJ")||e.includes("\u0413\u0413\u0413\u0413")?(n=t.getFullYear(),e=(e=(e=e.replace("YYYY",n)).replace("JJJJ",n)).replace("\u0413\u0413\u0413\u0413",n)):(e.includes("YY")||e.includes("JJ")||e.includes("\u0413\u0413"))&&(n=t.getFullYear()%100,e=(e=(e=e.replace("YY",n)).replace("JJ",n)).replace("\u0413\u0413",n)),e.includes("MM")||e.includes("\u041c\u041c")?(n=t.getMonth()+1,n<10&&(n="0".concat(n)),e=(e=e.replace("MM",n)).replace("\u041c\u041c",n)):(e.includes("M")||e.includes("\u041c"))&&(n=t.getMonth()+1,e=(e=e.replace("M",n)).replace("\u041c",n)),e.includes("DD")||e.includes("TT")||e.includes("\u0414\u0414")?(n=t.getDate(),n<10&&(n="0".concat(n)),e=(e=(e=e.replace("DD",n)).replace("TT",n)).replace("\u0414\u0414",n)):(e.includes("D")||e.includes("TT")||e.includes("\u0414"))&&(n=t.getDate(),e=(e=(e=e.replace("D",n)).replace("T",n)).replace("\u0414",n)),e.includes("hh")||e.includes("SS")||e.includes("\u0447\u0447")?(n=t.getHours(),n<10&&(n="0".concat(n)),e=(e=(e=e.replace("hh",n)).replace("SS",n)).replace("\u0447\u0447",n)):(e.includes("h")||e.includes("S")||e.includes("\u0447"))&&(n=t.getHours(),e=(e=(e=e.replace("h",n)).replace("S",n)).replace("\u0447",n)),e.includes("mm")||e.includes("\u043c\u043c")?(n=t.getMinutes(),n<10&&(n="0".concat(n)),e=(e=e.replace("mm",n)).replace("\u043c\u043c",n)):(e.includes("m")||e.includes("\u043c"))&&(n=t.getMinutes(),e=(e=e.replace("m",n)).replace("v",n)),(e.includes("sss")||e.includes("\u0441\u0441\u0441"))&&(n=t.getMilliseconds(),n<10?n="00".concat(n):n<100&&(n="0".concat(n)),e=(e=e.replace("sss",n)).replace("\u0441\u0441\u0441",n)),e.includes("ss")||e.includes("\u0441\u0441")?(n=t.getSeconds(),n<10&&(n="0".concat(n)),e=(e=e.replace("ss",n)).replace("cc",n)):(e.includes("s")||e.includes("\u0441"))&&(n=t.getHours(),e=(e=e.replace("s",n)).replace("\u0441",n)),e}onToggleRelative(t){t.stopPropagation(),t.preventDefault();const e=this.props.context.views[this.props.view].widgets[this.props.id];this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,style:{position:this.props.isRelative?"absolute":"relative",width:this.props.isRelative?e.style.absoluteWidth||"100px":"100%",absoluteWidth:this.props.isRelative?null:e.style.width,noPxToPercent:!0}}])}onToggleWidth(t){t.stopPropagation(),t.preventDefault();const e=this.props.context.views[this.props.view].widgets[this.props.id];this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,style:{width:"100%"===e.style.width?e.style.absoluteWidth||"100px":"100%",absoluteWidth:"100%"!==e.style.width?e.style.width:null,noPxToPercent:!0}}])}onToggleLineBreak(t){t.stopPropagation(),t.preventDefault();const e=this.props.context.views[this.props.view].widgets[this.props.id];this.props.context.onWidgetsChanged([{wid:this.props.id,view:this.props.view,style:{newLine:!e.style.newLine}}])}static correctStylePxValue(t){return"string"===typeof t&&(0,r.Ny)(t)?parseFloat(t):t}renderRelativeMoveMenu(){return this.props.context.runtime||!this.state.editMode?null:(0,m.jsx)(w,{anchorEl:this.state.showRelativeMoveMenu?this.relativeMoveMenu:void 0,order:this.props.relativeWidgetOrder,wid:this.props.id,view:this.props.view,views:this.props.context.views,themeType:this.props.context.themeType,onClose:t=>{this.props.onIgnoreMouseEvents(!1),this.setState({showRelativeMoveMenu:!1}),t&&this.props.context.onWidgetsChanged(null,this.props.view,{order:t})}})}render(){var t,e;const i=this.props.context.views[this.props.view].widgets[this.props.id];if(!i||"object"!==typeof i)return console.error("EMPTY Widget: ".concat(this.props.id)),null;const s={boxSizing:"border-box"},a=!this.state.multiViewWidget&&this.state.editMode&&(null===(t=this.props.selectedWidgets)||void 0===t?void 0:t.includes(this.props.id)),l=a?["vis-editmode-selected"]:["vis-editmode-overlay-not-selected"];var d,c;(a&&"hide"===this.state.widgetHint&&l.push("vis-editmode-selected-background"),!this.state.editMode||i.groupid&&!this.props.selectedGroup)||(!this.props.isRelative&&Object.prototype.hasOwnProperty.call(this.state.style,"top")&&(s.top=b.correctStylePxValue(this.state.style.top)),!this.props.isRelative&&Object.prototype.hasOwnProperty.call(this.state.style,"left")&&(s.left=b.correctStylePxValue(this.state.style.left)),Object.prototype.hasOwnProperty.call(this.state.style,"width")&&(s.width=b.correctStylePxValue(this.state.style.width)),Object.prototype.hasOwnProperty.call(this.state.style,"height")&&(s.height=b.correctStylePxValue(this.state.style.height)),!this.props.isRelative&&Object.prototype.hasOwnProperty.call(this.state.style,"right")&&(s.right=b.correctStylePxValue(this.state.style.right)),!this.props.isRelative&&Object.prototype.hasOwnProperty.call(this.state.style,"bottom")&&(s.bottom=b.correctStylePxValue(this.state.style.bottom)),s.position=this.props.isRelative?"relative":"absolute",s.userSelect="none",a?!this.props.moveAllowed||!1===this.state.draggable||this.props.isRelative||this.props.selectedGroup&&this.props.selectedGroup===this.props.id?s.cursor="default":s.cursor="move":null!==(d=i.data)&&void 0!==d&&d.locked?s.cursor="default":this.props.selectedGroup===this.props.id||this.state.multiViewWidget||(s.cursor="pointer"),null!==(c=this.props.tpl)&&void 0!==c&&c.toLowerCase().includes("image")&&l.push("vis-editmode-helper"));const h={className:"",overlayClassNames:l,style:s,id:"rx_".concat(this.props.id),refService:this.refService,widget:i};let p=!1,u=!1;var g;(this.visDynamicResizable&&!this.isResizable()&&(!1===this.visDynamicResizable.desiredSize?(p=!0,u=!0,delete s.width,delete s.height):"object"===typeof this.visDynamicResizable.desiredSize&&(this.state.style.width?s.width=b.correctStylePxValue(this.visDynamicResizable.desiredSize.width):(p=!0,delete s.width),this.state.style.height?s.height=b.correctStylePxValue(this.visDynamicResizable.desiredSize.height):(u=!0,delete s.height))),this.props.isRelative&&(0,r.Ny)(null===(e=this.props.context.views[this.props.view].settings)||void 0===e?void 0:e.rowGap))&&(s.marginBottom=parseFloat(null===(g=this.props.context.views[this.props.view].settings)||void 0===g?void 0:g.rowGap));const v=this.renderWidgetBody(h);p&&delete s.width,u&&delete s.height,this.props.id===this.props.selectedGroup&&(s.top=0,s.left=0),this.props.isRelative||(s.top=s.top||0,s.left=s.left||0),["top","left","width","height","right","bottom","borderRadius","paddingLeft","paddingTop","paddingRight","paddingBottom","marginTop","marginBottom","marginLeft","marginRight"].forEach((t=>{if(void 0!==s[t]&&"string"===typeof s[t])if((0,r.Ny)(s[t]))s[t]=parseFloat(s[t]);else if(s[t].includes("{")){var e;const i=null===(e=this.state.rxStyle)||void 0===e?void 0:e[t];this.state.rxStyle&&void 0!==i?i&&"string"===typeof i&&!i.includes("{")&&(s[t]=b.correctStylePxValue(i)):this.props.context.allWidgets[this.props.id]&&this.props.context.allWidgets[this.props.id].style&&void 0!==this.props.context.allWidgets[this.props.id].style[t]&&(this.props.context.allWidgets[this.props.id].style[t].includes("{")||(s[t]=b.correctStylePxValue(this.props.context.allWidgets[this.props.id].style[t])))}})),l.push("vis-editmode-overlay");let x=null,f=null;if("hide"!==this.state.widgetHint&&!this.state.hideHelper&&this.state.editMode&&(!i.groupid||this.props.selectedGroup)&&this.props.selectedGroup!==this.props.id&&!1!==this.props.context.showWidgetNames){var y,w,D,_;const t=!i.usedInWidget&&(0===(null===(y=this.refService.current)||void 0===y?void 0:y.offsetTop)||(null===(w=this.refService.current)||void 0===w?void 0:w.offsetTop)&&(null===(D=this.refService.current)||void 0===D?void 0:D.offsetTop)<15);this.refService.current||setTimeout((()=>this.forceUpdate()),50);const e=this.state.multiViewWidget?this.props.id.split("_"):[null,null],l=e[0],d=e[1],c=!i.usedInWidget&&this.isResizable();if(x=(0,m.jsxs)("div",{title:this.state.multiViewWidget?n.I18n.t("Jump to widget by double click"):"_tplGroup"===this.props.tpl?n.I18n.t("Switch to group edit mode by double click"):void 0,className:n.Utils.clsx("vis-editmode-widget-name",a&&"vis-editmode-widget-name-selected",this.state.widgetHint,t&&"vis-editmode-widget-name-bottom",this.props.isRelative&&c&&"vis-editmode-widget-name-long"),children:[(0,m.jsx)("span",{children:this.state.multiViewWidget?n.I18n.t("%s from %s",d,l):(null===(_=i.data)||void 0===_?void 0:_.name)||this.props.id}),this.state.multiViewWidget||i.usedInWidget?null:(0,m.jsx)(o.Anchor,{onMouseDown:t=>this.onToggleRelative(t),className:n.Utils.clsx("vis-anchor",this.props.isRelative?"vis-anchor-enabled":"vis-anchor-disabled")}),this.state.multiViewWidget||!this.props.isRelative||!c||i.usedInWidget?null:(0,m.jsx)(o.Expand,{onMouseDown:t=>this.onToggleWidth(t),className:n.Utils.clsx("vis-expand","100%"===i.style.width?"vis-expand-enabled":"vis-expand-disabled")}),this.state.multiViewWidget||!this.props.isRelative||i.usedInWidget?null:(0,m.jsx)(o.KeyboardReturn,{onMouseDown:t=>this.onToggleLineBreak(t),className:n.Utils.clsx("vis-new-line",i.style.newLine?"vis-new-line-enabled":"vis-new-line-disabled")})]}),this.props.isRelative&&!this.state.multiViewWidget&&!i.usedInWidget){const e=this.props.relativeWidgetOrder.indexOf(this.props.id),i=!!e;let s=e!==this.props.relativeWidgetOrder.length-1;if(s&&this.props.selectedGroup){"absolute"===this.props.context.views[this.props.view].widgets[this.props.relativeWidgetOrder[e+1]].style.position&&(s=!1)}(i||s)&&(f=(0,m.jsxs)("div",{className:n.Utils.clsx("vis-editmode-widget-move-buttons",this.state.widgetHint,t&&"vis-editmode-widget-name-bottom"),style:{width:i&&s?void 0:30},children:[(0,m.jsx)("div",{className:"vis-editmode-widget-number",children:this.props.relativeWidgetOrder.indexOf(this.props.id)+1}),i?(0,m.jsx)("div",{className:"vis-editmode-move-button",title:n.I18n.t("Move widget up or press longer to open re-order menu"),children:(0,m.jsx)(o.ArrowUpward,{onMouseDown:t=>{t.stopPropagation(),t.preventDefault(),this.pressTimeout=setTimeout((t=>{this.props.onIgnoreMouseEvents(!0),this.relativeMoveMenu=t,this.setState({showRelativeMoveMenu:!0}),this.pressTimeout=void 0}),300,t.currentTarget)},onMouseUp:t=>this.changeOrder(t,-1)})}):null,s?(0,m.jsx)("div",{className:"vis-editmode-move-button",style:{left:i?30:void 0},title:n.I18n.t("Move widget down or press longer to open re-order menu"),children:(0,m.jsx)(o.ArrowDownward,{onMouseDown:t=>{t.stopPropagation(),t.preventDefault(),this.pressTimeout=setTimeout((t=>{this.props.onIgnoreMouseEvents(!0),this.relativeMoveMenu=t,this.setState({showRelativeMoveMenu:!0}),this.pressTimeout=void 0}),300,t.currentTarget)},onMouseUp:t=>this.changeOrder(t,1)})}):null]}))}(0,r.Rg)(s)}!this.isCanWidget&&this.state.multiViewWidget&&this.state.editMode&&(void 0===s.opacity||null===s.opacity||s.opacity>.5)&&(s.opacity=.5);const S=this.state.hideHelper||i.usedInWidget||!this.state.editMode||i.data.locked||i.groupid&&!this.props.selectedGroup||this.props.selectedGroup===this.props.id?null:(0,m.jsx)("div",{className:l.join(" "),onMouseDown:t=>!!this.props.context.setSelectedWidgets&&this.onMouseDown(t)});let I=null;this.props.selectedGroup===this.props.id&&(s.borderBottom="1px dotted #888",s.borderRight="1px dotted #888",I=(0,m.jsx)("div",{style:{position:"absolute",bottom:-24,left:0,fontSize:10,fontStyle:"italic",opacity:.5,width:350,cursor:"pointer"},onClick:t=>{t.stopPropagation(),this.props.context.setSelectedWidgets([this.props.id])},children:n.I18n.t("group_size_hint")}));const j=this.renderSignals?this.renderSignals():null,C=this.renderLastChange?this.renderLastChange(s):null;return(0,m.jsxs)("div",{id:h.id,className:h.className,ref:this.refService,style:s,children:[j,C,x,f,S,this.getResizeHandlers(a,i),v,I,this.state.showRelativeMoveMenu&&this.renderRelativeMoveMenu()]})}}b.FORBIDDEN_CHARS=/[^._\-/ :!#$%&()+=@^{}|~]+/g;const D=b},47461:(t,e,i)=>{i.r(e),i.d(e,{default:()=>p});i(30678);var s=i(65198),a=i(73258),o=i(30419),n=i(83640),r=i(594),l=i(18644),d=i(99277);const c=["background-color","border","background","background-image","background-position","background-repeat","background-size","background-clip","background-origin","color","box-sizing","border-width","border-style","border-color","border-radius","box-shadow","text-align","text-shadow","font-family","font-size","font-weight","line-height","font-style","font-variant","letter-spacing","word-spacing"];class h extends n.A{constructor(t){super(t),this.linkContext=void 0,this.onStateChangedBind=void 0,this.resizeLocked=void 0,this.newState=void 0,this.wrappedContent=void 0,this.updateTimer=void 0,this.ignoreMouseEvents=void 0,this.mouseDownOnView=void 0,this.bindingsTimer=void 0,this.informIncludedWidgets=void 0,this.filterDisplay=void 0,this.onIoBrokerStateChanged=(t,e)=>{this.onStateChanged(t,e)};const e=this.getWidgetInfo(),i={};Array.isArray(e.visAttrs)&&e.visAttrs.forEach((t=>t.fields&&t.fields.forEach((t=>{i[t.name]={type:t.type||""}})))),this.linkContext={IDs:[],bindings:{},visibility:{},lastChanges:{},signals:{},widgetAttrInfo:i},(0,l._X)(t.context.views,t.view,t.id,this.linkContext),this.onStateChangedBind=this.onStateChanged.bind(this);const s=this.onStateChanged(null,null,!0);var a;s&&(s.visible=this.checkVisibility(null===(a=s.rxData)||void 0===a?void 0:a["visibility-oid"],s));this.resizeLocked=!!e.visResizeLocked;const o=h.findField(e,"visResizable");this.visDynamicResizable=o?{default:void 0===o.default||o.default,desiredSize:o.desiredSize}:null,this.state={...this.state,resizable:void 0===e.resizable?void 0===e.visResizable||e.visResizable:e.resizable,draggable:void 0===e.visDraggable||e.visDraggable,resizeHandles:void 0===e.resizeHandles?void 0===e.visResizeHandles?["n","e","s","w","nw","ne","sw","se"]:e.visResizeHandles:e.resizeHandles,rxData:s.rxData,rxStyle:s.rxStyle,values:{},visible:s.visible,disabled:!1}}static findField(t,e){if(!t.visAttrs)return null;for(let i=0;i<t.visAttrs.length;i++){const s=t.visAttrs[i];if(s.fields)for(let t=0;t<s.fields.length;t++)if(s.fields[t].name===e)return s.fields[t]}return null}static getI18nPrefix(){return""}static getText(t){return"object"===typeof t?t[a.I18n.getLanguage()]||t.en:t}static t(t){if(this.getI18nPrefix){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return a.I18n.t("".concat(this.getI18nPrefix()).concat(t),...i)}return a.I18n.t(t)}static getLanguage(){return a.I18n.getLanguage()}onCommand(t,e){const i=super.onCommand(t);if(!1===i){var s;if("collectFilters"===t)return null===(s=this.state.rxData)||void 0===s?void 0:s.filterkey;if("changeFilter"===t){const t=this.checkVisibility();t!==this.state.visible&&this.setState({visible:t})}}return i}onStateUpdated(t,e){}onStateChanged(t,e,i){var s;if(this.newState||(this.newState={values:(0,o.Go)(this.state.values||{}),rxData:{...this.state.data},rxStyle:{...this.state.style},editMode:this.props.editMode,applyBindings:!1}),!this.newState)return null;if(this.newState.rxData&&delete this.newState.rxData._originalData,this.newState.rxStyle&&delete this.newState.rxStyle._originalData,t&&e&&(Object.keys(e).forEach((i=>this.newState.values["".concat(t,".").concat(i)]=e[i])),setTimeout((()=>this.onStateUpdated(t,e)),60)),Object.keys(this.linkContext.bindings).forEach((t=>this.applyBinding(t,this.newState))),t===(null===(s=this.newState.rxData)||void 0===s?void 0:s["visibility-oid"])&&(this.newState.visible=this.checkVisibility(t,this.newState)),this.newState.rxData){const t=this.newState.rxData["visibility-groups"];this.newState.disabled=!1,this.newState.rxData.filterkey&&"string"===typeof this.newState.rxData.filterkey&&(this.newState.rxData.filterkey=this.newState.rxData.filterkey.split(/[;,]+/).map((t=>t.trim())).filter((t=>t))),null!==t&&void 0!==t&&t.length&&!this.isUserMemberOfGroup(this.props.context.user,t)&&("disabled"===this.newState.rxData["visibility-groups-action"]?this.newState.disabled=!0:this.newState.visible=!1)}if(i){const t=this.newState;return this.newState=null,t}return this.updateTimer&&clearTimeout(this.updateTimer),JSON.stringify(this.state.values)!==JSON.stringify(this.newState.values)||JSON.stringify(this.state.rxData)!==JSON.stringify(this.newState.rxData)||JSON.stringify(this.state.rxStyle)!==JSON.stringify(this.newState.rxStyle)||JSON.stringify(this.state.applyBindings)!==JSON.stringify(this.newState.applyBindings)?this.updateTimer=setTimeout((()=>{var t;this.updateTimer=void 0;const e=null!==(t=this.newState)&&void 0!==t?t:null;this.newState=null,e&&this.setState(e)}),50):this.newState=null,null}applyBinding(t,e){this.linkContext.bindings[t]&&this.linkContext.bindings[t].forEach((t=>{const i=this.props.context.formatUtils.formatBinding({format:t.format,view:t.view,wid:this.props.id,widget:this.props.context.views[t.view].widgets[this.props.id],widgetData:e.rxData,values:e.values,moment:this.props.context.moment});"data"===t.type?e.rxData[t.attr]=i:e.rxStyle&&(e.rxStyle[t.attr]=i)}))}async componentDidMount(){super.componentDidMount();for(let t=0;t<this.linkContext.IDs.length;t++)await this.props.context.socket.subscribeState(this.linkContext.IDs[t],this.onIoBrokerStateChanged)}onRxDataChanged(t){}onRxStyleChanged(t){}componentDidUpdate(t,e){e&&(JSON.stringify(this.state.rxData)!==JSON.stringify(e.rxData)&&this.onRxDataChanged(e.rxData),JSON.stringify(this.state.rxStyle)!==JSON.stringify(e.rxStyle)&&this.onRxStyleChanged(e.rxStyle))}componentWillUnmount(){if(this.linkContext.IDs.length)for(let t=0;t<this.linkContext.IDs.length;t++)this.props.context.socket.unsubscribeState(this.linkContext.IDs[t],this.onIoBrokerStateChanged);super.componentWillUnmount()}isWidgetVisibleForGroup(t){const e=t.rxData["visibility-groups"];return!("hide"===t.rxData["visibility-groups-action"]&&null!==e&&void 0!==e&&e.length&&!this.isUserMemberOfGroup(this.props.context.user,e))}checkVisibility(t,e){if(e=e||this.state,!this.isWidgetVisibleForGroup(e))return!1;if(!this.state.editMode){if(this.isWidgetFilteredOut(e.rxData))return!1;if(!t)return!n.A.isWidgetHidden(e.rxData,e.values,this.props.id);if(this.linkContext.visibility[t])return!n.A.isWidgetHidden(e.rxData,e.values,this.props.id)}return!0}async onPropertiesUpdated(){const t=this.linkContext.IDs;this.linkContext={IDs:[],bindings:{},visibility:{},lastChanges:{},signals:{},widgetAttrInfo:this.linkContext.widgetAttrInfo};const e=this.props.context;(0,l._X)(e.views,this.props.view,this.props.id,this.linkContext);const i=t.filter((t=>!this.linkContext.IDs.includes(t)));i.length&&e.socket.unsubscribeState(i,this.onIoBrokerStateChanged);const s=this.linkContext.IDs.filter((e=>!t.includes(e)));s.length&&e.socket.subscribeState(s,this.onIoBrokerStateChanged),this.onStateChanged()}formatValue(t,e){var i,s;"number"===typeof t&&(t=1===e?Math.round(10*t)/10:0===e?Math.round(t):Math.round(100*t)/100,null!==(i=this.props.context.systemConfig)&&void 0!==i&&null!==(s=i.common)&&void 0!==s&&s.isFloatComma&&(t=t.toString().replace(".",",")));return void 0===t||null===t?"":t.toString()}wrapContent(t,e,i,a,o,n){var r,l;if(this.props.context.views[this.props.view].widgets[this.props.id].usedInWidget)return t;const h=(null===n||void 0===n?void 0:n.Card)||s.Card,p=(null===n||void 0===n?void 0:n.CardContent)||s.CardContent,u={width:"calc(100% - 8px)",height:"calc(100% - 8px)",margin:4,...null===(r=this.props.customSettings)||void 0===r||null===(l=r.viewStyle)||void 0===l?void 0:l.visCard};return Object.keys(this.state.rxStyle).forEach((t=>{const e=this.state.rxStyle[t];null!==e&&void 0!==e&&c.includes(t)&&(t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),u[t]=e)})),this.wrappedContent=!0,(0,d.jsx)(h,{className:"vis_rx_widget_card",style:u,onClick:o,children:(0,d.jsxs)(p,{className:"vis_rx_widget_card_content",style:{display:"flex",flexDirection:"column",alignItems:"center",height:"calc(100% - 32px)",paddingBottom:16,position:"relative",...i},children:[this.state.rxData.widgetTitle?(0,d.jsxs)("div",{className:"vis_rx_widget_card_name",style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[(0,d.jsx)("div",{className:"vis_rx_widget_card_name_div",style:{fontSize:24,paddingTop:0,paddingBottom:4,...a},children:this.state.rxData.widgetTitle}),e||null]}):e||null,t]})})}renderWidgetBody(t){var e;(t.id=this.props.id,t.className="vis-widget".concat(this.state.rxData.class?" ".concat(this.state.rxData.class):""),!this.state.editMode&&this.state.disabled&&(t.className=(0,l.iQ)(t.className,"vis-user-disabled")),Object.keys(this.state.rxStyle).forEach((e=>{const i=this.state.rxStyle[e];null!==i&&void 0!==i&&(this.wrappedContent&&c.includes(e)||(e=e.replace(/(-\w)/g,(t=>t[1].toUpperCase())),t.style[e]=i))})),this.props.isRelative)?(t.style.position=(null===(e=this.state.rxStyle)||void 0===e?void 0:e.position)||"relative",delete t.style.top,delete t.style.left):t.style.position="absolute";if(this.state.editMode){const e=this.state.rxStyle?parseInt(this.state.rxStyle["z-index"]||"0",10):0;this.state.selected?t.style.zIndex=800+e:t.style.zIndex=e}return null}getWidgetView(t,e){const i=this.props.context.VisView;return e=e||{},(0,d.jsx)(i,{context:this.props.context,viewsActiveFilter:this.props.viewsActiveFilter,activeView:t,editMode:!1,askView:this.props.askView,view:t,visInWidget:!0,...e},"".concat(this.props.id,"_").concat(t))}getWidgetInWidget(t,e,i){var s;return i=i||{},r.A.getOneWidget(i.index||0,this.props.context.views[t].widgets[e],{context:this.props.context,editMode:this.state.editMode,id:e,isRelative:void 0===i.isRelative||i.isRelative,mouseDownOnView:this.mouseDownOnView,moveAllowed:!1,ignoreMouseEvents:!!this.state.editMode||this.ignoreMouseEvents,onIgnoreMouseEvents:this.props.onIgnoreMouseEvents,refParent:i.refParent,askView:this.props.askView,relativeWidgetOrder:[e],selectedGroup:this.props.selectedGroup,selectedWidgets:(null===(s=this.movement)||void 0===s?void 0:s.selectedWidgetsWithRectangle)||this.props.selectedWidgets,view:t,viewsActiveFilter:this.props.viewsActiveFilter,customSettings:this.props.customSettings})}isSignalVisible(t){const e=this.state.rxData["signals-oid-".concat(t)];if(!e)return!1;{var i,s;let a=this.state.values["".concat(e,".val")];const o=null!==(i=this.state.rxData["signals-cond-".concat(t)])&&void 0!==i?i:"==";let n=null!==(s=this.state.rxData["signals-val-".concat(t)])&&void 0!==s?s:"true";if(void 0===a||null===a)return"not exist"===o;if(!o||void 0===n||null===n)return"not exist"===o;if("null"===a&&"exist"!==o&&"not exist"!==o)return!1;const r=typeof a;switch("boolean"===r||"false"===a||"true"===a?n="true"===n||!0===n||1===n||"1"===n:"number"===r?n=parseFloat(n):"object"===r&&(a=JSON.stringify(a)),o){case"==":return n=n.toString(),a=a.toString(),"1"===a&&(a="true"),"1"===n&&(n="true"),"0"===a&&(a="false"),"0"===n&&(n="false"),n===a;case"!=":return n=n.toString(),a=a.toString(),"1"===a&&(a="true"),"1"===n&&(n="true"),"0"===a&&(a="false"),"0"===n&&(n="false"),n!==a;case">=":return a>=n;case"<=":return a<=n;case">":return a>n;case"<":return a<n;case"consist":return n=n.toString(),a=a.toString(),a.toString().includes(n);case"not consist":return n=n.toString(),a=a.toString(),!a.toString().includes(n);case"exist":return"null"!==n;case"not exist":return"null"===n;default:return console.log("Unknown signals condition for ".concat(this.props.id,": ").concat(o)),!1}}}static text2style(t,e){if(t){e=e||{};t.split(";").forEach((t=>{const[i,s]=t.split(":");if(i&&s){const t=i.trim().split("-");for(let e=1;e<t.length;e++)t[e]=t[e][0].toUpperCase()+t[e].substring(1);e[t.join("")]=s.trim()}}))}return e}renderSignal(t){const e=this.state.rxData["signals-oid-".concat(t)];if(!e||"nothing_selected"===e)return null;if(this.props.editMode&&this.state.rxData["signals-hide-edit-".concat(t)])return null;if(this.props.editMode||this.isSignalVisible(t)){let e,i=this.state.rxData["signals-smallIcon-".concat(t)];i?e=this.state.rxData["signals-color-".concat(t)]:i=this.state.rxData["signals-icon-".concat(t)];const s={color:e,position:"absolute",top:"".concat(parseInt(this.state.rxData["signals-vert-".concat(t)],10)||0,"%"),left:"".concat(parseInt(this.state.rxData["signals-horz-".concat(t)],10)||0,"%"),zIndex:10,textAlign:"center",pointerEvents:"none"};if(i){const e={width:parseFloat(this.state.rxData["signals-icon-size-".concat(t)])||32,height:"auto"};i=(0,d.jsx)(a.Icon,{src:i,style:e,className:"vis-signal-icon"})}h.text2style(this.state.rxData["signals-icon-style-".concat(t)],s);let o=this.state.rxData["signals-text-".concat(t)];if(o){const e={color:this.state.rxData["signals-color-".concat(t)]};h.text2style(this.state.rxData["signals-text-style-".concat(t)],e),o=(0,d.jsx)("div",{className:"vis-signal-text",style:e,children:this.state.rxData["signals-text-".concat(t)]})}else o=null;return(0,d.jsxs)("div",{style:s,className:this.state.rxData["signals-blink-".concat(t)]?"vis-signals-blink":null,children:[i,o]})}return null}renderLastChange(t){const e=this.state.rxData["lc-oid"];if(!e||"nothing_selected"===e)return null;const i=parseInt(this.state.rxData["lc-border-radius"],10)||0,s={backgroundColor:"rgba(182, 182, 182, 0.6)",fontFamily:"Tahoma",position:"absolute",zIndex:0,borderRadius:"left"===this.state.rxData["lc-position-horz"]?"".concat(i,"px 0 0 ").concat(i,"px"):"right"===this.state.rxData["lc-position-horz"]?"0 ".concat(i,"px ").concat(i,"px 0"):i,whiteSpace:"nowrap"},a=this.state.rxData["lc-font-size"];a&&(a.match(/\D/)?s.fontSize=this.state.rxData["lc-font-size"]:s.fontSize=parseFloat(this.state.rxData["lc-font-size"])),this.state.rxData["lc-font-style"]&&(s.fontStyle=this.state.rxData["lc-font-style"]),this.state.rxData["lc-font-family"]&&(s.fontFamily=this.state.rxData["lc-font-family"]),this.state.rxData["lc-bkg-color"]&&(s.backgroundColor=this.state.rxData["lc-bkg-color"]),this.state.rxData["lc-color"]&&(s.color=this.state.rxData["lc-color"]),this.state.rxData["lc-border-width"]&&(s.borderWidth=parseInt(this.state.rxData["lc-border-width"],10)||0),this.state.rxData["lc-border-style"]&&(s.borderStyle=this.state.rxData["lc-border-style"]),this.state.rxData["lc-border-color"]&&(s.borderColor=this.state.rxData["lc-border-color"]);const n=parseInt(this.state.rxData["lc-padding"],10);n?s.padding=n:(s.paddingTop=3,s.paddingBottom=3),this.state.rxData["lc-zindex"]&&(s.zIndex=this.state.rxData["lc-zindex"]),"top"===this.state.rxData["lc-position-vert"]?s.top=parseInt(this.state.rxData["lc-offset-vert"],10):"bottom"===this.state.rxData["lc-position-vert"]?s.bottom=parseInt(this.state.rxData["lc-offset-vert"],10):"middle"===this.state.rxData["lc-position-vert"]&&(s.top="calc(50% + ".concat(parseInt(this.state.rxData["lc-offset-vert"],10)-10,"px)"));const r=parseFloat(this.state.rxData["lc-offset-horz"])||0;"left"===this.state.rxData["lc-position-horz"]?(s.right="calc(100% - ".concat(r,"px)"),n||(s.paddingRight=10,s.paddingLeft=10)):"right"===this.state.rxData["lc-position-horz"]?(s.left="calc(100% + ".concat(r,"px)"),n||(s.paddingRight=10,s.paddingLeft=10)):"middle"===this.state.rxData["lc-position-horz"]&&(s.left="calc(50% + ".concat(r,"px)"));return window.document.createElement("div").className="",(0,o.Rg)(t),(0,d.jsx)("div",{className:"vis-last-change",style:s,children:this.formatDate(this.state.values["".concat(this.state.rxData["lc-oid"],".").concat("last-change"===this.state.rxData["lc-type"]?"lc":"ts")],this.state.rxData["lc-format"],this.state.rxData["lc-is-interval"],this.state.rxData["lc-is-moment"],!0)})}renderSignals(){var t;const e=parseInt(null===(t=this.state.rxData)||void 0===t?void 0:t["signals-count"],10)||0;if(!e)return null;const i=[];for(let s=0;s<e;s++)i.push(this.renderSignal(s));return i}render(){return this.state.visible||this.state.editMode?(this.state.applyBindings&&!this.bindingsTimer&&(this.bindingsTimer=setTimeout((async()=>{this.bindingsTimer=void 0,await this.onPropertiesUpdated();const t=[],e=this.props.context.views[this.props.view].widgets[this.props.id];Object.keys(e.data).forEach((i=>{if(i.startsWith("widget")&&e.data[i]){const s=this.props.askView&&this.props.askView("getRef",{id:e.data[i]});s&&t.push(s)}})),this.informIncludedWidgets&&clearTimeout(this.informIncludedWidgets),t&&(this.informIncludedWidgets=setTimeout((()=>{this.informIncludedWidgets=void 0,t.forEach((t=>t.onCommand("updatePosition")))}),200))}),10)),this.state.editMode&&void 0!==this.filterDisplay&&this.refService.current&&(this.refService.current.style.display=this.filterDisplay,delete this.filterDisplay),super.render()):null}getWidgetInfo(){throw new Error("not implemented")}}h.POSSIBLE_MUI_STYLES=c;const p=h},594:(t,e,i)=>{i.d(e,{A:()=>j});var s=i(30678),a=i.n(s),o=i(38972),n=i(28298),r=i(73258),l=i(30419),d=i(47569),c=i(83640),h=i(64470),p=i.n(h),u=i(18644),g=i(99277);const v=(t,e,i)=>{if((e=e||{}).resizable=!0,e.draggable=!0,t&&t.dataset){let a=t.dataset.visResizable;if(a){try{a=JSON.parse(a)}catch(s){console.error("Cannot parse resizable options by ".concat(t.getAttribute("id"),": ").concat(a)),a=null}a&&(void 0!==a.disabled&&(e.resizable=!a.disabled),void 0!==a.handles&&(e.resizeHandles=a.handles.split(",").map((t=>t.trim())))),!i||e.resizable||i.width&&i.height||(e.virtualHeight=t.clientHeight,e.virtualWidth=t.clientWidth)}let o=t.dataset.visDraggable;if(o){try{o=JSON.parse(o)}catch(s){console.error("Cannot parse draggable options by ".concat(t.getAttribute("id"),": ").concat(o)),o=null}o&&void 0!==o.disabled&&(e.draggable=!o.disabled)}e.hideHelper="true"===t.dataset.visHideHelper}return e};class m extends c.A{constructor(t){super(t),this.destroy=t=>{if(this.props.context.allWidgets[this.props.id]&&delete this.props.context.allWidgets[this.props.id],this.widDiv&&(!t||!this.props.id.startsWith("g"))){const t=this.props.context.jQuery(this.widDiv),e=t.data("destroy");"function"===typeof e&&(e(this.props.id,t),t.data("destroy",null)),this.widDiv.remove(),this.widDiv=null}},this.changeHandler=(t,e,i)=>{this.widDiv&&("style"===t?this.props.context.allWidgets[this.props.id]&&m.applyStyle(this.widDiv,this.props.context.allWidgets[this.props.id].style,this.state.selected,this.state.editMode):"signal"===t?this.updateSignal(e):"visibility"===t?this.updateVisibility(e):"lastChange"===t?this.updateLastChange():"binding"===t&&this.applyBinding(i))},this.refViews={},this.isCanWidget=!0,this.state={mounted:!1,legacyViewContainers:[],hideHelper:!1,resizable:!0,draggable:!0,...this.state},this.setupSubscriptions(),this.props.context.linkContext.registerChangeHandler(this.props.id,this.changeHandler),this.props.context.buildLegacyStructures()}setupSubscriptions(){this.bindings={};const t={IDs:[],bindings:this.bindings,visibility:this.props.context.linkContext.visibility,lastChanges:this.props.context.linkContext.lastChanges,signals:this.props.context.linkContext.signals};(0,u._X)(this.props.context.views,this.props.view,this.props.id,t),this.IDs=t.IDs,Object.keys(this.bindings).forEach((t=>{this.props.context.linkContext.bindings[t]=this.props.context.linkContext.bindings[t]||[],this.bindings[t].forEach((e=>this.props.context.linkContext.bindings[t].push(e)))})),Object.keys(t).forEach((e=>t[e]=null))}componentDidMount(){super.componentDidMount(),this.props.context.linkContext.subscribe(this.IDs),this.widDiv||this.renderWidget((()=>{const t={mounted:!0};this.props.context.allWidgets[this.props.id]&&v(this.widDiv,t,this.props.context.allWidgets[this.props.id].style),this.setState(t)}))}componentWillUnmount(){super.componentWillUnmount(),this.props.context.linkContext&&this.props.context.linkContext&&this.props.context.linkContext.unregisterChangeHandler&&this.props.context.linkContext.unregisterChangeHandler(this.props.id,this.changeHandler),this.bindings={},this.props.context.linkContext&&(this.props.context.linkContext.unsubscribe&&this.props.context.linkContext.unsubscribe(this.IDs),c.A.removeFromArray(this.props.context.linkContext.visibility,this.IDs,this.props.view,this.props.id),c.A.removeFromArray(this.props.context.linkContext.lastChanges,this.IDs,this.props.view,this.props.id),c.A.removeFromArray(this.props.context.linkContext.signals,this.IDs,this.props.view,this.props.id),c.A.removeFromArray(this.props.context.linkContext.bindings,this.IDs,this.props.view,this.props.id)),this.destroy()}static applyStyle(t,e,i,s){if("string"===typeof e)e=c.A.parseStyle(e),Object.keys(e).forEach((i=>{if(!i.startsWith("_")){let s=e[i];"top"!==i&&"left"!==i&&"width"!==i&&"height"!==i||"0"!==s&&0!==s&&null!==s&&""!==s&&s.toString().match(/^[+-]?([0-9]*[.])?[0-9]+$/)&&(s="".concat(s,"px")),i.includes("-")&&(console.log("".concat(i," to ").concat(s)),i=i.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))),s?t.style[i]=s:t.style[i]&&(t.style[i]="")}}));else if(e){if(Object.keys(e).forEach((i=>{if(i&&void 0!==e[i]&&null!==e[i]&&!i.startsWith("_")){let s=e[i];"top"!==i&&"left"!==i&&"width"!==i&&"height"!==i||"0"!==s&&0!==s&&null!==s&&""!==s&&s.toString().match(/^[+-]?([0-9]*[.])?[0-9]+$/)&&(s="".concat(s,"px")),i.includes("-")&&(i=i.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))),s?t.style[i]=s:t.style[i]&&(t.style[i]="")}})),s){i&&(t.style.zIndex=(500+(parseInt(e["z-index"],10)||0)).toString());const s=parseInt(t.style.zIndex,10)||0,a=t.parentNode.querySelector("#rx_".concat(t.id));a&&(a.style.zIndex=s+1),t.style.userSelect="none",t.style.pointerEvents="none"}"absolute"===t.style.position&&(t.style.top||(t.style.top="0px"),t.style.left||(t.style.left="0px"))}}onCommand(t,e){const i=super.onCommand(t,e);if(!1===i)if("updatePosition"===t)this.refService.current&&this.widDiv&&(this.refService.current.style.width="".concat(this.widDiv.offsetWidth,"px"),this.refService.current.style.height="".concat(this.widDiv.offsetHeight,"px"),this.refService.current.style.left="".concat(this.widDiv.offsetLeft,"px"),this.refService.current.style.top="".concat(this.widDiv.offsetTop,"px"));else if("updateContainers"===t){const t=this.widDiv.querySelectorAll(".vis-view-container");if(t.length){const e=[];for(let i=0;i<t.length;i++){const s=(t[i].dataset.visContains||"").trim();s&&"undefined"!==s&&"null"!==s&&(e.push(s),t[i].className=(0,u.iQ)(t[i].className,"vis-editmode-helper"))}e.sort(),JSON.stringify(e)!==JSON.stringify(this.state.legacyViewContainers)&&this.setState({legacyViewContainers:e})}}else if("changeFilter"===t){if(!this.widDiv)return null;var s;if(e&&e.filter.length)if("$"===e.filter[0]){var a,o,n;if(null!==(a=this.props.context.allWidgets[this.props.id])&&void 0!==a&&null!==(o=a.data)&&void 0!==o&&o.filterkey)if("none"!==this.widDiv.style.display)this.filterDisplay=this.widDiv.style.display,this.widDiv.style.display="none",null!==(n=this.widDiv._customHandlers)&&void 0!==n&&n.onHide&&this.widDiv._customHandlers.onHide(this.widDiv,this.props.id)}else{var r;const t=null===(r=this.props.context.allWidgets[this.props.id])||void 0===r?void 0:r.data.filterkey;if(t){let i=!1;for(let s=0;s<t.length;s++)if(e.filter.includes(t[s])){i=!0;break}var l,d;if(i){if(void 0!==this.filterDisplay&&"none"===this.widDiv.style.display){var c,h;if(this.widDiv.style.display=this.filterDisplay,null!==(c=this.widDiv._customHandlers)&&void 0!==c&&c.onShow)null===(h=this.widDiv._customHandlers)||void 0===h||h.onShow(this.widDiv,this.props.id)}}else if("none"!==this.widDiv.style.display)if(this.filterDisplay=this.widDiv.style.display,this.widDiv.style.display="none",null!==(l=this.widDiv._customHandlers)&&void 0!==l&&l.onHide)null===(d=this.widDiv._customHandlers)||void 0===d||d.onHide(this.widDiv,this.props.id)}}else if(void 0!==this.filterDisplay)this.widDiv.style.display=this.filterDisplay,null!==(s=this.widDiv._customHandlers)&&void 0!==s&&s.onShow&&this.widDiv._customHandlers.onShow(this.widDiv,this.props.id)}else if("collectFilters"===t){var p,g;return null===(p=this.props.context.allWidgets[this.props.id])||void 0===p||null===(g=p.data)||void 0===g?void 0:g.filterkey}return i}componentDidUpdate(){this.state.legacyViewContainers.length&&(console.log("widget updated"),Object.keys(this.refViews).forEach((t=>{if(this.refViews[t].current){var e,i;const s=this.widDiv.querySelector('.vis-view-container[data-vis-contains="'.concat(t,'"]')),a=this.refViews[t].current;!a||null!==(e=a.refView)&&void 0!==e&&e.current?null!==a&&void 0!==a&&null!==(i=a.refView)&&void 0!==i&&i.current&&s&&a.refView.current.parentNode!==s&&(a.refView.current._originalParent=a.refView.current.parentNode,s.appendChild(a.refView.current)):a.parentNode}})))}updateSignal(t){if(this.widDiv){const e=this.widDiv.querySelector('.vis-signal[data-index="'.concat(t.index,'"]'));e&&(this.isSignalVisible(t.index)?e.style.display="":e.style.display="none")}}updateLastChange(){if(this.widDiv){var t;const e=null===(t=this.props.context.allWidgets[this.props.id])||void 0===t?void 0:t.data;if(e){const t=this.widDiv.querySelector(".vis-last-change");t?t.innerHTML=window.vis.binds.basic.formatDate(this.props.context.canStates.attr("".concat(e["lc-oid"],".").concat("last-change"===e["lc-type"]?"lc":"ts")),e["lc-format"],e["lc-is-interval"],e["lc-is-moment"]):console.warn("[".concat(this.props.id,"] Last change not found!"))}}}updateVisibility(){if(this.widDiv&&!this.state.editMode){var t;const e=null===(t=this.props.context.allWidgets[this.props.id])||void 0===t?void 0:t.data;e&&(c.A.isWidgetHidden(e,this.props.context.canStates,this.props.id)||this.isWidgetFilteredOut(e)?(this.widDiv._storedDisplay=this.widDiv.style.display,this.widDiv.style.display="none",this.widDiv&&this.widDiv._customHandlers&&this.widDiv._customHandlers.onHide&&this.widDiv._customHandlers.onHide(this.widDiv,this.props.id)):(this.widDiv.style.display=this.widDiv._storedDisplay||"",this.widDiv._storedDisplay="",this.widDiv&&this.widDiv._customHandlers&&this.widDiv._customHandlers.onShow&&this.widDiv._customHandlers.onShow(this.widDiv,this.props.id)))}}addGestures(t){const e=this.props.context.$$("#".concat(this.props.id)),i=this.props.context.jQuery(this.widDiv),s=parseInt(t["gestures-offsetX"])||0,a=parseInt(t["gestures-offsetY"])||0;["swipeRight","swipeLeft","swipeUp","swipeDown","rotateLeft","rotateRight","pinchIn","pinchOut","swiping","rotating","pinching"].forEach((o=>{const n=t["gestures-".concat(o,"-oid")];if(t&&n){const r=t["gestures-".concat(o,"-value")],l=parseInt(t["gestures-".concat(o,"-delta")])||10,d=parseFloat(t["gestures-".concat(o,"-limit")])||!1,c=parseFloat(t["gestures-".concat(o,"-maximum")])||100,h=parseFloat(t["gestures-".concat(o,"-minimum")])||0;let p,u=null,g=this.props.context.canStates.attr("".concat(n,".val"));void 0!==g&&null!==g&&(i.on("touchmove",(t=>t.preventDefault())),i.css({"-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),e[o]((e=>{if(g=this.props.context.canStates.attr("".concat(n,".val")),"toggle"===r)if(!0===g)u=!1;else{if(!1!==g)return void(u=null);u=!0}else{if("swiping"===o||"rotating"===o||"pinching"===o){if(null===u){if(p=this.$("#".concat(t["gestures-indicator"])),!p.length&&(p=this.$("#gestureIndicator"),!p.length)){this.$("body").append('<div id="gestureIndicator" style="position: absolute; pointer-events: none; z-index: 100; box-shadow: 2px 2px 5px 1px gray;height: 21px; border: 1px solid #c7c7c7; border-radius: 5px; text-align: center; padding-top: 6px; padding-left: 2px; padding-right: 2px; background: lightgray;"></div>'),p=this.$("#gestureIndicator");const t=this;p.on("gestureUpdate",(function(e,i){const s=t.$(this);null===i.val?s.hide():(s.html(i.val),s.css({left:"".concat(parseInt(i.x)-s.width()/2,"px"),top:"".concat(parseInt(i.y)-s.height()/2,"px")}).show())}))}this.$(this.root).css({"-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),this.$(document).on("mouseup.gesture touchend.gesture",(()=>{null!==u&&(this.props.context.setValue(n,u),u=null),p.trigger("gestureUpdate",{val:null}),this.$(document).off("mouseup.gesture touchend.gesture"),this.$(this.root).css({"-webkit-user-select":"text","-khtml-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","user-select":"text"})}))}let i,d,v=0;switch(o){case"swiping":i=Math.abs(e.touch.delta.x)>Math.abs(e.touch.delta.y)?e.touch.delta.x:-1*e.touch.delta.y,i=i>0?Math.floor(i/l):Math.ceil(i/l),d=e.touch.x,v=e.touch.y;break;case"rotating":case"pinching":i=e.touch.delta,i=i>0?Math.floor(i/l):Math.ceil(i/l),e.touch.touches[0].y<e.touch.touches[1].y?(d=e.touch.touches[1].x,v=e.touch.touches[1].y):(d=e.touch.touches[0].x,v=e.touch.touches[0].y)}return u=(parseFloat(g)||0)+(parseFloat(r)||1)*i,u=Math.max(h,Math.min(c,u)),void p.trigger("gestureUpdate",{val:u,x:d+s,y:v+a})}!1!==d?(u=(parseFloat(g)||0)+(parseFloat(r)||1),(parseFloat(r)>0&&u>d||parseFloat(r)<0&&u<d)&&(u=d)):u=r}this.props.context.setValue(n,u),u=null})))}}))}isSignalVisible(t,e){if(!(e=e||this.props.context.allWidgets[this.props.id].data))return!1;if(this.state.editMode)return!e["signals-hide-edit-".concat(t)];const i=e["signals-oid-".concat(t)];if(!i)return!1;{let s=this.props.context.canStates.attr("".concat(i,".val"));const a=e["signals-cond-".concat(t)];let o=e["signals-val-".concat(t)];if(void 0===s||null===s)return"not exist"===a;if(!a||void 0===o||null===o)return"not exist"===a;if("null"===s&&"exist"!==a&&"not exist"!==a)return!1;const n=typeof s;switch("boolean"===n||"false"===s||"true"===s?o="true"===o||!0===o||1===o||"1"===o:"number"===n?o=parseFloat(o):"object"===n&&(s=JSON.stringify(s)),a){case"==":return o=o.toString(),s=s.toString(),"1"===s&&(s="true"),"1"===o&&(o="true"),"0"===s&&(s="false"),"0"===o&&(o="false"),o===s;case"!=":return o=o.toString(),s=s.toString(),"1"===s&&(s="true"),"1"===o&&(o="true"),"0"===s&&(s="false"),"0"===o&&(o="false"),o!==s;case">=":return s>=o;case"<=":return s<=o;case">":return s>o;case"<":return s<o;case"consist":return o=o.toString(),s=s.toString(),s.toString().includes(o);case"not consist":return o=o.toString(),s=s.toString(),!s.toString().includes(o);case"exist":return"null"!==o;case"not exist":return"null"===o;default:return console.log("[".concat(this.props.id,"] Unknown signals condition: ").concat(a)),!1}}}addSignalIcon(t,e){var i;if(!(t=t||(null===(i=this.props.context.allWidgets[this.props.id])||void 0===i?void 0:i.data)))return;const s=window.document.createElement("div");s.className="vis-signal ".concat(t["signals-blink-".concat(e)]?"vis-signals-blink":""," ").concat(t["signals-text-class-".concat(e)]||""),s.dataset.index=e,s.style.display=this.isSignalVisible(e)?"":"none",s.style.pointerEvents="none",s.style.position="absolute",s.style.zIndex="10",s.style.top="".concat(t["signals-vert-".concat(e)]||0,"%"),s.style.left="".concat(t["signals-horz-".concat(e)]||0,"%");const a=window.document.createElement("img");a.className="vis-signal-icon";let o=t["signals-icon-".concat(e)];o&&(o.startsWith("/vis/")||o.startsWith("/vis-2/")?o=o.substring(5):o.startsWith("/vis-2-beta/")&&(o=o.substring(12))),a.src=o,a.style.width="".concat(t["signals-icon-size-".concat(e)]||32,"px"),a.style.height="auto",m.applyStyle(a,t["signals-icon-style-".concat(e)]),s.appendChild(a);const n=t["signals-text-".concat(e)];if(n){const i=window.document.createElement("div");i.className="vis-signal-text",m.applyStyle(i,t["signals-text-style-".concat(e)]),i.innerHTML=n,s.appendChild(i)}this.widDiv.appendChild(s)}addLastChange(t){const e="".concat(parseInt(t["lc-border-radius"],10)||0,"px"),i={background:"rgba(182,182,182,0.6)",fontFamily:"Tahoma",position:"absolute",zIndex:0,borderRadius:"left"===t["lc-position-horz"]?"".concat(e," 0 0 ").concat(e):"right"===t["lc-position-horz"]?"0 ".concat(e," ").concat(e," 0"):e,whiteSpace:"nowrap"};t["lc-font-size"]&&(i.fontSize=t["lc-font-size"]),t["lc-font-style"]&&(i.fontStyle=t["lc-font-style"]),t["lc-font-family"]&&(i.fontFamily=t["lc-font-family"]),t["lc-bkg-color"]&&(i.background=t["lc-bkg-color"]),t["lc-color"]&&(i.color=t["lc-color"]),t["lc-border-width"]&&(i.borderWidth=parseInt(t["lc-border-width"],10)||0),t["lc-border-style"]&&(i.borderStyle=t["lc-border-style"]),t["lc-border-color"]&&(i.borderColor=t["lc-border-color"]),t["lc-padding"]?i.padding=t["lc-padding"]:(i.paddingTop=3,i.paddingBottom=3),t["lc-zindex"]&&(i.zIndex=t["lc-zindex"]),"top"===t["lc-position-vert"]?i.top="".concat(parseInt(t["lc-offset-vert"],10),"px"):"bottom"===t["lc-position-vert"]?i.bottom="".concat(parseInt(t["lc-offset-vert"],10),"px"):"middle"===t["lc-position-vert"]&&(i.top="calc(50% + ".concat(parseInt(t["lc-offset-vert"],10)-10,"px)"));const s=parseFloat(t["lc-offset-horz"])||0;"left"===t["lc-position-horz"]?(i.right="calc(100% - ".concat(s,"px)"),t["lc-padding"]||(i.paddingRight=10,i.paddingLeft=10)):"right"===t["lc-position-horz"]?(i.left="calc(100% + ".concat(s,"px)"),t["lc-padding"]||(i.paddingRight=10,i.paddingLeft=10)):"middle"===t["lc-position-horz"]&&(i.left="calc(50% + ".concat(s,"px)"));const a=window.document.createElement("div");a.className="vis-last-change",a.innerHTML=this.formatDate(this.props.context.canStates.attr("".concat(t["lc-oid"],".").concat("last-change"===t["lc-type"]?"lc":"ts")),t["lc-format"],t["lc-is-interval"],t["lc-is-moment"]),Object.keys(i).forEach((t=>a.style[t]=i[t])),this.widDiv.prepend(a),(0,l.Rg)(this.widDiv.style)}addChart(t){this.widDiv.onclick=()=>{console.log("[".concat(this.props.id,"] Show dialog with chart for ").concat(t["echart-oid"]))}}visibilityOidBinding(t,e){if("visibility-oid"===t.attr&&e&&e.length<300&&/^[^.]*\.\d*\..*|^[^.]*\.[^.]*\.[^.]*\.\d*\..*/.test(e)&&c.A.FORBIDDEN_CHARS.test(e)){const i={view:t.view,widget:t.widget};if(Object.keys(this.props.context.linkContext.visibility).forEach((t=>{const s=this.props.context.linkContext.visibility[t].findIndex((t=>t.widget===i.widget));s>=0&&t!==e?this.props.context.linkContext.visibility[t].splice(s,1):s<0&&t===e&&this.props.context.linkContext.visibility[t].push(i)})),this.props.context.linkContext.visibility[e]||(this.props.context.linkContext.visibility[e]=[i]),!this.state.editMode)if(this.IDs.includes(e))this.updateVisibility();else{this.IDs.push(e);void 0!==this.props.context.canStates.attr("".concat(e,".val"))&&this.updateVisibility(),this.props.context.linkContext.subscribe([e])}}}applyBindings(t,e,i){Object.keys(this.bindings).forEach((s=>this.applyBinding(s,t,e,i)))}applyBinding(t,e,i,s){const a=this.props.context.allWidgets[this.props.id];if(!a&&(!i||!s))return;const o=this.props.context.views[this.props.view].widgets[this.props.id];this.bindings[t].forEach((t=>{s=s||a.style;const n=this.props.context.formatUtils.formatBinding({format:t.format,view:t.view,wid:this.props.id,widget:o,widgetData:i||a.data,moment:this.props.context.moment});"data"===t.type?i?i[t.attr]=n:a&&a.data.attr(t.attr,n):"style"===t.type&&(s?(s[t.attr]=n,!e&&m.applyStyle(this.widDiv,s,this.state.selected,this.state.editMode)):a&&(a.style.attr(t.attr,n),!e&&m.applyStyle(this.widDiv,a.style,this.state.selected,this.state.editMode)))}))}calcData(t,e,i,s){let a,o,n;try{a={wid:t,...e.data||{}},o=(0,l.Go)(s||e.style||{}),Object.keys(a).forEach((t=>{t&&a[t]&&"string"===typeof a[t]&&(t.startsWith("src")||t.endsWith("src")||t.includes("icon"))&&a[t].startsWith("_PRJ_NAME")&&(a[t]="../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName).concat(a[t].substring(9)))})),o["background-image"]&&o["background-image"].startsWith("_PRJ_NAME")&&(o["background-image"]="../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName).concat(o["background-image"].substring(9))),this.applyBindings(!0,a,o),a.filterkey&&"string"===typeof a.filterkey&&(a.filterkey=a.filterkey.split(",").map((t=>t.trim())).filter((t=>t))),n=void 0!==this.props.isRelative?this.props.isRelative:o&&("relative"===o.position||"static"===o.position||"sticky"===o.position),n&&(delete o.top,delete o.left,(0,l.Ny)(this.props.context.views[this.props.view].settings.rowGap)&&(o["margin-bottom"]="".concat(parseFloat(this.props.context.views[this.props.view].settings.rowGap),"px"))),this.state.multiViewWidget&&this.state.editMode&&(void 0===o.opacity||null===o.opacity||o.opacity>.3)&&(o.opacity=.3)}catch(r){return console.warn("[".concat(t,"] Cannot bind data of widget: ").concat(r)),{widgetData:null,widgetStyle:null,isRelative:!1}}return{widgetData:a,widgetStyle:o,isRelative:n}}renderWidget(t,e,i,s,a){var o,n;"function"===typeof t&&(a=t,t=!1),s=s||0;let r=this.props.refParent;if(Object.prototype.hasOwnProperty.call(r,"current")&&(r=r.current),!r)return void(s<5&&setTimeout((()=>this.renderWidget(t,e,i,s+1,a)),50));const l=this.props.id;let d=this.props.context.views[this.props.view].widgets[l];if(!d||"object"!==typeof d)return;if(null!==(o=d)&&void 0!==o&&o.groupid){const t=this.props.context.views[this.props.view].widgets[d.groupid].data,e=Object.keys(t).map((t=>t.startsWith("attrType_")?t.substring(9):null)).filter((t=>t));if(e.length&&d.data){let i=!1;Object.keys(d.data).forEach((s=>{if("string"===typeof d.data[s]&&e.find((t=>d.data[s].includes(t)))){const e=(0,u.bx)(d.data[s],t);e.doesMatch&&(i||(i=!0,d=JSON.parse(JSON.stringify(d))),d.data[s]=e.newString||"")}}))}}if(!t){const{isRelative:s,widgetData:a,widgetStyle:o}=this.calcData(l,d,e,i),n=JSON.stringify(a),r=JSON.stringify(o);if(this.widDiv&&this.oldEditMode===this.state.editMode&&this.oldData===n&&!t){if(this.oldStyle===r||a._no_style)return;if(!this.updateOnStyle){if(this.oldStyle=r,this.props.context.allWidgets[l]&&this.props.context.allWidgets[l].style){const t=this.props.context.allWidgets[l].style;Object.keys(o).forEach((e=>{t[e]!==o[e]&&t.attr(e,o[e])}))}return m.applyStyle(this.widDiv,o,this.state.selected,this.state.editMode),this.widDiv.style.position=s?o.position||"relative":"absolute",void console.log("Rerender ignored as only style applied")}}}this.destroy(t);const h=this.IDs;c.A.removeFromArray(this.props.context.linkContext.visibility,this.IDs,this.props.view,l),c.A.removeFromArray(this.props.context.linkContext.lastChanges,this.IDs,this.props.view,l),c.A.removeFromArray(this.props.context.linkContext.signals,this.IDs,this.props.view,l),c.A.removeFromArray(this.props.context.linkContext.bindings,this.IDs,this.props.view,l),this.setupSubscriptions();const p=h.filter((t=>!this.IDs.includes(t)));p.length&&this.props.context.linkContext.unsubscribe(p);const g=this.IDs.filter((t=>!h.includes(t)));g.length&&this.props.context.linkContext.subscribe(g);const{isRelative:x,widgetData:f,widgetStyle:y}=this.calcData(l,d,e,i),w=JSON.stringify(f),b=JSON.stringify(y);this.oldEditMode=this.state.editMode,this.oldData=w,this.oldStyle=b,f.wid=l,this.props.context.allWidgets[l]={style:new this.props.context.can.Map(y),data:new this.props.context.can.Map(f),wid:l};let D=f["visibility-groups"];if(!this.state.editMode&&null!==(n=D)&&void 0!==n&&n.length){if("hide"===f["visibility-groups-action"]){if(!this.isUserMemberOfGroup(this.props.context.user,D))return;D=null}}else D=null;try{if(!this.props.tpl)return void console.error("[".concat(l,"] Widget is invalid. Please delete it."));var _,S;if(!this.widDiv||!t||null===(_=d)||void 0===_||null===(S=_.data)||void 0===S||!S.members.length){const t={data:this.props.context.allWidgets[l].data,viewDiv:this.props.view,view:this.props.view,style:this.props.context.allWidgets[l].style};null!==f&&void 0!==f&&f.oid&&(t.val=this.props.context.canStates.attr("".concat(f.oid,".val")));const e=this.props.context.can.view(this.props.tpl,t),i=Array.from(e.querySelectorAll("script"));for(let s=0;s<i.length;s++){const t=i[s],e=document.createElement("script");e.innerHTML=t.innerHTML,t.parentNode.replaceChild(e,t)}if(x){const t=this.props.relativeWidgetOrder.indexOf(l);if(0===t)r.prepend(e);else if(t===this.props.relativeWidgetOrder.length-1)r.appendChild(e);else{let i;for(let s=t+1;s<this.props.relativeWidgetOrder.length;s++)if(i=r.querySelector("#".concat(this.props.relativeWidgetOrder[s])),i){r.insertBefore(e,i);break}i||r.appendChild(e)}}else r.appendChild(e)}if(this.widDiv=r.querySelector("#".concat(l)),this.widDiv){this.props.context.allWidgets[l].style&&!f._no_style&&m.applyStyle(this.widDiv,this.props.context.allWidgets[l].style,this.state.selected,this.state.editMode),this.widDiv.style.position=x?this.props.context.allWidgets[l].style.position||"relative":"absolute",this.widDiv.style.boxSizing="border-box",f&&f.class&&(this.widDiv.className=(0,u.iQ)(this.widDiv.className,f.class));const t=window.document.getElementById(this.props.tpl),e=t.dataset.visName||("g"===l[0]?"group":"noname"),i=t.dataset.visSet||"noset";if(this.updateOnStyle="true"===t.dataset.visUpdateStyle,this.resizeLocked="true"===t.dataset.visResizeLocked,this.widDiv.className=(0,u.iQ)(this.widDiv.className,"vis-tpl-".concat(i,"-").concat(e.replace(/\s/g,"-"))),this.state.editMode){if(this.props.context.allWidgets[this.props.id]){const t=v(this.widDiv,null,this.props.context.allWidgets[this.props.id].style);this.state.resizable===t.resizable&&this.state.hideHelper===t.hideHelper&&this.state.draggable===t.draggable||setTimeout((()=>this.setState(t)),50)}}else this.updateVisibility(),this.props.context.$$&&this.addGestures(f);let s=0;for(;f["signals-oid-".concat(s)];)this.addSignalIcon(f,s),s++;f["lc-oid"]&&"nothing_selected"!==f["lc-oid"]&&this.addLastChange(f),!this.state.editMode&&f["echart-oid"]&&this.addChart(f),D&&"disabled"===d.data["visibility-groups-action"]&&!this.isUserMemberOfGroup(this.props.context.user,D)&&(this.widDiv.className=(0,u.iQ)(this.widDiv.className,"vis-user-disabled")),this.refService.current&&setTimeout((()=>{this.refService.current&&this.widDiv&&(this.refService.current.style.width="".concat(this.widDiv.offsetWidth,"px"),this.refService.current.style.height="".concat(this.widDiv.offsetHeight,"px"),x&&(this.refService.current.style.left="".concat(this.widDiv.offsetLeft,"px"),this.refService.current.style.top="".concat(this.widDiv.offsetTop,"px")))}),50),this.onCommand("updateContainers")}else console.log("Div not yet rendered");this.props.askView&&this.props.askView("register",{id:l,winDiv:this.widDiv||null,refService:this.refService,onMove:this.onMove,onResize:this.onResize,onTempSelect:this.onTempSelect,onCommand:this.onCommandBound})}catch(I){const t=(I.toString()+I.stack.toString()).split("\n"),e="can't render ".concat(this.props.tpl," ").concat(l,' on "').concat(this.props.view,'": ');this.props.context.socket.log(e,"error"),console.error(e);for(let i=0;i<t.length;i++){const e="".concat(i," - ").concat(t[i]);this.props.context.socket.log(e,"error"),console.error(e)}}a&&a()}shouldComponentUpdate(t,e){const i=JSON.stringify(e);return this.widDiv?(!this.lastState||i!==this.lastState)&&(this.lastState=i,!0):(this.lastState=i,!0)}renderWidgetBody(t){if(this.state.applyBindings&&!this.bindingsTimer&&(this.bindingsTimer=setTimeout((()=>{this.bindingsTimer=null,this.renderWidget(!0)}),10)),this.widDiv&&this.state.editMode&&this.props.context.allWidgets[this.props.id]){const e=this.props.context.allWidgets[this.props.id].style["z-index"],i=parseInt(e||0,10);this.state.selected?this.widDiv.style.zIndex=500+(i||0):void 0!==e&&(this.widDiv.style.zIndex=parseInt(e||0,10)),this.state.selected?t.style.zIndex=500+(i||0)+1:t.style.zIndex=(i||0)+1,this.widDiv.style.userSelect="none",this.widDiv.style.pointerEvents="none",void 0!==this.filterDisplay&&(this.widDiv.style.display=this.filterDisplay,delete this.filterDisplay)}t.style.position="absolute";const e=this.state.legacyViewContainers.length?this.state.legacyViewContainers.map((e=>{const i=this.props.context,s=i.VisView;this.refViews[e]=this.refViews[e]||a().createRef();const o=i.linkContext.getViewRef(e);return o&&o!==this.refViews[e]?(console.log("View is not rendered as used somewhere else!"),null):e&&i.views[e]?(0,g.jsx)(s,{context:i,activeView:e,editMode:!1,ref:this.refViews[e],askView:t.askView,view:e,visInWidget:!0},e):null})):null;return this.state.editMode||(t.style.display="none"),e}}m.propTypes={id:p().string.isRequired,view:p().string.isRequired,editMode:p().bool,isRelative:p().bool,refParent:p().object.isRequired,selectedWidgets:p().array,relativeWidgetOrder:p().array,tpl:p().string.isRequired};const x=m;var f=i(65198),y=i(5770);const w=48;class b extends a().Component{renderMenu(t){const e=[];return Object.keys(this.props.context.views).forEach((i=>{if("___settings"===i)return;const s=this.props.context.views[i].settings;if(s.navigation){var a,o;const n={text:"horizontal"===t.navigationOrientation&&s.navigationOnlyIcon?null:s.navigationTitle||i,color:s.navigationColor,icon:s.navigationIcon||s.navigationImage,noText:s.navigationOnlyIcon,order:parseInt(null!==(a=s.navigationOrder)&&void 0!==a?a:"0"),view:i};e.push(n),null!==(o=n.icon)&&void 0!==o&&o.startsWith("_PRJ_NAME/")&&(n.icon="../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName).concat(n.icon.substring(9)))}})),e.sort(((t,e)=>t.order===e.order?0:t.order<e.order?-1:1)),"horizontal"===t.navigationOrientation?(0,g.jsx)("div",{className:this.props.classes.verticalMenu,style:{backgroundColor:t.navigationBarColor||this.props.context.theme.palette.background.paper,opacity:this.props.editMode?.4:1,position:this.props.editMode?"relative":"fixed"},children:(0,g.jsx)(f.Tabs,{value:this.props.activeView,children:e.map(((t,e)=>(0,g.jsx)(f.Tab,{iconPosition:"start",style:{minHeight:48,minWidth:t.noText?20:void 0},icon:t.icon?(0,g.jsx)(r.Icon,{src:t.icon,className:this.props.classes.listItemIcon}):void 0,onClick:()=>this.props.context.changeView(t.view),value:t.view,label:t.text},e)))})}):(0,g.jsxs)("div",{style:{opacity:this.props.editMode?.4:1,backgroundColor:t.navigationBackground||void 0},className:r.Utils.clsx(this.props.classes.menu,"full"===this.props.menuWidth&&this.props.classes.menuFull,"narrow"===this.props.menuWidth&&this.props.classes.menuNarrow,"hidden"===this.props.menuWidth&&this.props.classes.menuHidden),children:[(0,g.jsx)("div",{style:{color:t.navigationHeaderTextColor||void 0},className:r.Utils.clsx(this.props.classes.menuToolbar,"full"===this.props.menuWidth&&this.props.classes.menuToolbarFull,"narrow"===this.props.menuWidth&&this.props.classes.menuToolbarNarrow,"hidden"===this.props.menuWidth&&this.props.classes.menuToolbarNarrow),children:t.navigationHeaderText||""}),(0,g.jsx)(f.Divider,{}),(0,g.jsx)("div",{className:this.props.classes.menuList,children:(0,g.jsx)(f.List,{children:e.map(((e,i)=>{const s=(0,g.jsx)(f.ListItem,{disablePadding:!0,className:r.Utils.clsx(this.props.classes.menuItem,this.props.activeView===e.view&&this.props.classes.selectedMenu),style:{backgroundColor:this.props.activeView===e.view?t.navigationSelectedBackground:void 0},onClick:async()=>{t.navigationHideOnSelection&&await this.hideNavigationMenu(),await this.props.context.changeView(e.view)},children:(0,g.jsxs)(f.ListItemButton,{children:[(0,g.jsx)(f.ListItemIcon,{children:e.icon?(0,g.jsx)(r.Icon,{src:e.icon,style:{color:this.props.activeView===e.view?t.navigationSelectedColor:t.navigationColor,backgroundColor:"rgba(1,1,1,0)"},className:r.Utils.clsx(this.props.classes.listItemIcon,this.props.activeView===e.view&&this.props.classes.selectedMenu)}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(y.Dashboard,{style:{color:this.props.activeView===e.view?t.navigationSelectedColor:t.navigationColor,backgroundColor:"rgba(1,1,1,0)"},className:r.Utils.clsx(this.props.activeView===e.view&&this.props.classes.selectedMenu,"full"!==this.props.menuWidth&&this.props.classes.transparent)}),e.text?(0,g.jsx)("span",{style:{color:this.props.activeView===e.view?t.navigationSelectedColor:t.navigationColor},className:r.Utils.clsx(this.props.classes.listItemIconText,"full"===this.props.menuWidth&&this.props.classes.transparent),children:e.text[0].toUpperCase()}):null]})}),(0,g.jsx)(f.ListItemText,{primary:e.text,style:{color:this.props.activeView===e.view?t.navigationSelectedColor:t.navigationColor},classes:{primary:r.Utils.clsx(this.props.classes.listItemText,this.props.activeView===e.view&&!t.navigationSelectedColor&&this.props.classes.selectedMenu,"narrow"===this.props.menuWidth&&this.props.classes.listItemTextNarrow)}})]})},i);return(0,g.jsx)(f.Tooltip,{title:"full"!==this.props.menuWidth?e.text:"",classes:{popper:this.props.classes.tooltip},children:s},i)}))})})]})}renderToolbar(t){var e;if(!t.navigationBar)return null;let i;i=t.navigationBarColor?{backgroundColor:t.navigationBarColor,color:r.Utils.getInvertedColor(t.navigationBarColor,this.props.context.themeType,!0)}:{},i.opacity=this.props.editMode?.4:1;let s=t.navigationBarIcon||t.navigationBarImage;return null!==(e=s)&&void 0!==e&&e.startsWith("_PRJ_NAME/")&&(s="../".concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName).concat(s.substring(9))),(0,g.jsxs)("div",{className:r.Utils.clsx(this.props.classes.toolBar,"hidden"===this.props.menuWidth&&this.props.classes.toolBarWithClosedMenu),style:i,children:[s?(0,g.jsx)(r.Icon,{src:s,className:this.props.classes.toolbarIcon}):null,t.navigationBarText||this.props.activeView]})}async hideNavigationMenu(){window.localStorage.setItem("vis.navOpened","hidden"),await this.props.setMenuWidth("hidden")}render(){if(!this.props.context.views||!this.props.context.views[this.props.view])return null;const t=this.props.context.views[this.props.view].settings;return t.navigation&&!this.props.visInWidget&&"horizontal"===t.navigationOrientation&&this.props.view===this.props.activeView?(0,g.jsxs)("div",{className:this.props.classes.rootHorizontal,children:[this.renderMenu(t),(0,g.jsx)("div",{className:this.props.classes.viewContentWithToolbar,style:{marginTop:this.props.editMode?void 0:w},children:this.props.children})]}):!t.navigation&&t.navigationBar?(0,g.jsxs)("div",{className:this.props.classes.afterMenuHidden,children:[this.renderToolbar(t),(0,g.jsx)("div",{className:this.props.classes.viewContentWithToolbar,children:this.props.children})]}):(0,g.jsxs)("div",{className:this.props.classes.root,children:[t.navigationHideMenu?null:(0,g.jsx)("div",{className:r.Utils.clsx(this.props.classes.openMenuButton,"full"===this.props.menuWidth&&this.props.classes.openMenuButtonFull,"narrow"===this.props.menuWidth&&this.props.classes.openMenuButtonNarrow,"hidden"===this.props.menuWidth&&this.props.classes.openMenuButtonHidden),style:t.navigationBar&&"hidden"===this.props.menuWidth?{opacity:1}:void 0,children:(0,g.jsx)(f.IconButton,{onClick:()=>{"full"===this.props.menuWidth?(window.localStorage.setItem("vis.navOpened","narrow"),this.props.setMenuWidth("narrow")):"narrow"===this.props.menuWidth?t.navigationNoHide?(window.localStorage.setItem("vis.navOpened","full"),this.props.setMenuWidth("full")):this.hideNavigationMenu():(window.localStorage.setItem("vis.navOpened","full"),this.props.setMenuWidth("full"))},style:{backgroundColor:"hidden"===this.props.menuWidth&&t.navigationButtonBackground?t.navigationButtonBackground||("dark"===this.props.context.themeType?"white":"black"):"inherit",color:"hidden"===this.props.menuWidth&&t.navigationButtonBackground?t.navigationButtonBackground||("dark"===this.props.context.themeType?"black":"white"):"inherit"},children:(0,g.jsx)(y.ChevronLeft,{className:"hidden"===this.props.menuWidth||"narrow"===this.props.menuWidth&&t.navigationNoHide?this.props.classes.openMenuButtonIconHidden:"",style:t.navigationBar&&"hidden"===this.props.menuWidth?{color:t.navigationChevronColor||("dark"===this.props.context.themeType?"#000":"#FFF")}:{color:t.navigationChevronColor}})})}),t.navigationHideMenu?null:this.renderMenu(t),(0,g.jsxs)("div",{className:r.Utils.clsx(this.props.classes.afterMenu,!t.navigationHideMenu&&"full"===this.props.menuWidth&&this.props.classes.afterMenuFull,!t.navigationHideMenu&&"narrow"===this.props.menuWidth&&this.props.classes.afterMenuNarrow,(t.navigationHideMenu||"hidden"===this.props.menuWidth)&&this.props.classes.afterMenuHidden),children:[this.renderToolbar(t),(0,g.jsx)("div",{className:t.navigationBar?this.props.classes.viewContentWithToolbar:this.props.classes.viewContentWithoutToolbar,children:this.props.children})]})]})}}const D=(0,n.withStyles)((t=>({root:{width:"100%",height:"100%",display:"flex",position:"relative"},rootHorizontal:{width:"100%",height:"100%",display:"flex",position:"relative",flexDirection:"column"},toolBar:{width:"100%",height:w,overflow:"hidden",lineHeight:"".concat(w,"px"),paddingLeft:16,fontSize:20,backgroundColor:t.palette.primary.main,color:t.palette.primary.contrastText,transition:"padding-left 0.4s ease-in-out",display:"flex",alignItems:"center",gap:8},toolbarIcon:{height:32,width:"auto"},verticalMenu:{width:"100%",top:0,left:0,height:w,overflow:"hidden",lineHeight:"".concat(w,"px"),backgroundColor:t.palette.primary.main,zIndex:450},toolBarWithClosedMenu:{paddingLeft:64},viewContentWithToolbar:{position:"relative",height:"calc(100% - ".concat(w,"px)"),width:"100%"},viewContentWithoutToolbar:{position:"relative",height:"100%",width:"100%"},openMenuButton:{position:"absolute",top:5,width:w,height:w,zIndex:999,transition:"all 0.3s ease-in-out"},openMenuButtonFull:{left:152},openMenuButtonNarrow:{left:8},openMenuButtonHidden:{left:8,opacity:.5},openMenuButtonIconHidden:{transform:"rotate(180deg)",transformOrigin:"center",transition:"all 0.3s ease-in-out"},menu:{transition:"width 0.4s ease-in-out, opacity 0.3s ease-in-out"},menuFull:{width:200,height:"100%",display:"inline-block",overflow:"hidden",opacity:1},menuNarrow:{width:56,height:"100%",display:"inline-block",overflow:"hidden",opacity:1},menuHidden:{width:0,height:"100%",display:"inline-block",opacity:0},afterMenu:{transition:"width 0.4s ease-in-out"},afterMenuFull:{width:"calc(100% - ".concat(200,"px)"),height:"100%",display:"inline-block"},afterMenuNarrow:{width:"calc(100% - ".concat(56,"px)"),height:"100%",display:"inline-block"},afterMenuHidden:{width:"100%",height:"100%",display:"inline-block"},menuList:{width:"100%",height:"calc(100% - 49px)",overflowY:"auto",overflowX:"hidden"},menuItem:{minHeight:w},listItemIcon:{width:24,height:24},listItemIconText:{paddingLeft:8,opacity:1,transition:"opacity 0.3s ease-in-out",position:"absolute",top:12,left:16},listItemText:{whiteSpace:"nowrap",transition:"all 0.3s ease-in-out",opacity:1},listItemTextNarrow:{opacity:0},selectedMenu:{backgroundColor:t.palette.secondary.main,color:t.palette.secondary.contrastText},tooltip:{pointerEvents:"none"},menuToolbar:{height:w,display:"flex",lineHeight:"".concat(w,"px"),verticalAlign:"middle",paddingLeft:16,fontSize:20,whiteSpace:"nowrap",transition:"opacity 0.3s ease-in-out"},menuToolbarFull:{opacity:1},menuToolbarNarrow:{opacity:0},transparent:{opacity:0}})))(b);var _=i(86219);const S=(0,n.createGenerateClassName)({productionPrefix:"vis"});class I extends a().Component{constructor(t){super(t),this.promiseToCollect=void 0,this.refView=void 0,this.refRelativeView=void 0,this.refRelativeColumnsView=void 0,this.widgetsRefs=void 0,this.selectDiv=void 0,this.movement=void 0,this.theme=void 0,this.ignoreMouseEvents=void 0,this.oldFilter=void 0,this.registerDone=!1,this.lastClick=0,this.nextClickIsSteal=null,this.loadingTheme=!1,this.moveTimer=null,this.keysHandlerInstalled=!1,this.onCommand=(t,e)=>{if("updateContainers"===t)return Object.keys(this.widgetsRefs).forEach((t=>{var e;null!==(e=this.widgetsRefs[t])&&void 0!==e&&e.onCommand&&this.widgetsRefs[t].onCommand("updateContainers")})),null;if("changeFilter"===t)return this.changeFilter(e),null;var i;if("closeDialog"===t||"openDialog"===t)return null!==(i=this.widgetsRefs[e])&&void 0!==i&&i.onCommand&&this.widgetsRefs[e].onCommand(t),null;if("collectFilters"===t){const t=d.M_.getState().visProject[this.props.view].widgets,e=[];return Object.keys(t).forEach((i=>{var s;let a;var o,n,r;null!==(s=this.widgetsRefs[i])&&void 0!==s&&s.onCommand?a=null===(o=this.widgetsRefs[i])||void 0===o?void 0:o.onCommand("collectFilters"):a=null===(n=t[i])||void 0===n||null===(r=n.data)||void 0===r?void 0:r.filterkey;a&&(a&&"string"===typeof a&&(a=a.split(",").map((t=>t.trim())).filter((t=>t))),a.forEach((t=>!e.includes(t)&&e.push(t))))})),e}return null},this.askView=(t,e)=>{const i=this.widgetsRefs;if("register"===t){if(e){i[e.id]=e}}else if("unregister"===t)e&&i[e.id]&&i[e.id].uuid===e.uuid&&delete i[e.id];else if("update"===t)e&&i[e.id]&&i[e.id].uuid===e.uuid&&Object.assign(i[e.id],e);else if("getRef"===t){if(e)return i[e.id]}else if("getViewClass"===t)return this;return null},this.onMouseWindowDown=t=>{var e;null!==(e=this.refView.current)&&void 0!==e&&e.contains(t.target)||this.cancelStealMode(null)},this.onStealStyle=(t,e)=>{t?(this.nextClickIsSteal={attr:t,cb:e},Object.keys(this.widgetsRefs).forEach((t=>{var e;null!==(e=this.widgetsRefs[t])&&void 0!==e&&e.onCommand&&this.widgetsRefs[t].onCommand("startStealMode")})),window.document.addEventListener("mousedown",this.onMouseWindowDown)):this.cancelStealMode(null)},this.mouseDownLocal=this.props.context.runtime?null:t=>{var e;if(this.ignoreMouseEvents)return;if(2===t.button)return;if(this.nextClickIsSteal)return void this.cancelStealMode(null);this.props.context.setSelectedWidgets([]),this.onMouseViewMove&&window.document.addEventListener("mousemove",this.onMouseViewMove),this.onMouseViewUp&&window.document.addEventListener("mouseup",this.onMouseViewUp);const i=null===(e=this.refView.current)||void 0===e?void 0:e.getBoundingClientRect();i&&(this.movement={moved:!1,x:t.clientX-i.left,y:t.clientY-i.top,startX:t.pageX,startY:t.pageY,w:0,h:0,selectedWidgetsWithRectangle:[],simpleMode:t.shiftKey||t.ctrlKey})},this.doubleClickOnView=()=>{this.props.editMode&&this.props.selectedWidgets&&1===this.props.selectedWidgets.length&&"_tplGroup"===d.M_.getState().visProject[this.props.view].widgets[this.props.selectedWidgets[0]].tpl&&this.props.context.setSelectedGroup(this.props.selectedWidgets[0])},this.calculateRelativeWidgetPosition=null,this.onMouseViewMove=this.props.context.runtime?null:t=>{if(!this.ignoreMouseEvents&&this.movement&&(!this.selectDiv&&this.refView.current&&(this.selectDiv=window.document.createElement("div"),this.selectDiv.style.position="absolute",this.selectDiv.style.zIndex=I.Z_INDEXES.VIEW_SELECT_RECTANGLE.toString(),this.selectDiv.className="vis-editmode-select-rect",this.refView.current.appendChild(this.selectDiv)),this.movement.moved=!0,this.movement.w=t.pageX-(this.movement.startX||0),this.movement.h=t.pageY-(this.movement.startY||0),this.selectDiv)){this.movement.w>=0?(this.selectDiv.style.left="".concat(this.movement.x,"px"),this.selectDiv.style.width="".concat(this.movement.w,"px")):(this.selectDiv.style.left="".concat(this.movement.x+this.movement.w,"px"),this.selectDiv.style.width="".concat(-this.movement.w,"px")),this.movement.h>=0?(this.selectDiv.style.top="".concat(this.movement.y,"px"),this.selectDiv.style.height="".concat(this.movement.h,"px")):(this.selectDiv.style.top="".concat(this.movement.y+this.movement.h,"px"),this.selectDiv.style.height="".concat(-this.movement.h,"px"));const t=this.getWidgetsInRect(this.selectDiv.getBoundingClientRect(),this.movement.simpleMode||!1);this.movement.selectedWidgetsWithRectangle&&JSON.stringify(t)!==JSON.stringify(this.movement.selectedWidgetsWithRectangle)&&(t.forEach((t=>{var e,i,s;null!==(e=this.movement)&&void 0!==e&&null!==(i=e.selectedWidgetsWithRectangle)&&void 0!==i&&i.includes(t)||!this.widgetsRefs[t]||d.M_.getState().visProject[this.props.view].widgets[t].data.locked||this.props.selectedGroup===t||null!==(s=this.widgetsRefs[t])&&void 0!==s&&s.onTempSelect&&this.widgetsRefs[t].onTempSelect(!0)})),this.movement.selectedWidgetsWithRectangle.forEach((e=>{var i;!t.includes(e)&&null!==(i=this.widgetsRefs[e])&&void 0!==i&&i.onTempSelect&&this.widgetsRefs[e].onTempSelect(!1)})),this.movement.selectedWidgetsWithRectangle=t.filter((t=>!d.M_.getState().visProject[this.props.view].widgets[t].data.locked)))}},this.onMouseViewUp=this.props.context.runtime?null:t=>{var e;this.ignoreMouseEvents||(t&&t.stopPropagation(),this.onMouseViewMove&&window.document.removeEventListener("mousemove",this.onMouseViewMove),this.onMouseViewUp&&window.document.removeEventListener("mouseup",this.onMouseViewUp),this.selectDiv&&(this.selectDiv.remove(),this.selectDiv=null),(null===(e=this.movement)||void 0===e?void 0:e.selectedWidgetsWithRectangle)&&this.props.context.setSelectedWidgets(this.movement.selectedWidgetsWithRectangle),this.movement=null)},this.mouseDownOnView=this.props.context.runtime?null:(t,e,i,s,a)=>{var o;if(this.ignoreMouseEvents)return;if(this.nextClickIsSteal){if(this.widgetsRefs[e]){var n;const t=this.widgetsRefs[e].widDiv||(null===(n=this.widgetsRefs[e].refService)||void 0===n?void 0:n.current);this.cancelStealMode(t?t.style[this.nextClickIsSteal.attr]:null)}else this.cancelStealMode(null);return}if(this.props.context.disableInteraction||this.props.context.lockDragging||this.props.selectedWidgets.map((t=>d.M_.getState().visProject[this.props.view].widgets[t])).find((t=>t.data.locked)))return;if(this.lastClick&&Date.now()-this.lastClick<250||a)return this.lastClick=Date.now(),void(1===this.props.selectedWidgets.length&&"_tplGroup"===d.M_.getState().visProject[this.props.view].widgets[this.props.selectedWidgets[0]].tpl&&this.props.context.setSelectedGroup(this.props.selectedWidgets[0]));if(this.lastClick=Date.now(),this.props.selectedWidgets.includes(this.props.selectedGroup)&&!s)return;this.onMouseWidgetMove&&(null===(o=this.refView.current)||void 0===o||o.addEventListener("mousemove",this.onMouseWidgetMove)),this.onMouseWidgetUp&&window.document.addEventListener("mouseup",this.onMouseWidgetUp),this.movement={moved:!1,startX:t.pageX,startY:t.pageY,isResize:s,x:0,y:0};const r=this.widgetsRefs;this.props.selectedWidgets.forEach((e=>{var i,s;const a=null===(i=r[e].refService)||void 0===i||null===(s=i.current)||void 0===s?void 0:s.getBoundingClientRect();var o,n;this.movement&&a&&t.pageX<=a.right&&t.pageX>=a.left&&t.pageY<=a.bottom&&t.pageY>=a.top&&(this.movement.startWidget=null===(o=r[e].refService)||void 0===o||null===(n=o.current)||void 0===n?void 0:n.getBoundingClientRect())})),this.props.selectedWidgets.forEach((t=>{var e;null!==(e=r[t])&&void 0!==e&&e.onMove&&r[t].onMove()})),Object.keys(r).forEach((t=>{var e;null!==(e=r[t])&&void 0!==e&&e.onCommand&&r[t].onCommand("startMove")}))},this.onIgnoreMouseEvents=t=>{var e;this.props.editMode&&(this.ignoreMouseEvents=t,this.props.context.onIgnoreMouseEvents(t),t&&this.movement&&(this.onMouseWidgetMove&&(null===(e=this.refView.current)||void 0===e||e.removeEventListener("mousemove",this.onMouseWidgetMove)),this.onMouseWidgetUp&&window.document.removeEventListener("mouseup",this.onMouseWidgetUp),this.movement=null))},this.onMouseWidgetMove=this.props.context.runtime?null:t=>{var e,i,s,a;if(!this.movement||!this.refView.current||this.props.selectedWidgets.includes(this.props.selectedGroup)&&!this.movement.isResize)return;const o=this.widgetsRefs;this.movement.moved=!0,this.movement.x=t.pageX-(this.movement.startX||0),this.movement.y=t.pageY-(this.movement.startY||0);const n=this.refView.current.getBoundingClientRect();if(!this.movement.isResize&&2===(null===(e=d.M_.getState().visProject[this.props.view].settings)||void 0===e?void 0:e.snapType)){var r,l,c;const t=parseInt((null===(r=d.M_.getState().visProject[this.props.view].settings)||void 0===r?void 0:r.gridSize)||0,10)||10;this.movement.x-=Math.ceil((((null===(l=this.movement.startWidget)||void 0===l?void 0:l.left)||0)-n.left+this.movement.x)%t),this.movement.y-=Math.ceil((((null===(c=this.movement.startWidget)||void 0===c?void 0:c.top)||0)-n.top+this.movement.y)%t)}if(!this.movement.isResize&&1===(null===(i=d.M_.getState().visProject[this.props.view].settings)||void 0===i?void 0:i.snapType)){var h,p,u,g;const t=((null===(h=this.movement.startWidget)||void 0===h?void 0:h.left)||0)+this.movement.x,e=((null===(p=this.movement.startWidget)||void 0===p?void 0:p.right)||0)+this.movement.x,i=((null===(u=this.movement.startWidget)||void 0===u?void 0:u.top)||0)+this.movement.y,s=((null===(g=this.movement.startWidget)||void 0===g?void 0:g.bottom)||0)+this.movement.y;for(const a in o){var v,m;const n=a;if(this.props.selectedWidgets.includes(n))continue;const r=null===(v=o[n].refService)||void 0===v||null===(m=v.current)||void 0===m?void 0:m.getBoundingClientRect();if(r){if(Math.abs(r.top-s)<=10&&t<=r.right&&e>=r.left){this.movement.y+=Math.round(r.top-s);break}if(Math.abs(r.bottom-i)<=10&&t<=r.right&&e>=r.left){this.movement.y+=Math.round(r.bottom-i);break}if(Math.abs(r.left-e)<=10&&i<=r.bottom&&s>=r.top){this.movement.x+=Math.round(r.left-e);break}if(Math.abs(r.right-t)<=10&&i<=r.bottom&&s>=r.top){this.movement.x+=Math.round(r.right-t);break}}}}if(this.showRulers(),this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=o[t])||void 0===e?void 0:e.onMove;i&&this.movement&&i(this.movement.x,this.movement.y,!1,this.calculateRelativeWidgetPosition);const s=d.M_.getState().visProject[this.props.view].widgets[t];Object.keys(s.data).forEach((t=>{if(t.startsWith("widget")&&s.data[t]){var e;const i=null===(e=o[s.data[t]])||void 0===e?void 0:e.onCommand;i&&i("updatePosition")}}))})),1===this.props.selectedWidgets.length&&null!==(s=o[this.props.selectedWidgets[0]])&&void 0!==s&&null!==(a=s.refService)&&void 0!==a&&a.current){let t=!1;for(const e in o){var x,f,y,w,b,D;const i=e;if(this.props.selectedWidgets.includes(i)||!o[i]||!o[i].canHaveWidgets||!o[i].onCommand||null===(x=o[i].refService)||void 0===x||!x.current)continue;const s=null===(f=o[this.props.selectedWidgets[0]].refService)||void 0===f||null===(y=f.current)||void 0===y?void 0:y.getBoundingClientRect(),a=null===(w=o[i].refService)||void 0===w||null===(b=w.current)||void 0===b?void 0:b.getBoundingClientRect(),n=null===(D=o[i])||void 0===D?void 0:D.onCommand;!t&&s&&a&&s.top>=a.top&&s.left>=a.left&&s.right<=a.right&&s.bottom<=a.bottom?(t=!0,n&&n("includePossible")):n&&n("includePossibleNOT")}}},this.showRulers=t=>{var e;const i=[];if(t)return void this.setState({rulers:i});const s=[],a=[],o=null===(e=this.refView.current)||void 0===e?void 0:e.getBoundingClientRect();if(!o)return;for(const g of Object.keys(this.widgetsRefs)){const t=g,{widgets:e}=(0,d.sf)(d.M_.getState(),this.props.view);var n;if(!this.props.selectedWidgets.includes(t)&&e[t]&&(this.props.selectedGroup&&e[this.props.selectedGroup].data.members.includes(t)||!this.props.selectedGroup)&&(!e[t].grouped||this.props.selectedGroup))if(null!==(n=this.widgetsRefs[t].refService)&&void 0!==n&&n.current){var r,l;const e=null===(r=this.widgetsRefs[t].refService)||void 0===r||null===(l=r.current)||void 0===l?void 0:l.getBoundingClientRect();e&&(a.push(Math.round(e.top)),a.push(Math.round(e.bottom)),s.push(Math.round(e.left)),s.push(Math.round(e.right)))}else console.error("CHECK WHY!!! ".concat(t," has no refService.current"))}const c=[],h=[];for(const g of this.props.selectedWidgets){const{widgets:t}=(0,d.sf)(d.M_.getState(),this.props.view);if(t[g]&&(!t[g].grouped||this.props.selectedGroup)){var p,u;const t=null===(p=this.widgetsRefs[g].refService)||void 0===p||null===(u=p.current)||void 0===u?void 0:u.getBoundingClientRect();t&&(c.push(Math.round(t.top)),c.push(Math.round(t.bottom)),h.push(Math.round(t.left)),h.push(Math.round(t.right)))}}a.forEach((t=>c.forEach((e=>{Math.abs(t-e)<=.3&&i.push({type:"horizontal",value:t-o.top})})))),s.forEach((t=>h.forEach((e=>{Math.abs(t-e)<=.3&&i.push({type:"vertical",value:t-o.left})})))),this.setState({rulers:i})},this.onMouseWidgetUp=this.props.context.runtime?null:t=>{var e,i,s,a;const o=this.widgetsRefs;if(t&&t.stopPropagation(),this.onMouseWidgetMove&&(null===(e=this.refView.current)||void 0===e||e.removeEventListener("mousemove",this.onMouseWidgetMove)),this.onMouseWidgetUp&&window.document.removeEventListener("mouseup",this.onMouseWidgetUp),null!==(i=this.movement)&&void 0!==i&&i.moved&&(this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=o[t])||void 0===e?void 0:e.onMove;i&&this.movement&&i(this.movement.x,this.movement.y,!0)})),d.M_.dispatch((0,d.V_)(!0))),Object.keys(o).forEach((t=>{var e;const i=null===(e=o[t])||void 0===e?void 0:e.onCommand;i&&i("stopMove")})),1===this.props.selectedWidgets.length&&null!==(s=o[this.props.selectedWidgets[0]])&&void 0!==s&&null!==(a=s.refService)&&void 0!==a&&a.current)for(const d in o){var n,r,l,c,h;const t=d;if(this.props.selectedWidgets.includes(t)||!o[t]||!o[t].canHaveWidgets||!o[t].onCommand||null===(n=o[t].refService)||void 0===n||!n.current)continue;const e=null===(r=o[this.props.selectedWidgets[0]].refService)||void 0===r||null===(l=r.current)||void 0===l?void 0:l.getBoundingClientRect(),i=null===(c=o[t].refService)||void 0===c||null===(h=c.current)||void 0===h?void 0:h.getBoundingClientRect();i&&e&&e.top>=i.top&&e.left>=i.left&&e.right<=i.right&&e.bottom<=i.bottom&&this.props.context.askAboutInclude(this.props.selectedWidgets[0],t,((t,e)=>{var i;const s=null===(i=o[e])||void 0===i?void 0:i.onCommand;s&&s("include",t)}))}this.showRulers(!0)},this.pxToPercent=(t,e)=>{if(!this.refView.current)return null;this.refView.current.clientLeft,this.refView.current.clientTop;const i=this.refView.current.clientHeight,s=this.refView.current.clientWidth;"relative"===t.position&&(delete e.top,delete e.left,"100%"===t.width&&delete e.width,"100%"===t.height&&delete e.height);const a={...e};return e.top&&"%"===(0,u.mo)(t.top).dimension&&"%"!==(0,u.mo)(e.top).dimension&&(a.top=100*(0,u.mo)(e.top).value/i,a.top="".concat(Math.round(100*a.top)/100,"%")),e.left&&"%"===(0,u.mo)(t.left).dimension&&"%"!==(0,u.mo)(e.left).dimension&&(a.left=100*(0,u.mo)(e.left).value/s,a.left="".concat(Math.round(100*a.left)/100,"%")),e.width&&"%"===(0,u.mo)(t.width).dimension&&"%"!==(0,u.mo)(e.width).dimension&&(a.width=(0,u.mo)(e.width).value/s*100,a.width="".concat(Math.round(100*a.width)/100,"%")),e.height&&"%"===(0,u.mo)(t.height).dimension&&"%"!==(0,u.mo)(e.height).dimension&&(a.height=(0,u.mo)(e.height).value/i*100,a.height="".concat(Math.round(100*a.height)/100,"%")),{...t,...a}},this.onPxToPercent=(t,e,i)=>{if(!this.refView.current)return[];const s=this.refView.current.clientHeight,a=this.refView.current.clientWidth,o=t.map((t=>{const i=this.editWidgetsRect(t);if(!i)return null;let o;return o="top"===e?100*i.top/s:"left"===e?100*i.left/a:"width"===e?i.width/a*100:i.height/s*100,"".concat(Math.round(100*o)/100,"%")}));return i&&i(o),o},this.onPercentToPx=(t,e,i)=>{const s=t.map((t=>{const i=this.editWidgetsRect(t);return i?"".concat(Math.round(i[e]),"px"):null}));return i&&i(s),s},this.moveWidgets=async(t,e)=>{this.moveTimer||(this.movement={x:0,y:0},this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onMove;i&&i()})),Object.keys(this.widgetsRefs).forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onCommand;i&&i("startMove")}))),this.movement&&(this.movement.x+=t,this.movement.y+=e,this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onMove;i&&this.movement&&i(this.movement.x,this.movement.y,!1,this.calculateRelativeWidgetPosition)})),this.showRulers(),this.moveTimer&&clearTimeout(this.moveTimer),this.moveTimer=setTimeout((()=>{this.moveTimer=null,this.showRulers(!0),d.M_.dispatch((0,d.V_)(!0)),this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onMove;i&&this.movement&&i(this.movement.x,this.movement.y,!0,this.calculateRelativeWidgetPosition)})),this.movement=null,Object.keys(this.widgetsRefs).forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onCommand;i&&i("stopMove")}))}),800))},this.resizeWidgets=async(t,e)=>{this.moveTimer||(this.movement={x:0,y:0,isResize:!0},Object.keys(this.widgetsRefs).forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onCommand;i&&i("startResize")})),this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onMove;i&&i()}))),this.movement&&(this.movement.x+=t,this.movement.y+=e,this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onMove;i&&this.movement&&i(this.movement.x,this.movement.y,!1,this.calculateRelativeWidgetPosition)})),this.showRulers(),this.moveTimer&&clearTimeout(this.moveTimer),this.moveTimer=setTimeout((()=>{this.moveTimer=null,this.showRulers(!0),this.props.selectedWidgets.forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onMove;i&&this.movement&&i(this.movement.x,this.movement.y,!0,this.calculateRelativeWidgetPosition)})),Object.keys(this.widgetsRefs).forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onCommand;i&&i("stopResize")})),this.movement=null}),800))},this.onKeyDown=async t=>{var e;this.props.editMode&&"BODY"===(null===(e=document.activeElement)||void 0===e?void 0:e.tagName)&&this.props.selectedWidgets.length&&("ArrowLeft"===t.key&&(t.preventDefault(),await this[t.shiftKey?"resizeWidgets":"moveWidgets"](t.ctrlKey?-10:-1,0)),"ArrowRight"===t.key&&(t.preventDefault(),await this[t.shiftKey?"resizeWidgets":"moveWidgets"](t.ctrlKey?10:1,0)),"ArrowUp"===t.key&&(t.preventDefault(),await this[t.shiftKey?"resizeWidgets":"moveWidgets"](0,t.ctrlKey?-10:-1)),"ArrowDown"===t.key&&(t.preventDefault(),await this[t.shiftKey?"resizeWidgets":"moveWidgets"](0,t.ctrlKey?10:1)))},this.promiseToCollect=_.Ay.collectRxInformation(t.context.socket,d.M_.getState().visProject,t.context.changeProject),this.state={mounted:!1,rulers:[],loadedjQueryTheme:"",themeCode:"",width:0,menuWidth:window.localStorage.getItem("vis.menuWidth")||"full"},this.refView=a().createRef(),this.refRelativeView=a().createRef(),this.refRelativeColumnsView=new Array(8);for(let e=0;e<8;e++)this.refRelativeColumnsView[e]=a().createRef();this.widgetsRefs={},this.selectDiv=null,this.movement=null,this.theme={},this.ignoreMouseEvents=!1,this.oldFilter=JSON.stringify(t.viewsActiveFilter&&t.viewsActiveFilter[this.props.view]||[])}async componentDidMount(){this.updateViewWidth(),await this.promiseToCollect,this.props.context.linkContext.registerViewRef(this.props.view,this.refView,this.onCommand),await this.loadJqueryTheme(this.getJQueryThemeName()),this.setState({mounted:!0},(()=>this.registerEditorHandlers()))}componentWillUnmount(){var t;this.props.context.linkContext.unregisterViewRef(this.props.view,this.refView),null!==(t=this.refView.current)&&void 0!==t&&t._originalParent&&(this.refView.current._originalParent.appendChild(this.refView.current),this.refView.current._originalParent=null),this.selectDiv&&(this.selectDiv.remove(),this.selectDiv=null),this.widgetsRefs={},this.registerEditorHandlers(!0),this.uninstallKeyHandlers()}changeFilter(t){if((t={filter:[],...t}).filter&&(this.props.viewsActiveFilter[this.props.view]=t.filter,Object.keys(this.widgetsRefs).forEach((t=>{var e;null!==(e=this.widgetsRefs[t])&&void 0!==e&&e.onCommand&&this.widgetsRefs[t].onCommand("changeFilter")})),window.vis.binds.bars&&window.vis.binds.bars.filterChanged))try{window.vis.binds.bars.filterChanged(this.props.view,t.filter.join(","))}catch(e){console.error("Cannot change filter: ".concat(e))}return null}cancelStealMode(t){this.nextClickIsSteal&&(window.document.removeEventListener("mousedown",this.onMouseWindowDown),this.nextClickIsSteal.cb(t),Object.keys(this.widgetsRefs).forEach((t=>{var e;const i=null===(e=this.widgetsRefs[t])||void 0===e?void 0:e.onCommand;i&&i("cancelStealMode")})),this.nextClickIsSteal=null)}getWidgetsInRect(t,e){const i=Object.keys(this.widgetsRefs).filter((i=>{var s;if(!d.M_.getState().visProject[this.props.view].widgets[i])return"fakeId"!==i&&console.warn("Orphaned widget ".concat(i," found!")),null;if(d.M_.getState().visProject[this.props.view].widgets[i].groupid&&!this.props.selectedGroup)return null;const a=this.widgetsRefs[i].widDiv||(null===(s=this.widgetsRefs[i].refService)||void 0===s?void 0:s.current);if(a){const i=a.getBoundingClientRect();if(e){if(i.top>=t.top&&i.top<=t.bottom&&i.left>=t.left&&i.left<=t.right)return!0;if(i.bottom>=t.top&&i.bottom<=t.bottom&&i.right>=t.left&&i.right<=t.right)return!0;if(i.top>=t.top&&i.top<=t.bottom&&i.right>=t.left&&i.right<=t.right)return!0;if(i.bottom>=t.top&&i.bottom<=t.bottom&&i.left>=t.left&&i.left<=t.right)return!0}else if(i.top>=t.top&&i.top<=t.bottom&&i.left>=t.left&&i.left<=t.right&&i.bottom>=t.top&&i.bottom<=t.bottom&&i.right>=t.left&&i.right<=t.right)return!0}return!1}));return i.sort(),i}editWidgetsRect(t){var e;if(!this.refView.current)return null;const i=this.refView.current.offsetLeft,s=this.refView.current.offsetTop,a=this.widgetsRefs[t].widDiv||(null===(e=this.widgetsRefs[t].refService)||void 0===e?void 0:e.current);if(!a)return null;let o=a.offsetTop-s,n=a.offsetLeft-i;if(!n&&!o){const e=d.M_.getState().visProject[this.props.view].widgets[t].style;n=parseInt((null===e||void 0===e?void 0:e.left)||"0",10)+parseInt(a.offsetLeft,10),o=parseInt((null===e||void 0===e?void 0:e.top)||"0",10)+parseInt(a.offsetTop,10),n=n||0,o=o||0}return{top:o,left:n,width:a.clientWidth,height:a.clientHeight}}registerEditorHandlers(t){this.props.context.registerEditorCallback&&(t||this.props.activeView!==this.props.view?(this.registerDone=!1,this.props.context.registerEditorCallback("onStealStyle",this.props.view),this.props.context.registerEditorCallback("onPxToPercent",this.props.view),this.props.context.registerEditorCallback("pxToPercent",this.props.view),this.props.context.registerEditorCallback("onPercentToPx",this.props.view)):this.registerDone||(this.registerDone=!0,this.props.context.registerEditorCallback("onStealStyle",this.props.view,this.onStealStyle),this.props.context.registerEditorCallback("onPxToPercent",this.props.view,this.onPxToPercent),this.props.context.registerEditorCallback("pxToPercent",this.props.view,this.pxToPercent),this.props.context.registerEditorCallback("onPercentToPx",this.props.view,this.onPercentToPx)))}updateViewWidth(){this.refRelativeView.current&&this.refRelativeView.current.offsetWidth!==this.state.width&&this.setState({width:this.refRelativeView.current.offsetWidth})}componentDidUpdate(){if(this.registerEditorHandlers(),this.updateViewWidth(),!this.props.editMode){const t=JSON.stringify(this.props.viewsActiveFilter&&this.props.viewsActiveFilter[this.props.view]||[]);this.oldFilter!==t&&(this.oldFilter=t,this.changeFilter({filter:JSON.parse(t)}))}}static renderGitter(t,e){e=e||"#D0D0D0";const i=5*(t=t||10),s=t,a=btoa('<svg width="'.concat(i,'" height="').concat(i,'" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n        <pattern id="grid" width="').concat(i,'" height="').concat(i,'" patternUnits="userSpaceOnUse">\n            <path d="M 0 ').concat(s," L ").concat(i," ").concat(s," M ").concat(s," 0 L ").concat(s," ").concat(i," M 0 ").concat(2*s," L ").concat(i," ").concat(2*s," M ").concat(2*s," 0 L ").concat(2*s," ").concat(i," M 0 ").concat(3*s," L ").concat(i," ").concat(3*s," M ").concat(3*s," 0 L ").concat(3*s," ").concat(i," M 0 ").concat(4*s," L ").concat(i," ").concat(4*s," M ").concat(4*s," 0 L ").concat(4*s," ").concat(i,'" fill="none" stroke="').concat(e,'" opacity="0.2" stroke-width="1"/>\n            <path d="M ').concat(i," 0 L 0 0 0 ").concat(i,'" fill="none" stroke="').concat(e,'" stroke-width="1"/>\n        </pattern>\n    </defs>\n    <rect width="100%" height="100%" fill="url(#grid)"/>\n</svg>')),o="url(data:image/svg+xml;base64,".concat(a,")");return(0,g.jsx)("div",{style:{opacity:.2,zIndex:-1,userSelect:"none",pointerEvents:"none",width:"100%",height:"100%",backgroundImage:o,backgroundPosition:"-1px -1px"}})}static getOneWidget(t,e,i){var s;if(!_.Ay.rxWidgets)return null;const a=_.Ay.rxWidgets[e.tpl]||(null!==(s=_.Ay.allWidgetsList)&&void 0!==s&&s.includes(e.tpl)?x:c.A);return(0,g.jsx)(a,{tpl:e.tpl,...i},"".concat(t,"_").concat(i.id))}async loadJqueryTheme(t){if(I.themeCache[t]&&this.props.view){let e=I.themeCache[t];const i="visview_".concat(this.props.view.replace(/\s/g,"_"));e=e.replace(".ui-helper-hidden","\n#".concat(i," .ui-helper-hidden")),e=e.replace(/(}.)/g,"}\n#".concat(i," .")),e=e.replace(/,\./g,",#".concat(i," .")),e=e.replace(/images/g,"../../lib/css/themes/jquery-ui/".concat(t,"/images")),this.setState({loadedjQueryTheme:t,themeCode:e})}else try{const e=await fetch("../../lib/css/themes/jquery-ui/".concat(t,"/jquery-ui.min.css"));let i=await e.text();I.themeCache[t]=i;const s="visview_".concat(this.props.view.replace(/\s/g,"_"));i=i.replace(".ui-helper-hidden","\n#".concat(s," .ui-helper-hidden")),i=i.replace(/(}.)/g,"}\n#".concat(s," .")),i=i.replace(/,\./g,",#".concat(s," .")),i=i.replace(/images/g,"../../lib/css/themes/jquery-ui/".concat(t,"/images")),this.setState({loadedjQueryTheme:t,themeCode:i})}catch(e){console.warn('Cannot load jQueryUI theme "'.concat(t,'": ').concat(e.stack))}this.loadingTheme=!1}getJQueryThemeName(){var t;const e=this.props.view&&(null===(t=d.M_.getState().visProject[this.props.view])||void 0===t?void 0:t.settings);return(null===e||void 0===e?void 0:e.theme)||"redmond"}installKeyHandlers(){this.keysHandlerInstalled||(this.keysHandlerInstalled=!0,window.addEventListener("keydown",this.onKeyDown,!1))}uninstallKeyHandlers(){this.keysHandlerInstalled&&(this.keysHandlerInstalled=!1,window.removeEventListener("keydown",this.onKeyDown,!1))}renderScreenSize(){var t,e;const i=parseInt((null===(t=d.M_.getState().visProject[this.props.view].settings)||void 0===t?void 0:t.sizex)||0,10),s=parseInt((null===(e=d.M_.getState().visProject[this.props.view].settings)||void 0===e?void 0:e.sizey)||0,10);return this.props.editMode&&this.props.view&&i&&s?[(0,g.jsx)("div",{style:{top:0,left:0,width:"".concat(i,"px"),height:"".concat(s,"px"),position:"absolute",borderTopWidth:0,borderLeftWidth:0,borderRightWidth:1,borderBottomWidth:1,boxSizing:"content-box",borderStyle:"dashed",borderColor:"black",zIndex:1e3,pointerEvents:"none",userSelect:"none",opacity:.7}},"black"),(0,g.jsx)("div",{style:{top:0,left:0,width:"".concat(i+1,"px"),height:"".concat(s+1,"px"),position:"absolute",borderTopWidth:0,borderLeftWidth:0,borderRightWidth:1,borderBottomWidth:1,boxSizing:"content-box",borderStyle:"dashed",borderColor:"white",zIndex:1e3,pointerEvents:"none",userSelect:"none",opacity:.7}},"white")]:null}getRelativeStyle(t,e,i){const s={};if(e){const t=d.M_.getState().visProject[this.props.view].widgets[e].style;s.width=(null===t||void 0===t?void 0:t.width)||"100%",s.height=(null===t||void 0===t?void 0:t.height)||"100%"}else{var a;if(t.sizex&&!i){let e=t.sizex,i=t.sizey||0;(0,l.Ny)(e)&&(e=parseFloat(e)),(0,l.Ny)(i)&&(i=parseFloat(i)),("number"===typeof e||e.match(/\d$/))&&(e="".concat(e.toString(),"px")),("number"===typeof i||i.match(/\d$/))&&(i="".concat(i.toString(),"px")),s.width=e,s.height=i}else s.width="100%",s.height="100%";s.display=(null===(a=t.style)||void 0===a?void 0:a.display)||"flex","flex"===s.display&&(s.flexWrap="wrap",s.columnGap=8,(0,l.Ny)(t.columnGap)&&(s.columnGap=parseInt(t.columnGap,10)))}return s.position="absolute",s.top=0,s.left=0,s}getCountOfRelativeColumns(t,e){const i=this.state.width;if(i){if(t.columnWidth&&(0,l.Ny)(t.columnWidth))return Math.floor(this.state.width/t.columnWidth)+1;let s;return s=i<600?1:i<900?2:i<1200?3:i<2064?4:Math.floor(i/500)+1,s>e&&(s=e),s>8&&(s=8),s}return 1}renderNavigation(t){return(0,g.jsx)(D,{context:this.props.context,activeView:this.props.activeView,view:this.props.view,editMode:this.props.editMode,menuWidth:this.state.menuWidth,classes:{},setMenuWidth:t=>(window.localStorage.setItem("vis.menuWidth",t),this.setState({menuWidth:t}),new Promise((t=>{setTimeout((()=>{this.updateViewWidth(),t(null)}),400)}))),children:t})}render(){var t,e,i,s,a,c,h;let p,v=[],m=[];const x=d.M_.getState().visProject[this.props.view];if(!this.props.view||!x)return null;const f=x.settings;if(this.props.view===this.props.activeView&&this.props.editMode&&!this.keysHandlerInstalled?this.installKeyHandlers():this.props.view===this.props.activeView&&this.props.editMode||!this.keysHandlerInstalled||this.uninstallKeyHandlers(),this.state.mounted&&this.state.themeCode&&this.refView.current){var y,w;if(null===(y=this.props.viewsActiveFilter)||void 0===y||!y[this.props.view])this.props.viewsActiveFilter[this.props.view]=((null===(w=x.settings)||void 0===w?void 0:w.filterkey)||"").split(",").map((t=>t.trim())).filter((t=>t));const t=x.widgets;let e=!0;if(t){var b,D;let i=[];var _,j,C;if(this.props.selectedGroup)i=[...null!==(_=null===(j=t[this.props.selectedGroup])||void 0===j||null===(C=j.data)||void 0===C?void 0:C.members)&&void 0!==_?_:[]];else null!==(b=x.settings)&&void 0!==b&&b.order&&(i=[...x.settings.order]);this.props.selectedGroup&&i.sort(((e,i)=>{const s=t[e],a=t[i],o=s.style&&("relative"===s.style.position||"static"===s.style.position||"sticky"===s.style.position),n=a.style&&("relative"===a.style.position||"static"===a.style.position||"sticky"===a.style.position);return o&&n?0:o?-1:1}));const s=[],a=[],o=[];this.props.editMode&&null!==(D=this.props.selectedWidgets)&&void 0!==D&&D.length&&(this.props.selectedWidgets.forEach((t=>{const e=x.widgets[t];!e||e.groupid&&!this.props.selectedGroup||(e.style?"relative"===e.style.position?s.push(t):e.style.position&&"absolute"!==e.style.position?o.push(t):a.push(t):a.push(t))})),(o.length||s.length&&a.length)&&(e=!1));const n=[],c=[],h=x.filterWidgets,u=x.filterInvert;if(Object.keys(t).forEach((t=>{if(t===this.props.selectedGroup)return;const e=x.widgets[t];if(!e||e.grouped&&!this.props.selectedGroup)return;if(!this.props.selectedGroup&&e.usedInWidget)return;if(!(0,l.lG)({view:this.props.view,editMode:this.props.editMode,project:d.M_.getState().visProject,user:d.M_.getState().activeUser,wid:t}))return;if(this.props.selectedGroup&&t!==this.props.selectedGroup&&e.groupid!==this.props.selectedGroup)return;var i;if(this.props.editMode&&null!==h&&void 0!==h&&h.length)if(null!==(i=e.data)&&void 0!==i&&i.filterkey){let t=e.data.filterkey;if(t&&"string"===typeof t&&(t=t.split(",").map((t=>t.trim())).filter((t=>t))),u){if(!h.find((e=>t.includes(e))))return}else if(h.find((e=>t.includes(e))))return}else if(u)return;if(e.style&&("relative"===e.style.position||"static"===e.style.position||"sticky"===e.style.position)&&t!==this.props.selectedGroup)n.includes(t)||n.push(t);else{const e=n.indexOf(t);-1!==e&&n.splice(e,1),c.includes(t)||c.push(t)}})),!this.props.selectedGroup)for(let t=i.length-1;t>=0;t--)x.widgets[i[t]]||i.splice(t,1);n.sort(((t,e)=>{const s=i.indexOf(t),a=i.indexOf(e);return-1===s&&-1===a?0:-1===s?1:-1===a?-1:s-a}));const y=this.props.selectedGroup||!f?1:this.getCountOfRelativeColumns(f,n.length),w=new Array(y);for(let t=0;t<w.length;t++)w[t]=[];const S=this.props.view;if(v=c.map(((t,s)=>{var a;return I.getOneWidget(s,x.widgets[t],{context:this.props.context,editMode:this.props.editMode,id:t,isRelative:!1,mouseDownOnView:this.mouseDownOnView,moveAllowed:e,ignoreMouseEvents:this.ignoreMouseEvents,onIgnoreMouseEvents:this.onIgnoreMouseEvents,refParent:this.props.selectedGroup?this.refRelativeView:this.refView,askView:this.askView,relativeWidgetOrder:i,selectedGroup:this.props.selectedGroup,selectedWidgets:(null===(a=this.movement)||void 0===a?void 0:a.selectedWidgetsWithRectangle)||this.props.selectedWidgets,view:S,viewsActiveFilter:this.props.viewsActiveFilter,customSettings:this.props.customSettings})})),n.length){let t=0;if(n.forEach(((s,a)=>{var o;const r=d.M_.getState().visProject[S].widgets[s];r.style.newLine&&(t=0);const l=I.getOneWidget(a,r,{context:this.props.context,editMode:this.props.editMode,id:s,isRelative:!0,mouseDownOnView:this.mouseDownOnView,moveAllowed:e,ignoreMouseEvents:this.ignoreMouseEvents,onIgnoreMouseEvents:this.onIgnoreMouseEvents,refParent:this.props.selectedGroup?this.refRelativeView:this.refRelativeColumnsView[t],askView:this.askView,relativeWidgetOrder:this.props.selectedGroup?i:n,selectedWidgets:(null===(o=this.movement)||void 0===o?void 0:o.selectedWidgetsWithRectangle)||this.props.selectedWidgets,selectedGroup:this.props.selectedGroup,view:S,customSettings:this.props.customSettings,viewsActiveFilter:this.props.viewsActiveFilter});w[t].push(l),t++,t>=y&&(t=0)})),this.props.selectedGroup)m=w[0];else{const t={};null!==f&&void 0!==f&&f.columnWidth&&(0,l.Ny)(f.columnWidth)&&(t.maxWidth=parseFloat(f.columnWidth)),m=w.map(((e,i)=>(0,g.jsx)("div",{ref:this.refRelativeColumnsView[i],style:t,className:r.Utils.clsx("vis-view-column",this.props.editMode&&"vis-view-column-edit"),children:e},i)))}}else m=null;var k;if(this.props.selectedGroup)p=I.getOneWidget(0,x.widgets[this.props.selectedGroup],{context:this.props.context,editMode:this.props.editMode,id:this.props.selectedGroup,isRelative:!1,mouseDownOnView:this.mouseDownOnView,moveAllowed:e,ignoreMouseEvents:this.ignoreMouseEvents,onIgnoreMouseEvents:this.onIgnoreMouseEvents,refParent:this.refView,askView:this.askView,relativeWidgetOrder:i,selectedGroup:this.props.selectedGroup,selectedWidgets:(null===(k=this.movement)||void 0===k?void 0:k.selectedWidgetsWithRectangle)||this.props.selectedWidgets,view:S,viewsActiveFilter:this.props.viewsActiveFilter,customSettings:this.props.customSettings})}}let W="vis-view";const M={width:"100%",height:"100%"};this.state.loadedjQueryTheme!==this.getJQueryThemeName()&&this.props.view&&(this.loadingTheme||(this.loadingTheme=!0,setTimeout((()=>this.loadJqueryTheme(this.getJQueryThemeName())),this.state.loadedjQueryTheme?50:0)));const T={},R=(null===f||void 0===f||null===(t=f.style)||void 0===t?void 0:t.background_class)||"";(null===f||void 0===f?void 0:f.style)&&Object.keys(f.style).forEach((t=>{if("background_class"===t){var e;W=(0,u.iQ)(W,null===(e=f.style)||void 0===e?void 0:e.background_class)}else{const e=t.startsWith("background");if(!f["bg-image"]||!e){const i=f.style[t];t=t.replace(/(-\w)/g,(t=>t[1].toUpperCase())),M[t]=i,e&&(T[t]=i)}}}));let N=this.props.context.theme;const q=null===(e=this.props.customSettings)||void 0===e?void 0:e.themeType;var O,A,F,P,z;(q&&q!==N.palette.mode&&(this.theme[q]||(this.theme[q]=(0,r.Theme)(q)),N=this.theme[q]),M.backgroundColor||M.background)||(null!==(O=this.props.customSettings)&&void 0!==O&&null!==(A=O.viewStyle)&&void 0!==A&&A.backgroundColor?T.backgroundColor=this.props.customSettings.viewStyle.backgroundColor:"dark"===(null===(F=this.props.customSettings)||void 0===F?void 0:F.themeType)?T.backgroundColor="#000":T.backgroundColor="dark"===N.palette.mode?"#000":"#fff");M.color||(null!==(P=this.props.customSettings)&&void 0!==P&&null!==(z=P.viewStyle)&&void 0!==z&&z.color?M.color=this.props.customSettings.viewStyle.color:M.color="dark"===N.palette.mode?"#fff":"#000");!M.fontFamily&&null!==(i=this.props.customSettings)&&void 0!==i&&null!==(s=i.viewStyle)&&void 0!==s&&s.fontFamily&&(M.fontFamily=this.props.customSettings.viewStyle.fontFamily),null!==(a=this.props.customSettings)&&void 0!==a&&null!==(c=a.viewStyle)&&void 0!==c&&c.overrides&&(N=(0,o.createTheme)(N,this.props.customSettings.viewStyle.overrides)),this.props.view!==this.props.activeView&&(M.display="none"),this.props.context.container&&(M.overflow="hidden");let E=null;var L,B;2===(null===(h=d.M_.getState().visProject[this.props.view].settings)||void 0===h?void 0:h.snapType)&&this.props.editMode&&(E=I.renderGitter(null===(L=x.settings)||void 0===L?void 0:L.gridSize,null===(B=x.settings)||void 0===B?void 0:B.snapColor));if(this.props.style&&Object.assign(M,this.props.style),f&&f["bg-image"])if(T.backgroundImage='url("../'.concat(this.props.context.adapterName,".").concat(this.props.context.instance,"/").concat(this.props.context.projectName).concat(f["bg-image"].substring(9),'")'),T.backgroundRepeat="no-repeat",T.backgroundPosition="top left",f["bg-color"]&&(T.backgroundColor=f["bg-color"]),f["bg-position-x"]&&(T.backgroundPositionX=(0,l.Ny)(f["bg-position-x"])?"".concat(f["bg-position-x"],"px"):f["bg-position-x"]),f["bg-position-y"]&&(T.backgroundPositionY=(0,l.Ny)(f["bg-position-y"])?"".concat(f["bg-position-y"],"px"):f["bg-position-y"]),f["bg-width"]&&f["bg-height"]){const t=(0,l.Ny)(f["bg-width"])?"".concat(f["bg-width"],"px"):f["bg-width"],e=(0,l.Ny)(f["bg-height"])?"".concat(f["bg-height"],"px"):f["bg-height"];T.backgroundSize="".concat(t," ").concat(e)}else if(f["bg-width"])T.backgroundSize="".concat((0,l.Ny)(f["bg-width"])?"".concat(f["bg-width"],"px"):f["bg-width"]," auto");else if(f["bg-height"]){const t=(0,l.Ny)(f["bg-height"])?"".concat(f["bg-height"],"px"):f["bg-height"];T.backgroundSize="auto ".concat(t)}let V;Object.assign(M,T);let H=null;if(f&&f.limitScreen&&(window.screen.width>=800&&window.screen.height>=800||!f.limitScreenDesktop)){const t=(0,l.Ny)(f.sizex)?parseFloat(f.sizex):0,e=(0,l.Ny)(f.sizey)?parseFloat(f.sizey):0;if(t&&e){const i=parseFloat(f.limitScreenBorderWidth)||0,s=f.limitScreenBorderColor||"#333",a=f.limitScreenBorderStyle||"dotted",o=f.limitScreenBackgroundColor||null;H={...T,width:t+2*i,height:e+2*i,minWidth:t+2*i,minHeight:e+2*i,overflow:"auto",position:"relative",boxSizing:"border-box",borderWidth:i,borderColor:s,borderStyle:a},M.display="flex",M.justifyContent="center",M.alignItems="center",M.backgroundColor=o}}this.props.selectedGroup?V=p:f&&(V=(0,g.jsxs)(g.Fragment,{children:[m?(0,g.jsx)("div",{ref:this.refRelativeView,style:this.getRelativeStyle(f,this.props.selectedGroup,!!H),className:"vis-relative-view",children:m}):null,v]})),H&&(V=(0,g.jsx)("div",{style:H,className:"vis-limit-screen",children:V}));let J=(0,g.jsxs)("div",{className:"".concat(W," visview_").concat(this.props.view.replace(/\s/g,"_")),ref:this.refView,id:"visview_".concat(this.props.view.replace(/\s/g,"_")),onMouseDown:this.props.context.runtime?void 0:t=>this.props.editMode&&this.mouseDownLocal&&this.mouseDownLocal(t),onDoubleClick:this.props.context.runtime?()=>this.props.editMode&&this.doubleClickOnView&&this.doubleClickOnView():void 0,style:M,children:[(0,g.jsx)("style",{children:this.state.themeCode}),E,H?null:this.renderScreenSize(),this.state.rulers.map(((t,e)=>(0,g.jsx)("div",{style:{pointerEvents:"none",userSelect:"none",position:"absolute",width:"horizontal"===t.type?"100%":10,height:"horizontal"===t.type?10:"100%",borderStyle:"solid",borderColor:"red",borderWidth:0,borderLeftWidth:"horizontal"===t.type?0:1,borderTopWidth:"horizontal"===t.type?1:0,left:"horizontal"===t.type?0:t.value,top:"horizontal"===t.type?t.value:0,zIndex:1e3}},e))),V]});if(f&&(f.navigation||f.navigationBar)&&this.props.view===this.props.activeView&&(J=this.renderNavigation(J)),!this.props.visInWidget&&this.props.activeView===this.props.view){const t=JSON.stringify(T);window._lastAppliedStyle&&window._lastAppliedStyle===t||(window._lastAppliedStyle=t,window.document.documentElement.removeAttribute("style"),Object.keys(T).forEach((t=>window.document.documentElement.style[t]=T[t]))),window.document.documentElement.className=R}return(0,g.jsx)(n.StylesProvider,{generateClassName:S,children:(0,g.jsx)(o.StyledEngineProvider,{injectFirst:!0,children:(0,g.jsx)(o.ThemeProvider,{theme:N,children:J})})})}}I.Z_INDEXES={VIEW_SELECT_RECTANGLE:1201,WIDGET_SERVICE_DIV:1200},I.themeCache={};const j=I}}]);
//# sourceMappingURL=777.5c053f9a.chunk.js.map